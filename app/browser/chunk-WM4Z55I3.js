import{b as Oe}from"./chunk-WVQGEQLH.js";import{b as Re}from"./chunk-VL5A4WUO.js";import"./chunk-TQK45RMZ.js";import"./chunk-KICUZIBO.js";import{a as oe,b as He}from"./chunk-42BTCZ3Y.js";import{a as Pe,b as P}from"./chunk-4A2WLUYH.js";import{b as re,c as ne}from"./chunk-VVKQAEX7.js";import{a as Be,b as Ne}from"./chunk-FW7KDDDM.js";import{Ba as K,C as d,Ca as j,D as S,Da as H,E,Eb as me,F as _e,Fa as g,Ga as h,Ha as ye,Ja as R,Jb as V,K as w,Ka as O,L as C,La as q,Ma as xe,Oa as T,P as we,Pa as D,Qc as se,Rc as je,S as Ce,Sb as G,T as ve,Vb as Fe,Wb as Ie,Xa as c,Y as a,Ya as u,Yb as Q,Z as B,Zb as ke,_b as F,a as M,ac as W,bb as Se,bc as $,c as pe,cc as Y,da as N,ec as I,fa as be,fb as Ee,ga as v,gb as z,gc as J,hc as X,ia as p,ib as Te,ic as Z,jc as ee,la as A,lc as Ue,mc as Me,nb as L,nc as k,oa as o,ob as De,pa as s,pb as Ve,qa as b,ua as y,va as f,wa as m,wc as te,x as ge,xc as Ae,y as he,yc as ie,z as x,zc as Ke}from"./chunk-DSVZHE42.js";import"./chunk-GAL4ENT6.js";var ae=(()=>{class i{constructor(){this.http=d(Ve),this.notificationService=d(Fe),this.api=d(Ie),this.tokenStorage=d(Pe),this.userService=d(P),this.host=this.api.host,this.userDialogVisible=N(!1),this.passDialogVisible=N(!1),this.loading=N(!1),this.existedUsernameError=new pe,this.oldPasswordError=new pe}updateUsername(e){this.http.put(`${this.host()}/profile`,e).subscribe({next:t=>{this.tokenStorage.saveUser(t.username),this.tokenStorage.saveToken(t.token),this.userService.loggedInUser.set(t.username),this.notificationService.showSuccess("Username updated successfully!","home")},error:t=>{t.status==406?this.existedUsernameError.next():this.notificationService.handleError(t,"home"),this.loading.set(!1)},complete:()=>{this.userDialogVisible.set(!1),this.loading.set(!1)}})}updatePassword(e){this.http.put(`${this.host()}/profile/password`,e).subscribe({next:t=>{console.log(t),this.notificationService.showSuccess(t.message,"home")},error:t=>{t.status==406?(console.log(t.error.message),this.oldPasswordError.next()):this.notificationService.handleError(t,"home"),this.loading.set(!1)},complete:()=>{this.passDialogVisible.set(!1),this.loading.set(!1)}})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275prov=he({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ze={provide:ke,useExisting:ge(()=>ce),multi:!0},qe={pint:/^[\d]*$/,int:/^[-]?[\d]*$/,pnum:/^[\d\.]*$/,money:/^[\d\.\s,]*$/,num:/^[-]?[\d\.]*$/,hex:/^[0-9a-f]*$/i,email:/^[a-z0-9_\.\-@]*$/i,alpha:/^[a-z_]*$/i,alphanum:/^[a-z0-9_]*$/i},de={TAB:9,RETURN:13,ESC:27,BACKSPACE:8,DELETE:46},ze={63234:37,63235:39,63232:38,63233:40,63276:33,63277:34,63272:46,63273:36,63275:35},ce=(()=>{class i{document;platformId;el;pValidateOnly;set pattern(e){this._pattern=e,e instanceof RegExp?this.regex=e:e in qe?this.regex=qe[e]:this.regex=/./}get pattern(){return this._pattern}ngModelChange=new we;regex=/./;_pattern;isAndroid;lastValue;constructor(e,t,r){this.document=e,this.platformId=t,this.el=r,De(this.platformId)?this.isAndroid=k.isAndroid():this.isAndroid=!1}isNavKeyPress(e){let t=e.keyCode;return t=k.getBrowser().safari&&ze[t]||t,t>=33&&t<=40||t==de.RETURN||t==de.TAB||t==de.ESC}isSpecialKey(e){let t=e.keyCode||e.charCode;return t==9||t==13||t==27||t==16||t==17||t>=18&&t<=20||k.getBrowser().opera&&!e.shiftKey&&(t==8||t>=33&&t<=35||t>=36&&t<=39||t>=44&&t<=45)}getKey(e){let t=e.keyCode||e.charCode;return k.getBrowser().safari&&ze[t]||t}getCharCode(e){return e.charCode||e.keyCode||e.which}findDelta(e,t){let r="";for(let n=0;n<e.length;n++)e.substr(0,n)+e.substr(n+e.length-t.length)===t&&(r=e.substr(n,e.length-t.length));return r}isValidChar(e){return this.regex.test(e)}isValidString(e){for(let t=0;t<e.length;t++)if(!this.isValidChar(e.substr(t,1)))return!1;return!0}onInput(e){if(this.isAndroid&&!this.pValidateOnly){let t=this.el.nativeElement.value,r=this.lastValue||"",n=this.findDelta(t,r),l=this.findDelta(r,t);n.length>1||!n&&!l?this.isValidString(t)||(this.el.nativeElement.value=r,this.ngModelChange.emit(r)):l||this.isValidChar(n)||(this.el.nativeElement.value=r,this.ngModelChange.emit(r)),t=this.el.nativeElement.value,this.isValidString(t)&&(this.lastValue=t)}}onKeyPress(e){if(this.isAndroid||this.pValidateOnly)return;let t=k.getBrowser(),r=this.getKey(e);if(t.mozilla&&(e.ctrlKey||e.altKey))return;if(r==17||r==18||r==13)return;let n=this.getCharCode(e),l=String.fromCharCode(n),le=!0;if(!t.mozilla&&(this.isSpecialKey(e)||!l))return;let fe=this.el.nativeElement.value||"",Ye=e.currentTarget.selectionStart||0,Je=e.currentTarget.selectionEnd||0,Xe=fe.substring(0,Ye)+l+fe.substring(Je);le=this.regex.test(Xe),le||e.preventDefault()}onPaste(e){let t=e.clipboardData||this.document.defaultView.clipboardData.getData("text");if(t){let r=/\{[0-9]+\}/,n=t.getData("text");if(r.test(this.regex.toString())){if(!this.regex.test(n)){e.preventDefault();return}}else for(let l of n.toString())if(!this.regex.test(l)){e.preventDefault();return}}}validate(e){if(this.pValidateOnly){let t=this.el.nativeElement.value;if(t&&!this.regex.test(t))return{validatePattern:!1}}}static \u0275fac=function(t){return new(t||i)(B(Ee),B(ve),B(Ce))};static \u0275dir=_e({type:i,selectors:[["","pKeyFilter",""]],hostAttrs:[1,"p-element"],hostBindings:function(t,r){t&1&&f("input",function(l){return r.onInput(l)})("keypress",function(l){return r.onKeyPress(l)})("paste",function(l){return r.onPaste(l)})},inputs:{pValidateOnly:[2,"pValidateOnly","pValidateOnly",Se],pattern:[0,"pKeyFilter","pattern"]},outputs:{ngModelChange:"ngModelChange"},features:[xe([Ze]),be]})}return i})(),Le=(()=>{class i{static \u0275fac=function(t){return new(t||i)};static \u0275mod=E({type:i});static \u0275inj=x({imports:[L]})}return i})();var pt=["username"],mt=()=>({width:"40vw"}),dt=()=>({"1199px":"65vw","575px":"95vw"}),ct=i=>({"ng-invalid ng-dirty":i});function ut(i,_){if(i&1&&(o(0,"h2"),g(1),c(2,"translate"),o(3,"span",6),g(4),s()()),i&2){let e=m();a(),ye(" ",u(2,2,"Username:")," "),a(3),h(e.loggedInUser())}}function ft(i,_){if(i&1){let e=y();o(0,"p-button",7),c(1,"translate"),f("onClick",function(){w(e);let r=m();return C(r.toggleUserDialog(!0))}),s()}i&2&&p("label",u(1,1,"Change"))}function gt(i,_){if(i&1){let e=y();o(0,"form",8),f("ngSubmit",function(){w(e);let r=m();return C(r.submitUsername())}),o(1,"div",9)(2,"label",10),g(3),c(4,"translate"),s(),b(5,"input",11,0),s()()}if(i&2){let e=m();p("formGroup",e.userForm),a(3),h(u(4,3,"New Username")),a(2),p("ngClass",D(5,ct,(e.new_username==null?null:e.new_username.invalid)&&((e.new_username==null?null:e.new_username.dirty)||(e.new_username==null?null:e.new_username.touched)||e.submitted)))}}function ht(i,_){if(i&1){let e=y();o(0,"p-button",12),c(1,"translate"),f("onClick",function(){w(e);let r=m();return C(r.toggleUserDialog(!1))}),s(),o(2,"p-button",13),c(3,"translate"),f("onClick",function(){w(e);let r=m();return C(r.submitUsername())}),s()}if(i&2){let e=m();p("label",u(1,3,"Cancel")),a(2),p("label",u(3,5,"Save"))("loading",e.loading())}}var Ge=(()=>{class i{constructor(){this.userService=d(P),this.profileService=d(ae),this.confirmationService=d(V),this.translate=d(re),this.loggedInUser=this.userService.loggedInUser,this.userDialogVisible=this.profileService.userDialogVisible,this.loading=this.profileService.loading,this.subscriptions=new M,this.submitted=!1,this.userForm=new Y({new_username:new I(null,F.required)})}ngOnInit(){this.subscriptions.add(this.profileService.existedUsernameError.subscribe(()=>{this.username.nativeElement.select(),this.userForm.controls.new_username.setErrors({error:"Username already exists"})}))}ngOnDestroy(){this.subscriptions.unsubscribe()}toggleUserDialog(e){this.profileService.userDialogVisible.set(e)}get new_username(){return this.userForm.get("new_username")}submitUsername(){this.submitted=!0,this.userForm.valid&&this.confirmationService.confirm({key:"home",message:this.translate.instant("Are you sure you want to continue ?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.profileService.loading.set(!0),this.profileService.updateUsername(this.userForm.value)},reject:()=>{this.submitted=!1}})}resetDialog(){this.submitted=!1,this.userForm.reset(),this.profileService.loading.set(!1),this.profileService.userDialogVisible.set(!1)}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=S({type:i,selectors:[["change-username"]],viewQuery:function(t,r){if(t&1&&K(pt,5),t&2){let n;j(n=H())&&(r.username=n.first)}},decls:7,vars:12,consts:[["username",""],["pTemplate","start"],["pTemplate","end"],["position","top","styleClass","p-fluid",3,"onHide","visibleChange","header","visible","modal","breakpoints","draggable","resizable"],["pTemplate","content"],["pTemplate","footer"],[1,"text-green-600"],["icon","pi pi-user-edit pi-fw",3,"onClick","label"],[3,"ngSubmit","formGroup"],[1,"field","mt-1"],["for","username"],["pInputText","","formControlName","new_username","required","","spellcheck","false","pKeyFilter","alpha",3,"ngClass"],["icon","pi pi-times","severity","secondary","size","small",3,"onClick","label"],["icon","pi pi-check","severity","success","size","small",3,"onClick","label","loading"]],template:function(t,r){t&1&&(o(0,"p-toolbar"),v(1,ut,5,4,"ng-template",1)(2,ft,2,3,"ng-template",2),s(),o(3,"p-dialog",3),c(4,"translate"),f("onHide",function(){return r.resetDialog()}),q("visibleChange",function(l){return O(r.userDialogVisible,l)||(r.userDialogVisible=l),l}),v(5,gt,7,7,"ng-template",4)(6,ht,4,7,"ng-template",5),s()),t&2&&(a(3),A(T(10,mt)),p("header",u(4,8,"Change Username")),R("visible",r.userDialogVisible),p("modal",!0)("breakpoints",T(11,dt))("draggable",!1)("resizable",!1))},dependencies:[z,J,Q,W,$,ee,X,Z,G,te,oe,se,ie,ce,ne]})}}return i})();var wt=["currentPassword"],Ct=()=>({width:"50vw"}),vt=()=>({"1199px":"75vw","575px":"95vw"}),ue=i=>({"ng-invalid ng-dirty":i});function bt(i,_){i&1&&(o(0,"h2"),g(1),c(2,"translate"),s()),i&2&&(a(),h(u(2,1,"Password")))}function yt(i,_){if(i&1){let e=y();o(0,"p-button",6),c(1,"translate"),f("click",function(){w(e);let r=m();return C(r.togglePassDialog(!0))}),s()}i&2&&p("label",u(1,1,"Change"))}function xt(i,_){if(i&1&&(o(0,"small",18),g(1),s()),i&2){let e=m(2);a(),h(e.current_password.errors.error||"this field is required!")}}function St(i,_){if(i&1&&(o(0,"small",18),g(1),s()),i&2){let e=m(2);a(),h(e.new_password.errors.error||"this field is required!")}}function Et(i,_){if(i&1&&(o(0,"small",18),g(1),s()),i&2){let e=m(2);a(),h(e.confirm_password.errors.error||"this field is required!")}}function Tt(i,_){if(i&1){let e=y();o(0,"form",7),f("ngSubmit",function(){w(e);let r=m();return C(r.submitPassword())}),o(1,"div",8)(2,"div",9)(3,"label",10),g(4),c(5,"translate"),s(),b(6,"input",11,0),v(8,xt,2,1,"small",12),s(),o(9,"div",13)(10,"label",14),g(11),c(12,"translate"),s(),b(13,"input",15),v(14,St,2,1,"small",12),s(),o(15,"div",13)(16,"label",16),g(17),c(18,"translate"),s(),b(19,"input",17),v(20,Et,2,1,"small",12),s()()()}if(i&2){let e=m();p("formGroup",e.passForm),a(4),h(u(5,10,"Current Password")),a(2),p("ngClass",D(16,ue,(e.current_password==null?null:e.current_password.invalid)&&((e.current_password==null?null:e.current_password.dirty)||(e.current_password==null?null:e.current_password.touched)||e.submitted))),a(2),p("ngIf",(e.current_password==null?null:e.current_password.invalid)&&((e.current_password==null?null:e.current_password.dirty)||(e.current_password==null?null:e.current_password.touched)||e.submitted)),a(3),h(u(12,12,"New Password")),a(2),p("ngClass",D(18,ue,(e.new_password==null?null:e.new_password.invalid)&&((e.new_password==null?null:e.new_password.dirty)||(e.new_password==null?null:e.new_password.touched)||e.submitted))),a(),p("ngIf",(e.new_password==null?null:e.new_password.invalid)&&((e.new_password==null?null:e.new_password.dirty)||(e.new_password==null?null:e.new_password.touched)||e.submitted)),a(3),h(u(18,14,"Confirm Password")),a(2),p("ngClass",D(20,ue,e.confirm_password.invalid&&(e.confirm_password.dirty||e.confirm_password.touched||e.submitted))),a(),p("ngIf",e.confirm_password.invalid&&(e.confirm_password.dirty||e.confirm_password.touched||e.submitted))}}function Dt(i,_){if(i&1){let e=y();o(0,"p-button",19),c(1,"translate"),f("onClick",function(){w(e);let r=m();return C(r.togglePassDialog(!1))}),s(),o(2,"p-button",20),c(3,"translate"),f("click",function(){w(e);let r=m();return C(r.submitPassword())}),s()}if(i&2){let e=m();p("label",u(1,3,"Cancel")),a(2),p("label",u(3,5,"Save"))("loading",e.loading())}}var Qe=(()=>{class i{constructor(){this.userService=d(P),this.profileService=d(ae),this.confirmationService=d(V),this.translate=d(re),this.loggedInUser=this.userService.loggedInUser,this.passDialogVisible=this.profileService.passDialogVisible,this.loading=this.profileService.loading,this.subscriptions=new M,this.submitted=!1,this.oldPasswordError=!1,this.passForm=new Y({current_password:new I(null,F.required),new_password:new I(null,[F.required]),confirm_password:new I(null,[F.required])})}ngOnInit(){this.subscriptions.add(this.profileService.oldPasswordError.subscribe(()=>{this.currentPassword.nativeElement.select(),this.oldPasswordError=!0,this.passForm.controls.current_password.setErrors({error:"Old password is incorrect!"})}))}ngOnDestroy(){this.subscriptions.unsubscribe()}togglePassDialog(e){this.profileService.passDialogVisible.set(e)}get current_password(){return this.passForm.get("current_password")}get new_password(){return this.passForm.get("new_password")}get confirm_password(){return this.passForm.get("confirm_password")}submitPassword(){this.submitted=!0,this.passForm.valid&&(this.passForm.value.new_password==this.passForm.value.confirm_password?this.confirmationService.confirm({key:"home",message:this.translate.instant("Are you sure you want to continue ?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.profileService.loading.set(!0),this.profileService.updatePassword(this.passForm.value)},reject:()=>{this.submitted=!1}}):(this.passForm.controls.new_password.setErrors({error:"password didnt match!"}),this.passForm.controls.confirm_password.setErrors({error:"password didnt match!"})))}resetDialog(){this.submitted=!1,this.passForm.reset(),this.profileService.loading.set(!1),this.profileService.passDialogVisible.set(!1)}currentPasswordError(){this.passForm.controls.current_password.setErrors({error:"old password is incorrect!"})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=S({type:i,selectors:[["change-password"]],viewQuery:function(t,r){if(t&1&&K(wt,5),t&2){let n;j(n=H())&&(r.currentPassword=n.first)}},decls:7,vars:12,consts:[["currentPassword",""],["pTemplate","start"],["pTemplate","end"],["position","top","styleClass","p-fluid",3,"onHide","visibleChange","header","visible","modal","breakpoints","draggable","resizable"],["pTemplate","content"],["pTemplate","footer"],["icon","pi pi-key pi-fw","styleClass","p-button-secondary",3,"click","label"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-12"],["for","current_password"],["type","password","pInputText","","formControlName","current_password","required","","spellcheck","false",3,"ngClass"],["class","p-error",4,"ngIf"],[1,"field","col-12","md:col-6"],["for","password"],["type","password","pInputText","","formControlName","new_password","required","","spellcheck","false",3,"ngClass"],["for","confirm_password"],["type","password","pInputText","","formControlName","confirm_password","required","","spellcheck","false",3,"ngClass"],[1,"p-error"],["icon","pi pi-times","severity","secondary","size","small",3,"onClick","label"],["icon","pi pi-check","severity","success","size","small",3,"click","label","loading"]],template:function(t,r){t&1&&(o(0,"p-toolbar"),v(1,bt,3,3,"ng-template",1)(2,yt,2,3,"ng-template",2),s(),o(3,"p-dialog",3),c(4,"translate"),f("onHide",function(){return r.resetDialog()}),q("visibleChange",function(l){return O(r.passDialogVisible,l)||(r.passDialogVisible=l),l}),v(5,Tt,21,22,"ng-template",4)(6,Dt,4,7,"ng-template",5),s()),t&2&&(a(3),A(T(10,Ct)),p("header",u(4,8,"Change Password")),R("visible",r.passDialogVisible),p("modal",!0)("breakpoints",T(11,vt))("draggable",!1)("resizable",!1))},dependencies:[z,Te,J,Q,W,$,ee,X,Z,G,te,oe,se,ie,ne]})}}return i})();var We=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=S({type:i,selectors:[["app-profile-home"]],decls:6,vars:0,consts:[[1,"grid","m-1"],[1,"col-12","lg:col-6","lg:col-offset-3"]],template:function(t,r){t&1&&(o(0,"div",0)(1,"div",1)(2,"p-card"),b(3,"change-username")(4,"br")(5,"change-password"),s()()())},dependencies:[Be,Ge,Qe]})}}return i})();var Pt=[{path:"",component:We}],$e=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=E({type:i})}static{this.\u0275inj=x({imports:[me.forChild(Pt),me]})}}return i})();var Ai=(()=>{class i{static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275mod=E({type:i})}static{this.\u0275inj=x({providers:[V],imports:[L,Ue,Me,$e,Ne,Ae,He,je,Ke,Oe,Re,Le]})}}return i})();export{Ai as ProfileModule};
