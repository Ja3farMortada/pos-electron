import{a as it,b as nt,c as ot}from"./chunk-KYEXICW3.js";import{a as ne}from"./chunk-DJZEHVDE.js";import{b as rt}from"./chunk-WVQGEQLH.js";import{a as oe}from"./chunk-O7X5CCTE.js";import{b as Ze}from"./chunk-SVHA7J7U.js";import"./chunk-TQK45RMZ.js";import{b as Je}from"./chunk-4ONBVWLA.js";import{b as He}from"./chunk-UIPYUTXU.js";import{b as Ee}from"./chunk-23C7B2M2.js";import{a as Xe}from"./chunk-ARZ4TFMZ.js";import{a as Q}from"./chunk-S6JZCVDZ.js";import{b as Qe}from"./chunk-XGV4AIQT.js";import{a as N}from"./chunk-XFMQNLNY.js";import{a as Ge}from"./chunk-5T7DQN3S.js";import"./chunk-6CXWHLUJ.js";import{a as Ve}from"./chunk-7CR6E6US.js";import"./chunk-KICUZIBO.js";import{a as et,b as tt}from"./chunk-B5UDKY34.js";import{a as je,b as Oe}from"./chunk-FA4OBAKY.js";import"./chunk-EA4RMISB.js";import{a as $e}from"./chunk-FO7TG3S7.js";import{a as qe,b as Ye}from"./chunk-42BTCZ3Y.js";import{b as Ue}from"./chunk-7QYRFDGN.js";import{a as O}from"./chunk-UJ5JDQTE.js";import{a as Ke}from"./chunk-ZOJPJJYV.js";import"./chunk-UVEVFGTS.js";import"./chunk-P4HR6EQA.js";import{e as ie}from"./chunk-QJMHFOYW.js";import{b as ee,c as Ne}from"./chunk-G5UOHYUM.js";import{F as ze,i as te,j as Fe,m as ke,p as Re,q as We,u as M,x as Le,y as Ae}from"./chunk-LBGQA5HW.js";import"./chunk-4A2WLUYH.js";import{b as Ie,c as j}from"./chunk-VVKQAEX7.js";import{a as A,b as we}from"./chunk-FW7KDDDM.js";import{Ba as P,C as v,Ca as F,D as R,Da as k,E as Y,Ea as W,Eb as ce,Fa as c,Ga as h,Ha as f,Ia as fe,Ja as x,Jb as ye,K as g,Ka as T,L as b,La as B,Oa as I,Qa as pe,Qc as Me,Rc as Pe,Sb as L,X as $,Xa as l,Y as a,Ya as s,a as ue,ac as J,fc as X,ga as w,gb as ge,ia as d,ib as G,ka as _e,la as Ce,lc as Se,ma as he,mb as V,mc as ve,nb as be,oa as n,pa as r,qa as D,qc as De,ua as E,uc as xe,va as _,wa as C,wc as z,xc as Te,yc as Z,z as q,zc as Be}from"./chunk-DSVZHE42.js";import"./chunk-GAL4ENT6.js";var Bt=["dt"],It=()=>["dollar","lira"],Et=()=>({"min-width":"45rem"}),Vt=(i,u)=>({"text-300":i,"text-red-600":u}),Mt=(i,u)=>({"text-300":i,"text-green-600":u});function Pt(i,u){i&1&&(n(0,"tr"),D(1,"th"),n(2,"th"),c(3),l(4,"translate"),r(),n(5,"th"),c(6,"#"),r(),n(7,"th"),c(8),l(9,"translate"),r(),n(10,"th"),c(11),l(12,"translate"),r(),n(13,"th"),c(14),l(15,"translate"),r(),n(16,"th"),c(17),l(18,"translate"),r(),n(19,"th"),c(20),l(21,"translate"),r()()),i&2&&(a(3),h(s(4,6,"Date")),a(5),h(s(9,8,"Description")),a(3),h(s(12,10,"Notes")),a(3),h(s(15,12,"Debit")),a(3),h(s(18,14,"Credit")),a(3),h(s(21,16,"Balance")))}function Ft(i,u){if(i&1&&D(0,"i",29),i&2){let e=C(),o=e.$implicit,t=e.expanded;he(t?"pi pi-chevron-down":"pi pi-chevron-right"),d("pRowToggler",o)}}function kt(i,u){if(i&1&&(n(0,"td",30),c(1),l(2,"translate"),r()),i&2){let e=C(3);a(),fe(" ",s(2,2,"Before")," ",e.startDate," ")}}function Rt(i,u){if(i&1&&(n(0,"td"),c(1),r()),i&2){let e=C().$implicit;a(),f(" ",e.journal_date," ")}}function Wt(i,u){if(i&1&&(n(0,"tr")(1,"td"),w(2,Ft,1,3,"i",24),r(),w(3,kt,3,4,"td",25)(4,Rt,2,1,"td",26),n(5,"td"),c(6),r(),n(7,"td"),D(8,"p-tag",27),l(9,"translate"),r(),n(10,"td"),c(11),l(12,"translate"),r(),n(13,"td",28),c(14),l(15,"currency"),l(16,"lira"),r(),n(17,"td",28),c(18),l(19,"currency"),l(20,"lira"),r(),n(21,"td"),c(22),l(23,"currency"),l(24,"lira"),r()()),i&2){let e=u.$implicit,o=u.rowIndex,t=C(2);a(2),d("ngIf",e.order_id),a(),d("ngIf",!e.journal_date),a(),d("ngIf",e.journal_date),a(2),h(e.journal_number||"---"),a(2),d("value",s(9,12,e.journal_description))("severity",t.getSeverity(e.journal_description)),a(3),f(" ",s(12,14,e.journal_notes)||"---"," "),a(2),d("ngClass",pe(28,Vt,e.debit==0,e.debit!=0)),a(),f(" ",t.selectedCurrency==="dollar"?s(15,16,e.debit):s(16,18,e.debit)," "),a(3),d("ngClass",pe(31,Mt,e.credit==0,e.credit!=0)),a(),f(" ",t.selectedCurrency==="dollar"?s(19,20,e.credit):s(20,22,e.credit)," "),a(4),f(" ",t.selectedCurrency==="dollar"?s(23,24,t.balances[o]):s(24,26,t.balances[o])," ")}}function Lt(i,u){i&1&&(n(0,"tr")(1,"th"),c(2),l(3,"translate"),r(),n(4,"th"),c(5),l(6,"translate"),r(),n(7,"th"),c(8),l(9,"translate"),r(),n(10,"th"),c(11),l(12,"translate"),r()()),i&2&&(a(2),f(" ",s(3,4,"Description")," "),a(3),f(" ",s(6,6,"Unit Price")," "),a(3),f(" ",s(9,8,"Quantity")," "),a(3),f(" ",s(12,10,"Total Price")," "))}function At(i,u){if(i&1&&(n(0,"tr",33)(1,"td"),c(2),r(),n(3,"td"),c(4),l(5,"currency"),l(6,"lira"),r(),n(7,"td"),c(8),r(),n(9,"td"),c(10),l(11,"currency"),l(12,"lira"),r()()),i&2){let e=u.$implicit,o=C(3);a(2),f(" ",e.product_name," "),a(2),f(" ",o.selectedCurrency==="dollar"?s(5,4,e.unit_price):s(6,6,e.unit_price)," "),a(4),h(e.quantity),a(2),f(" ",o.selectedCurrency==="dollar"?s(11,8,e.total_price):s(12,10,e.total_price)," ")}}function zt(i,u){if(i&1&&(n(0,"tr"),D(1,"td"),n(2,"td",31)(3,"p-table",32),w(4,Lt,13,12,"ng-template",20)(5,At,13,12,"ng-template",21),r()(),D(6,"td"),r()),i&2){let e=u.$implicit,o=C(2);a(3),d("value",o.getFilteredDetails(e))}}function jt(i,u){if(i&1&&(n(0,"tr"),D(1,"td",34),n(2,"td"),c(3),l(4,"translate"),r(),n(5,"td",35),c(6),l(7,"currency"),l(8,"lira"),r(),n(9,"td",36),c(10),l(11,"currency"),l(12,"lira"),r(),n(13,"td",30),c(14),l(15,"currency"),l(16,"lira"),r()()),i&2){let e=C(2);a(3),h(s(4,4,"Total Balances")),a(3),f(" ",e.selectedCurrency==="dollar"?s(7,6,e.totalDebit):s(8,8,e.totalDebit)," "),a(4),f(" ",e.selectedCurrency==="dollar"?s(11,10,e.totalCredit):s(12,12,e.totalCredit)," "),a(4),f(" ",e.selectedCurrency==="dollar"?s(15,14,e.balances[e.balances.length-1]):s(16,16,e.balances[e.balances.length-1])," ")}}function Ot(i,u){if(i&1){let e=E();n(0,"div",2),D(1,"p-divider"),n(2,"p-table",19,0),_("onRowExpand",function(){g(e);let t=C();return b(t.onRowExpand())}),w(4,Pt,22,18,"ng-template",20)(5,Wt,25,34,"ng-template",21)(6,zt,7,1,"ng-template",22)(7,jt,17,18,"ng-template",23),r()()}if(i&2){let e=C();a(2),d("value",e.data)("tableStyle",I(2,Et))}}var ae=(()=>{class i{constructor(){this.customersService=v(N),this.historyService=v(Ge),this.dateService=v(Ne),this.currencyPipe=v(V),this.decimalService=v(ie),this.cashBalanceService=v(Ve),this.currencyService=v(ee),this.subscriptions=new ue,this.customers=this.customersService.customers,this.selectedCurrency=this.currencyService.defaultCurrency(),this.startDate=this.dateService.getStartOfMonth(),this.endDate=this.dateService.getCurrentDate(),this.balances=[],this.show_dollar=!0,this.data=[],this.paymentDialogVisible=!1,this.submitItemLoading=this.customersService.submitCustomerLoading,this.signal_tableLoading=this.customersService.signal_tableLoading,this.totalDebit=0,this.totalCredit=0,this.selectedOrderItems=this.historyService.selectedOrderItems,this.selectedReturnOrderItems=this.historyService.selectedReturnOrderItems,this.correctDebtDialogVisible=!1}ngOnInit(){this.selectedCustomer&&this.getStatements(),this.subscriptions.add(this.customersService.customerBalance$.subscribe(e=>{if(this.data=e,e.length>0){this.balances=[],this.balances[0]=parseFloat(e[0].balance);for(let o=1;o<e.length;o++)this.balances[o]=this.balances[o-1]+parseFloat(e[o].debit)-parseFloat(e[o].credit);this.onRowExpand(),e.length>1&&this.calculateTotals(e)}else this.balances=[]}))}ngOnDestroy(){this.subscriptions.unsubscribe(),this.customersService.customerBalance$.next([])}calculateTotals(e){this.totalDebit=0,this.totalCredit=0;for(let o=1;o<e.length;o++)this.totalDebit=this.decimalService.add(this.totalDebit,parseFloat(e[o].debit)),this.totalCredit=this.decimalService.add(this.totalCredit,parseFloat(e[o].credit))}startDateChanged(){this.startDate=this.dateService.formatDate(this.startDate,"yyyy-MM-dd"),this.resetTable(),this.getStatements()}endDateChanged(){this.endDate=this.dateService.formatDate(this.endDate,"yyyy-MM-dd"),this.resetTable(),this.getStatements()}accountChanged(){this.totalDebit=0,this.totalCredit=0,this.resetTable(),this.getStatements()}onCreatePayment(){this.getStatements(),this.customersService.getDebts(this.selectedCurrency),this.cashBalanceService.getBalance()}getStatements(){this.selectedCustomer&&this.startDate&&this.endDate&&this.selectedCurrency&&this.customersService.getCustomerBalance(this.selectedCustomer,this.startDate,this.endDate,this.selectedCurrency)}resetTable(){this.data=[],this.balances=[]}getSeverity(e){switch(e){case"Invoice":return"danger";case"Return":return"info";case"Payment Received":return"success";case"Manual Transaction":return"warning";default:return"contrast"}}onRowExpand(){let e=this.data.filter(o=>o.order_id!=null).map(o=>o.order_id);this.data.length>1&&(this.historyService.fetchOrderItemsById(e),this.historyService.fetchReturnOrderItemsById(e))}getFilteredDetails(e){if(e.journal_description=="Invoice")return this.selectedOrderItems().filter(o=>o.order_id===e.order_id);if(e.journal_description=="Return")return this.selectedReturnOrderItems().filter(o=>o.order_id===e.order_id)}formatCurrency(e){return this.selectedCurrency=="dollar"?this.currencyPipe.transform(e,"USD","symbol","1.2-2")||"":parseFloat(e).toLocaleString()+" L.L"}exportToPDF(){let e=new it;e.addFileToVFS("fonts/cairo/cairo-variable.txt","cairo"),e.addFont("fonts/cairo/Cairo-Variable.ttf","Cairo","normal"),e.setFont("Cairo");let o=e.internal.pageSize.width,t=this.customers().find(S=>S.account_id===this.selectedCustomer),p=this.dateService.getCurrentDatetime();e.setFontSize(14);let m="Statement of account",y=e.getTextWidth(m);e.text(m,(o-y)/2,10),e.setFontSize(10),e.text(`${t?.name}`,10,20),e.setFontSize(9);let H=this.dateService.formatDate(this.startDate,"yyyy-MM-dd"),Ct=this.dateService.formatDate(this.endDate,"yyyy-MM-dd");e.text(`Start Date: ${H}`,10,30),e.text(`End Date: ${Ct}`,10,35),e.text(`Generated on: ${p}`,150,30);let ht=["Datetime","Transaction #","Description","Notes","Debit","Credit","Balance"],ft=this.data.map((S,se)=>[S.journal_date?this.dateService.formatDate(S.journal_date,"yyyy-MM-dd"):`Before ${H}`,S.journal_number||"---",S.journal_description||"---",S.journal_notes||"---",{hiddenValue:S.order_id||null,content:this.formatCurrency(S.debit),styles:{textColor:S.debit==0?"#D1D5DB":"#D9342B"}},{content:this.formatCurrency(S.credit),styles:{textColor:S.credit==0?"#D1D5DB":"#1DA750"}},this.formatCurrency(this.balances[se])]),U=[];ft.forEach((S,se)=>{if(U.push(S),se>0&&S[4].hiddenValue){let St={order_id:S[4].hiddenValue,journal_description:S[2]},vt=this.getFilteredDetails(St);U.push([{content:"",styles:{fillColor:"white",border:"1px solid black"}},{content:"Description",styles:{fontStyle:"bold",fontSize:7}},{content:"Unit Price",styles:{fontStyle:"bold",fontSize:7}},{content:"Qty",styles:{fontStyle:"bold",fontSize:7}},{content:"Total",styles:{fontStyle:"bold",fontSize:7}},{content:"",styles:{fillColor:"white"}},{content:"",styles:{fillColor:"white"}}]),vt.forEach(K=>{U.push([{content:"",styles:{fillColor:"white"}},{content:K.product_name,styles:{fillColor:"#e5e7eb",fontSize:7,font:"Cairo"}},{content:this.formatCurrency(K.unit_price),styles:{fillColor:"#e5e7eb",fontSize:7}},{content:K.quantity,styles:{fillColor:"#e5e7eb",fontSize:7}},{content:this.formatCurrency(K.total_price),styles:{fillColor:"#e5e7eb",fontSize:7}},{content:"",styles:{fillColor:"white"}},{content:"",styles:{fillColor:"white"}}])})}}),nt(e,{startY:40,head:[ht],body:U,styles:{halign:"center",fontSize:8},headStyles:{fillColor:"F9FAFB",textColor:"#4B5563"},footStyles:{fillColor:"F9FAFB",textColor:"#4B5563"}}),e.setFontSize(10);let le=e.lastAutoTable.finalY||20,gt=`Total Debit: ${this.formatCurrency(this.totalDebit)}`,de=`Total Credit: ${this.formatCurrency(this.totalCredit)}`,me=`Balance Due: ${this.formatCurrency(this.balances[this.balances.length-1])}`,bt=e.getTextWidth(de),yt=e.getTextWidth(me);e.text(gt,20,le+10),e.text(de,(o-bt)/2,le+10),e.text(me,o-yt-15,le+10),e.save(`${t?.name}-statement.pdf`)}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=R({type:i,selectors:[["customer-statements"]],viewQuery:function(o,t){if(o&1&&P(Bt,5),o&2){let p;F(p=k())&&(t.dt=p.first)}},inputs:{selectedCustomer:"selectedCustomer",selectedCurrency:"selectedCurrency"},decls:45,vars:61,consts:[["dt",""],[1,"grid","m-1"],[1,"col-12"],[1,"grid"],[1,"col-12","md:col-2"],[1,"flex","flex-column","gap-1"],["optionLabel","name","optionValue","account_id","styleClass","p-inputtext-sm","appendTo","body",3,"ngModelChange","onChange","options","ngModel","placeholder","showClear","loading","autoOptionFocus","filter"],["styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","appendTo","body",3,"ngModelChange","onSelect","ngModel","showIcon","iconDisplay","readonlyInput"],[1,"col-12","md:col-1"],["styleClass","p-inputtext-sm","appendTo","body",3,"ngModelChange","onChange","options","ngModel","placeholder","loading","autoOptionFocus"],[1,"col-6","md:col-1","mt-auto"],["size","small","icon","pi pi-refresh","styleClass","w-full",3,"onClick","label","loading","disabled"],["severity","help","size","small","icon","pi pi-file-pdf","styleClass","w-full",3,"onClick","label","disabled"],[1,"col-6","md:col-2","mt-auto"],["size","small","icon","pi pi-dollar","severity","success","styleClass","w-full",3,"onClick","label","disabled"],["size","small","icon","pi pi-dollar","severity","warning","styleClass","w-full",3,"onClick","label","disabled"],["class","col-12",4,"ngIf"],[3,"visibleChange","onCreate","visible","account_id","currency"],[3,"onClose","onSubmit","visible","accounts","account"],["dataKey","journal_id","styleClass","p-datatable-sm",1,"ledger_table",3,"onRowExpand","value","tableStyle"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["pTemplate","footer"],["style","cursor: pointer",3,"class","pRowToggler",4,"ngIf"],["class","font-bold",4,"ngIf"],[4,"ngIf"],[3,"value","severity"],[3,"ngClass"],[2,"cursor","pointer",3,"pRowToggler"],[1,"font-bold"],["colspan","5"],["styleClass","p-datatable-sm",3,"value"],[1,"bg-success"],["colspan","4"],[1,"text-red-600"],[1,"text-green-600"]],template:function(o,t){o&1&&(n(0,"div",1)(1,"div",2)(2,"p-card")(3,"div",3)(4,"div",4)(5,"div",5)(6,"label"),c(7),l(8,"translate"),r(),n(9,"p-dropdown",6),l(10,"translate"),B("ngModelChange",function(m){return T(t.selectedCustomer,m)||(t.selectedCustomer=m),m}),_("onChange",function(){return t.accountChanged()}),r()()(),n(11,"div",4)(12,"div",5)(13,"label"),c(14),l(15,"translate"),r(),n(16,"p-calendar",7),B("ngModelChange",function(m){return T(t.startDate,m)||(t.startDate=m),m}),_("onSelect",function(){return t.startDateChanged()}),r()()(),n(17,"div",4)(18,"div",5)(19,"label"),c(20),l(21,"translate"),r(),n(22,"p-calendar",7),B("ngModelChange",function(m){return T(t.endDate,m)||(t.endDate=m),m}),_("onSelect",function(){return t.endDateChanged()}),r()()(),n(23,"div",8)(24,"div",5)(25,"label"),c(26),l(27,"translate"),r(),n(28,"p-dropdown",9),l(29,"translate"),B("ngModelChange",function(m){return T(t.selectedCurrency,m)||(t.selectedCurrency=m),m}),_("onChange",function(){return t.accountChanged()}),r()()(),n(30,"div",10)(31,"p-button",11),l(32,"translate"),_("onClick",function(){return t.getStatements()}),r()(),n(33,"div",10)(34,"p-button",12),l(35,"translate"),_("onClick",function(){return t.exportToPDF()}),r()(),n(36,"div",13)(37,"p-button",14),l(38,"translate"),_("onClick",function(){return t.paymentDialogVisible=!0}),r()(),n(39,"div",10)(40,"p-button",15),l(41,"translate"),_("onClick",function(){return t.correctDebtDialogVisible=!0}),r()(),w(42,Ot,8,3,"div",16),r()()(),n(43,"payment-dialog",17),B("visibleChange",function(m){return T(t.paymentDialogVisible,m)||(t.paymentDialogVisible=m),m}),_("onCreate",function(){return t.onCreatePayment()}),r(),n(44,"correct-debt",18),_("onClose",function(){return t.correctDebtDialogVisible=!1})("onSubmit",function(){return t.getStatements()}),r()()),o&2&&(a(7),h(s(8,40,"Select Customer")),a(2),d("options",t.customers()),x("ngModel",t.selectedCustomer),d("placeholder",s(10,42,"Select Customer"))("showClear",!0)("loading",t.signal_tableLoading())("autoOptionFocus",!1)("filter",!0),a(5),h(s(15,44,"Start Date")),a(2),x("ngModel",t.startDate),d("showIcon",!0)("iconDisplay","input")("readonlyInput",!0),a(4),h(s(21,46,"End Date")),a(2),x("ngModel",t.endDate),d("showIcon",!0)("iconDisplay","input")("readonlyInput",!0),a(4),h(s(27,48,"Account")),a(2),d("options",I(60,It)),x("ngModel",t.selectedCurrency),d("placeholder",s(29,50,"Currency"))("loading",t.signal_tableLoading())("autoOptionFocus",!1),a(3),d("label",s(32,52,"Refresh"))("loading",t.submitItemLoading())("disabled",!t.selectedCustomer),a(3),d("label",s(35,54,"Export"))("disabled",!t.selectedCustomer),a(3),d("label",s(38,56,"Receive Payment"))("disabled",!t.selectedCustomer),a(3),d("label",s(41,58,"Correct"))("disabled",!t.selectedCustomer),a(2),d("ngIf",t.data.length>0),a(),x("visible",t.paymentDialogVisible),d("account_id",t.selectedCustomer)("currency",t.selectedCurrency),a(),d("visible",t.correctDebtDialogVisible)("accounts",t.customers())("account",t.selectedCustomer))},dependencies:[ge,G,J,X,L,M,Ae,z,te,A,et,je,Re,Q,ne,V,j,O],styles:["[_nghost-%COMP%]  .p-card-content{padding:0!important}.bg-success[_ngcontent-%COMP%]{background-color:#d3d3d3}"]})}}return i})();var Ht=["tableSearch"],Ut=()=>[10,15,50,100],Kt=()=>["name","balance"],qt=()=>({width:"95vw"}),Yt=()=>["dollar","lira"];function $t(i,u){if(i&1){let e=E();n(0,"span",15),D(1,"i",16),n(2,"input",17,1),l(4,"translate"),_("input",function(t){g(e),C();let p=W(8);return b(p.filterGlobal(t.target.value,"contains"))}),r()(),n(5,"p-button",18),l(6,"translate"),_("onClick",function(){g(e);let t=C();return b(t.refreshDebts())}),r()}if(i&2){let e=C(),o=W(8);a(2),d("placeholder",s(4,4,"Search ..."))("value",o.filters.global==null?null:o.filters.global.value),a(3),d("label",s(6,6,"Refresh"))("loading",e.debtsLoading())}}function Gt(i,u){if(i&1){let e=E();n(0,"label",19),c(1),l(2,"translate"),r(),n(3,"p-dropdown",20),B("ngModelChange",function(t){g(e);let p=C();return T(p.selectedCurrency,t)||(p.selectedCurrency=t),b(t)}),_("ngModelChange",function(){g(e);let t=C();return b(t.refreshDebts())}),r()}if(i&2){let e=C();a(),h(s(2,4,"Account")),a(2),d("options",I(6,Yt)),x("ngModel",e.selectedCurrency),d("autoOptionFocus",!1)}}function Jt(i,u){if(i&1&&(n(0,"h3"),c(1),l(2,"translate"),n(3,"span",21),c(4),l(5,"currency"),l(6,"lira"),r()()),i&2){let e=C();a(),f(" ",s(2,2,"Total Debts:")," "),a(3),h(e.selectedCurrency==="dollar"?s(5,4,e.calculateTotalDepts()):s(6,6,e.calculateTotalDepts()))}}function Xt(i,u){i&1&&(n(0,"tr")(1,"th",22),c(2),l(3,"translate"),r(),n(4,"th",23),c(5),l(6,"translate"),r(),n(7,"th",24),c(8),l(9,"translate"),r(),n(10,"th",24),c(11),l(12,"translate"),r(),n(13,"th",25),c(14),l(15,"translate"),r()()),i&2&&(a(2),f("",s(3,5,"Account")," #"),a(3),h(s(6,7,"Customer Name")),a(3),h(s(9,9,"Customer Phone")),a(3),h(s(12,11,"Balance")),a(3),f(" ",s(15,13,"Options")," "))}function Zt(i,u){if(i&1){let e=E();n(0,"tr")(1,"td"),c(2),r(),n(3,"td"),c(4),r(),n(5,"td"),c(6),r(),n(7,"td"),c(8),l(9,"currency"),l(10,"lira"),r(),n(11,"td")(12,"p-button",26),_("onClick",function(){let t=g(e).$implicit,p=C();return b(p.openWhatsappChat(t.phone))}),r(),n(13,"p-button",27),l(14,"translate"),_("onClick",function(){let t=g(e).$implicit,p=C();return b(p.showStatement(t))}),r(),n(15,"p-button",28),l(16,"translate"),_("onClick",function(){let t=g(e).$implicit,p=C();return b(p.showPaymentDialog(t))}),r()()()}if(i&2){let e=u.$implicit,o=C();a(2),h(e.account_id),a(2),h(e.name),a(2),h(e.phone||"---"),a(2),f(" ",o.selectedCurrency==="dollar"?s(9,7,e.balance):s(10,9,e.balance)," "),a(4),d("disabled",!e.phone),a(),d("label",s(14,11,"Statement")),a(2),d("label",s(16,13,"Payment"))}}function ei(i,u){i&1&&(n(0,"tr")(1,"td",29),c(2,"No records yet!"),r()())}function ti(i,u){if(i&1&&D(0,"customer-statements",30),i&2){let e=C();d("selectedCustomer",e.selectedCustomerId)}}function ii(i,u){if(i&1){let e=E();n(0,"p-button",31),l(1,"translate"),_("onClick",function(){g(e);let t=C();return b(t.hideStatementDialog())}),r()}i&2&&d("label",s(1,1,"Close"))}var mt=(()=>{class i{constructor(){this.customersService=v(N),this.decimalService=v(ie),this.currencyService=v(ee),this.debts=this.customersService.debts,this.debtsLoading=this.customersService.debtsLoading,this.selectedCurrency=this.currencyService.defaultCurrency(),this.statementDialogVisible=!1,this.totalDebts=0,this.paymentDialogVisible=!1,this.whatsappTab=null}ngOnInit(){this.refreshDebts()}refreshDebts(){this.customersService.getDebts(this.selectedCurrency)}showStatement(e){this.selectedCustomerId=e.account_id,this.statementDialogVisible=!0}hideStatementDialog(){this.statementDialogVisible=!1}calculateTotalDepts(){let e=0,o=this.debts();return o.length>0&&o.forEach(t=>{e=this.decimalService.add(e,t.balance)}),e}onKeyDown(e){this.statementDialogVisible||this.paymentDialogVisible||(this.tableSearch.nativeElement.focus(),e.key=="Enter"&&this.tableSearch.nativeElement.select())}showPaymentDialog(e){this.selectedCustomerId=e.account_id,this.paymentDialogVisible=!0}onCreatePayment(){this.refreshDebts()}openWhatsappChat(e){let o=e.replace(/\s+/g,"");o.startsWith("0")&&(o=o.substring(1));let p=`https://wa.me/${`961${o}`}`;window.open(p,"_blank")}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=R({type:i,selectors:[["app-debts"]],viewQuery:function(o,t){if(o&1&&P(Ht,5),o&2){let p;F(p=k())&&(t.tableSearch=p.first)}},hostBindings:function(o,t){o&1&&_("keydown",function(m){return t.onKeyDown(m)},!1,$)},decls:16,vars:21,consts:[["dt2",""],["tableSearch",""],[1,"grid","m-1"],[1,"col-12"],["pTemplate","left"],["pTemplate","center"],["pTemplate","right"],["styleClass","p-datatable-sm","dataKey","account_id","currentPageReportTemplate","Showing {first} to {last} of {totalRecords} records",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"visibleChange","onCreate","visible","account_id","mode"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["pInputText","","type","search",1,"p-inputtext-sm",3,"input","placeholder","value"],["icon","pi pi-refresh","size","small","styleClass","mx-2 ",3,"onClick","label","loading"],[1,"mr-2"],["placeholder","Select currency...","styleClass","p-inputtext-sm","appendTo","body",3,"ngModelChange","options","ngModel","autoOptionFocus"],[1,"text-red-500"],["width","10%"],["width","35%"],["width","15%"],["width","25%","colspan","3"],["size","small","icon","pi pi-whatsapp","severity","success",3,"onClick","disabled"],["size","small","severity","secondary","icon","pi pi-book","styleClass","mx-2",3,"onClick","label"],["size","small","severity","success","icon","pi pi-money-bill",3,"onClick","label"],["colspan","5"],[3,"selectedCustomer"],["size","small","icon","pi pi-times","severity","secondary",3,"onClick","label"]],template:function(o,t){if(o&1){let p=E();n(0,"div",2)(1,"div",3)(2,"p-card")(3,"p-toolbar"),w(4,$t,7,8,"ng-template",4)(5,Gt,4,7,"ng-template",5)(6,Jt,7,8,"ng-template",6),r(),n(7,"p-table",7,0),w(9,Xt,16,15,"ng-template",8)(10,Zt,17,15,"ng-template",9)(11,ei,3,0,"ng-template",10),r()()()(),n(12,"p-dialog",11),B("visibleChange",function(y){return g(p),T(t.statementDialogVisible,y)||(t.statementDialogVisible=y),b(y)}),_("onHide",function(){return g(p),b(t.hideStatementDialog())}),w(13,ti,1,1,"ng-template",12)(14,ii,2,3,"ng-template",13),r(),n(15,"payment-dialog",14),B("visibleChange",function(y){return g(p),T(t.paymentDialogVisible,y)||(t.paymentDialogVisible=y),b(y)}),_("onCreate",function(){return g(p),b(t.onCreatePayment())}),r()}o&2&&(a(7),d("value",t.debts())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",I(18,Ut))("alwaysShowPaginator",!0)("globalFilterFields",I(19,Kt))("filterDelay",0)("loading",t.debtsLoading()),a(5),Ce(I(20,qt)),x("visible",t.statementDialogVisible),d("modal",!0)("closable",!0)("maximizable",!0),a(3),x("visible",t.paymentDialogVisible),d("account_id",t.selectedCustomerId)("mode","add"))},dependencies:[J,X,L,M,z,Me,qe,Z,te,A,Q,ae,V,j,O]})}}return i})();var ni=["tableSearch"],oi=()=>[10,15,50,100],ri=()=>["name","phone","financial_number"];function ai(i,u){i&1&&(n(0,"th"),c(1),l(2,"translate"),r()),i&2&&(a(),f(" ",s(2,1,"Default Discount %")," "))}function li(i,u){if(i&1&&(n(0,"tr")(1,"th",20),c(2),l(3,"translate"),r(),n(4,"th",21),c(5),l(6,"translate"),r(),n(7,"th",22),c(8),l(9,"translate"),r(),w(10,ai,3,3,"th",23),r()),i&2){let e=C();a(2),f(" ",s(3,4,"Customer Name")," "),a(3),f(" ",s(6,6,"Customer Phone")," "),a(3),h(s(9,8,"Address")),a(2),d("ngIf",e.discountInputEnabled())}}function si(i,u){if(i&1&&(n(0,"td"),c(1),r()),i&2){let e=C().$implicit;a(),f(" ",e.default_discount," % ")}}function pi(i,u){if(i&1&&(n(0,"tr",24)(1,"td"),c(2),r(),n(3,"td"),c(4),r(),n(5,"td"),c(6),r(),w(7,si,2,1,"td",23),r()),i&2){let e=u.$implicit,o=u.rowIndex,t=C();_e("glowing",t.glowingRowIndex()===o),d("pSelectableRow",e),a(2),h(e.name),a(2),h(e.phone||" --- "),a(2),h(e.address||" --- "),a(),d("ngIf",t.discountInputEnabled())}}function ci(i,u){i&1&&(n(0,"tr")(1,"td",25),c(2,"No customers yet!"),r()())}var ut=(()=>{class i{constructor(){this.customerService=v(N),this.confirmationService=v(ye),this.discountSettingService=v(Ke),this.translate=v(Ie),this.paymentDialogVisible=!1,this.customers=this.customerService.customers,this.selectedCustomer=this.customerService.selectedCustomer,this.submitted=!1,this.customerDialogVisible=this.customerService.customerDialogVisible,this.submitLoading=this.customerService.submitCustomerLoading,this.tableLoading=this.customerService.signal_tableLoading,this.discountInputEnabled=this.discountSettingService.discountInputEnabled,this.glowingRowIndex=this.customerService.glowingRowIndex}onKeyDown(e){!this.customerDialogVisible&&!this.paymentDialogVisible&&this.tableSearch.nativeElement.focus()}select(e){e.select()}openCustomerDialog(e){this.dialogMode=e,this.customerDialogVisible.set(!0)}onCreateCustomer(e){this.customers.set([...this.customers(),e])}onUpdateCustomer(e){let o=this.customers().findIndex(t=>t.account_id===e.account_id);this.customers.update(t=>[...t.slice(0,o),e,...t.slice(o+1)]),this.customerService.selectedCustomer.set(e)}deleteSelectedCustomer(){this.confirmationService.confirm({key:"home",message:this.translate.instant("Are you sure you want to continue ?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.customerService.deleteCustomer(this.selectedCustomer()),this.customerService.selectedCustomer.set(null)}})}resetTable(){this.customerService.getCustomers()}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=R({type:i,selectors:[["app-accounts"]],viewQuery:function(o,t){if(o&1&&(P(M,5),P(ni,5)),o&2){let p;F(p=k())&&(t.ct=p.first),F(p=k())&&(t.tableSearch=p.first)}},hostBindings:function(o,t){o&1&&_("keydown",function(m){return t.onKeyDown(m)},!1,$)},decls:29,vars:34,consts:[["tableSearch",""],["ct",""],[1,"grid","md:mr-8","md:ml-8","m-1"],[1,"col-12"],[1,"grid"],[1,"col-8","md:col-4"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["id","globalFilter","pInputText","","type","search",1,"p-inputtext-sm",3,"input","placeholder","value"],[1,"col-4","md:col-2"],["icon","pi pi-refresh","severity","primary","size","small","styleClass","w-full",3,"onClick","label","loading"],["icon","pi pi-plus","styleClass"," w-full","size","small","severity","success",3,"onClick","label"],[1,"col-4","md:col-1"],["icon","pi pi-file-edit","styleClass","w-full","severity","warning","size","small",3,"onClick","label","disabled"],["icon","pi pi-trash","styleClass","p-button-sm w-full","severity","danger",3,"onClick","label","disabled"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single","dataKey","account_id",3,"selectionChange","value","selection","paginator","rows","loading","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"visibleChange","onCreate","onUpdate","visible","mode","customer"],["width","35%"],["width","20%"],["width","30%"],[4,"ngIf"],[3,"pSelectableRow"],["colspan","5"]],template:function(o,t){if(o&1){let p=E();n(0,"div",2)(1,"div",3)(2,"p-card")(3,"div",4)(4,"div",5)(5,"span",6),D(6,"i",7),n(7,"input",8,0),l(9,"translate"),_("input",function(y){g(p);let H=W(24);return b(H.filterGlobal(y.target.value,"contains"))}),r()()(),n(10,"div",9)(11,"p-button",10),l(12,"translate"),_("onClick",function(){return g(p),b(t.resetTable())}),r()(),n(13,"div",9)(14,"p-button",11),l(15,"translate"),_("onClick",function(){return g(p),b(t.openCustomerDialog("add"))}),r()(),n(16,"div",12)(17,"p-button",13),l(18,"translate"),_("onClick",function(){return g(p),b(t.openCustomerDialog("edit"))}),r()(),n(19,"div",12)(20,"p-button",14),l(21,"translate"),_("onClick",function(){return g(p),b(t.deleteSelectedCustomer())}),r()()(),n(22,"div",3)(23,"p-table",15,1),B("selectionChange",function(y){return g(p),T(t.selectedCustomer,y)||(t.selectedCustomer=y),b(y)}),w(25,li,11,10,"ng-template",16)(26,pi,8,7,"ng-template",17)(27,ci,3,0,"ng-template",18),r()()()()(),n(28,"customer-dialog",19),B("visibleChange",function(y){return g(p),T(t.customerDialogVisible,y)||(t.customerDialogVisible=y),b(y)}),_("onCreate",function(y){return g(p),b(t.onCreateCustomer(y))})("onUpdate",function(y){return g(p),b(t.onUpdateCustomer(y))}),r()}if(o&2){let p=W(24);a(7),d("placeholder",s(9,22,"Search ..."))("value",p.filters.global==null?null:p.filters.global.value),a(4),d("label",s(12,24,"Refresh"))("loading",t.tableLoading()),a(3),d("label",s(15,26,"New")),a(3),d("label",s(18,28,"Edit"))("disabled",!t.selectedCustomer()),a(3),d("label",s(21,30,"Delete"))("disabled",!t.selectedCustomer()),a(3),d("value",t.customers()),x("selection",t.selectedCustomer),d("paginator",!0)("rows",10)("loading",t.tableLoading())("showCurrentPageReport",!0)("rowsPerPageOptions",I(32,oi))("alwaysShowPaginator",!0)("globalFilterFields",I(33,ri))("filterDelay",0),a(5),x("visible",t.customerDialogVisible),d("mode",t.dialogMode)("customer",t.selectedCustomer())}},dependencies:[G,L,M,Le,z,Z,A,oe,j]})}}return i})();var di=[{path:"statements",data:{breadcrumb:"Statements"},component:ae},{path:"debts",data:{breadcrumt:"Debts"},component:mt},{path:"accounts",data:{breadcrumb:"Accounts"},component:ut},{path:"**",redirectTo:"/customers/statements"}],_t=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=Y({type:i})}static{this.\u0275inj=q({imports:[ce.forChild(di),ce]})}}return i})();var jn=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=Y({type:i})}static{this.\u0275inj=q({providers:[V,O],imports:[be,_t,Se,ve,ot,Ee,ze,rt,Qe,Te,Pe,Ye,xe,Be,Xe,Ue,Fe,$e,ke,He,we,tt,De,Ze,Oe,We,Q,ne,Je,oe]})}}return i})();export{jn as CustomersModule};
