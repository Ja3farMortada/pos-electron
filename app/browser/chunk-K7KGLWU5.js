import{a as bt,b as gt,c as St}from"./chunk-KYEXICW3.js";import{a as _e}from"./chunk-IBNWSIW5.js";import{b as _t}from"./chunk-SVHA7J7U.js";import"./chunk-TQK45RMZ.js";import"./chunk-4ONBVWLA.js";import{b as lt}from"./chunk-UIPYUTXU.js";import{b as Ke}from"./chunk-23C7B2M2.js";import{a as ut}from"./chunk-ARZ4TFMZ.js";import{a as he}from"./chunk-NYOORQFW.js";import{b as at}from"./chunk-XGV4AIQT.js";import{a as q}from"./chunk-QLTNVVXU.js";import{a as dt}from"./chunk-IQTEOPEP.js";import{a as Ye}from"./chunk-SBLJNY6Q.js";import"./chunk-KICUZIBO.js";import{a as ht,b as ft}from"./chunk-B5UDKY34.js";import{a as nt,b as de}from"./chunk-FA4OBAKY.js";import"./chunk-EA4RMISB.js";import{a as mt}from"./chunk-FO7TG3S7.js";import{a as pt,b as ct}from"./chunk-42BTCZ3Y.js";import{b as st}from"./chunk-7QYRFDGN.js";import"./chunk-UVEVFGTS.js";import{d as it,e as ot,f as rt}from"./chunk-NEQPNYWW.js";import{c as ue}from"./chunk-AFTSMEUE.js";import{F as tt,i as se,j as pe,l as Je,m as ce,p as Xe,q as me,u as j,x as Ze,y as et}from"./chunk-LBGQA5HW.js";import"./chunk-4A2WLUYH.js";import{b as ae,c as z}from"./chunk-VVKQAEX7.js";import{a as Qe,b as He}from"./chunk-FW7KDDDM.js";import{Ba as E,C as f,Ca as V,D as k,Da as I,E as K,Ea as Se,Eb as ye,Fa as p,Ga as u,Ha as y,J as Te,Ja as w,Jb as Z,K as g,Ka as T,L as S,La as F,Na as Ve,Oa as M,P as ge,Pa as A,Qa as $,Qc as $e,Rc as le,Sb as N,Vb as Pe,Wb as ke,X as Fe,Xa as l,Y as a,Ya as s,Yb as Ae,_b as P,a as De,ac as ee,bc as Re,cc as Ne,da as Y,eb as Ce,ec as L,fc as Le,ga as D,gb as J,gc as We,hc as ze,ia as m,ib as Ie,ic as je,jc as qe,kc as Oe,la as Be,lc as te,ma as Ee,mb as R,mc as ie,nb as X,oa as o,pa as r,pb as Me,qa as x,qc as Ue,ua as B,uc as Ge,va as _,wa as b,wc as W,xc as ne,y as we,yc as oe,z as G,zc as re}from"./chunk-DSVZHE42.js";import"./chunk-GAL4ENT6.js";var Ct=(()=>{class i{constructor(){this.http=f(Me),this.api=f(ke),this.notificationService=f(Pe),this.loading=Y(!1),this.dialogVisible=Y(!1),this.submitEmitted=Y(null)}addManualDebt(e){this.loading.set(!0),this.http.post(`${this.api.host()}/suppliers/debts`,e).subscribe({next:n=>{this.notificationService.showSuccess("Debt added successfully!","home")},error:n=>{this.loading.set(!1),this.notificationService.showError(n.error,"home")},complete:()=>{this.loading.set(!1),this.submitEmitted.set({action:"add"}),this.dialogVisible.set(!this.dialogVisible())}})}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=we({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Lt=["amountInput"],Wt=["supplierDropdown"],zt=()=>({width:"75vw"}),jt=()=>({"1199px":"85vw","575px":"95vw"}),H=i=>({"ng-invalid ng-dirty":i});function qt(i,h){if(i&1){let e=B();o(0,"form",5),_("ngSubmit",function(){g(e);let t=b();return S(t.submit())}),o(1,"div",6)(2,"div",7)(3,"div",8)(4,"label",9),p(5),l(6,"translate"),o(7,"span",10),p(8," *"),r()(),o(9,"p-dropdown",11),l(10,"translate"),_("onChange",function(){g(e);let t=b();return S(t.getSupplierBalance())}),r()()(),o(11,"div",7)(12,"label"),p(13),l(14,"translate"),o(15,"span",12),p(16,"*"),r()(),x(17,"p-dropdown",13),l(18,"translate"),r(),o(19,"div",7)(20,"div",8)(21,"label",14),p(22),l(23,"translate"),o(24,"span",10),p(25," *"),r()(),o(26,"p-inputNumber",15,0),_("onFocus",function(t){g(e);let c=b();return S(c.selectInput(t))}),r()()(),o(28,"div",7)(29,"label"),p(30),l(31,"translate"),r(),o(32,"p-inputNumber",16,1),_("onFocus",function(t){g(e);let c=b();return S(c.selectInput(t))}),r(),o(34,"small"),p(35),l(36,"translate"),r()(),o(37,"div",17)(38,"label"),p(39),l(40,"translate"),o(41,"span",10),p(42," *"),r()(),x(43,"input",18),r()()()}if(i&2){let e=b();m("formGroup",e.correctDebtForm),a(5),u(s(6,29,"Supplier")),a(4),m("options",e.accounts)("placeholder",s(10,31,"Select Supplier"))("required",!0)("filter",!0)("showClear",!0)("autoOptionFocus",!1)("ngClass",A(45,H,(e.selected_account==null?null:e.selected_account.invalid)&&((e.selected_account==null?null:e.selected_account.dirty)||(e.selected_account==null?null:e.selected_account.touched)||e.submitted))),a(4),u(s(14,33,"Option")),a(4),m("autoOptionFocus",!1)("options",e.transactionOptions)("placeholder",s(18,35,"transaction type"))("required",!0)("ngClass",A(47,H,(e.transaction_type==null?null:e.transaction_type.invalid)&&((e.transaction_type==null?null:e.transaction_type.dirty)||(e.transaction_type==null?null:e.transaction_type.touched)||e.submitted))),a(5),u(s(23,37,"Amount")),a(4),m("required",!0)("autofocus",e.selected_account)("step",1)("min",0)("ngClass",A(49,H,(e.amount==null?null:e.amount.invalid)&&((e.amount==null?null:e.amount.dirty)||(e.amount==null?null:e.amount.touched)||e.submitted))),a(4),u(s(31,39,"LBP amount")),a(2),m("required",!0)("step",1e3)("min",0)("ngClass",A(51,H,e.submitted&&!e.amount)),a(3),u(s(36,41,"LBP payments are reference only, payments are always submitted in USD")),a(4),u(s(40,43,"Notes")),a(4),m("ngClass",A(53,H,(e.transaction_notes==null?null:e.transaction_notes.invalid)&&((e.transaction_notes==null?null:e.transaction_notes.dirty)||(e.transaction_notes==null?null:e.transaction_notes.touched)||e.submitted)))}}function Ot(i,h){if(i&1){let e=B();o(0,"p-button",19),l(1,"translate"),_("onClick",function(){g(e);let t=b();return S(t.closeDialog())}),r(),o(2,"p-button",20),l(3,"translate"),_("onClick",function(){g(e);let t=b();return S(t.submit())}),r()}if(i&2){let e=b();m("label",s(1,4,"Cancel"))("disabled",e.loading()),a(2),m("label",s(3,6,"Submit"))("loading",e.loading())}}var fe=(()=>{class i{ngOnChanges(e){e.visible&&e.visible.currentValue&&(this.correctDebtForm.patchValue({selected_account:this.account,amount:0}),this.location==="home"&&this.correctDebtForm.patchValue({transaction_type:"ADD"}),this.getSupplierBalance())}constructor(){this.visible=!1,this.accounts=[],this.dialog_mode="add",this.type="supplier",this.location="",this.onClose=new ge,this.onSubmit=new ge,this.supplierDebtService=f(Ct),this.suppliersService=f(q),this.confirmationService=f(Z),this.dateService=f(ue),this.decimalService=f(ot),this.fb=f(Oe),this.stockService=f(it),this.dollarPipe=f(rt),this.translate=f(ae),this.submitted=!1,this.loading=this.supplierDebtService.loading,this.exchangeRate=this.stockService.exchangeRate,this.transactionOptions=[{name:this.translate.instant("Add Debt"),value:"ADD"},{name:this.translate.instant("Remove Debt"),value:"REMOVE"}],this.supplier_balance_loading=this.suppliersService.signal_balanceLoading,this.supplier_balance=this.suppliersService.supplierBalance$,Ce(()=>{this.supplierDebtService.dialogVisible(),this.onClose.emit()}),Ce(()=>{this.supplierDebtService.submitEmitted(),this.onSubmit.emit()}),this.correctDebtForm=this.fb.group({selected_account:[null,P.required],transaction_datetime:[this.dateService.getFullDatetime()],transaction_type:[{value:null,disabled:!1},P.required],amount:[0,[P.required,P.min(.1)]],lbpAmount:[0],transaction_notes:[null,P.required],exchange_rate:[this.exchangeRate().rate_value]}),this.setupValueChanges()}setupValueChanges(){this.correctDebtForm.get("amount")?.valueChanges.subscribe(e=>{if(e!==null){let n=this.dollarPipe.calculate(e);this.correctDebtForm.get("lbpAmount")?.setValue(n,{emitEvent:!1})}}),this.correctDebtForm.get("lbpAmount")?.valueChanges.subscribe(e=>{if(e!==null){let n=e/this.exchangeRate().rate_value;this.correctDebtForm.get("amount")?.setValue(n,{emitEvent:!1})}})}get selected_account(){return this.correctDebtForm.get("selected_account")}get transaction_type(){return this.correctDebtForm.get("transaction_type")}get amount(){return this.correctDebtForm.get("amount")}get transaction_notes(){return this.correctDebtForm.get("transaction_notes")}selectInput(e){e.target.select()}closeDialog(){this.visible=!1,this.submitted=!1,this.correctDebtForm.reset({amount:0}),this.onClose.emit()}submit(){this.submitted=!0,this.correctDebtForm.valid&&(this.correctDebtForm.patchValue({transaction_datetime:this.dateService.getFullDatetime()}),this.supplierDebtService.addManualDebt(this.correctDebtForm.value))}getSupplierBalance(){let e=this.correctDebtForm.controls.selected_account.value;e?this.suppliersService.getAccountTotalBalance(e):this.suppliersService.supplierTotalDebts$.set({id:0,balance:"0"})}calculateNewBalance(e=0,n=0){return e=parseFloat(e),this.decimalService.subtract(e,n)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=k({type:i,selectors:[["correct-supplier-debt"]],viewQuery:function(n,t){if(n&1&&(E(Lt,5),E(Wt,5)),n&2){let c;V(c=I())&&(t.amountInput=c.first),V(c=I())&&(t.supplierDropdown=c.first)}},inputs:{visible:"visible",accounts:"accounts",account:"account",selected_payment:"selected_payment",dialog_mode:"dialog_mode",type:"type",location:"location"},outputs:{onClose:"onClose",onSubmit:"onSubmit"},standalone:!0,features:[Te,Ve],decls:4,vars:13,consts:[["amountInput",""],["liraInput",""],["position","top","styleClass","p-fluid",3,"visibleChange","onHide","header","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-3"],[1,"flex","flex-column","gap-2"],["for","supplier"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","formControlName","selected_account","filterBy","name",3,"onChange","options","placeholder","required","filter","showClear","autoOptionFocus","ngClass"],[1,"text-red-600"],["styleClass","p-inputtext-sm","scrollHeight","400px","appendTo","body","formControlName","transaction_type","optionLabel","name","optionValue","value",3,"autoOptionFocus","options","placeholder","required","ngClass"],["for","amount"],["styleClass","input-align-center","formControlName","amount","mode","currency","currency","USD","locale","en-US",1,"p-inputtext-sm",3,"onFocus","required","autofocus","step","min","ngClass"],["styleClass","input-align-center","formControlName","lbpAmount","mode","currency","currency","LBP","locale","en-LB",1,"p-inputtext-sm",3,"onFocus","required","step","min","ngClass"],[1,"field","col-12","md:col-6"],["type","text","spellcheck","false","pInputText","","formControlName","transaction_notes",1,"w-full","p-inputtext-sm",3,"ngClass"],["icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","disabled"],["icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","loading"]],template:function(n,t){n&1&&(o(0,"p-dialog",2),l(1,"translate"),F("visibleChange",function(d){return T(t.visible,d)||(t.visible=d),d}),_("onHide",function(){return t.closeDialog()}),D(2,qt,44,55,"ng-template",3)(3,Ot,4,8,"ng-template",4),r()),n&2&&(Be(M(11,zt)),m("header",s(1,9,"Modify Debts"))("modal",!0),w("visible",t.visible),m("breakpoints",M(12,jt))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[le,$e,N,ne,W,re,oe,ce,Je,pe,se,X,J,te,We,Ae,ee,Re,qe,ie,ze,je,me,de,z]})}}return i})();var Gt=["dt"],Kt=()=>({"min-width":"45rem"}),Yt=(i,h)=>({"text-300":i,"text-red-600":h}),$t=(i,h)=>({"text-300":i,"text-green-600":h}),Jt=(i,h)=>({"text-green-600":i,"text-red-600":h});function Xt(i,h){i&1&&(o(0,"tr"),x(1,"th"),o(2,"th"),p(3),l(4,"translate"),r(),o(5,"th"),p(6,"#"),r(),o(7,"th"),p(8),l(9,"translate"),r(),o(10,"th"),p(11),l(12,"translate"),r(),o(13,"th"),p(14),l(15,"translate"),r(),o(16,"th"),p(17),l(18,"translate"),r(),o(19,"th"),p(20),l(21,"translate"),r()()),i&2&&(a(3),u(s(4,6,"Date")),a(5),u(s(9,8,"Description")),a(3),u(s(12,10,"Notes")),a(3),u(s(15,12,"Debit")),a(3),u(s(18,14,"Credit")),a(3),u(s(21,16,"Balance")))}function Zt(i,h){if(i&1&&x(0,"i",24),i&2){let e=b(),n=e.$implicit,t=e.expanded;Ee(t?"pi pi-chevron-down":"pi pi-chevron-right"),m("pRowToggler",n)}}function ei(i,h){if(i&1&&(o(0,"tr")(1,"td"),D(2,Zt,1,3,"i",21),r(),o(3,"td"),p(4),r(),o(5,"td"),p(6),r(),o(7,"td"),x(8,"p-tag",22),l(9,"translate"),r(),o(10,"td"),p(11),r(),o(12,"td",23),p(13),l(14,"currency"),r(),o(15,"td",23),p(16),l(17,"currency"),r(),o(18,"td"),p(19),l(20,"currency"),r()()),i&2){let e=h.$implicit,n=h.rowIndex,t=b(2);a(2),m("ngIf",e.order_id),a(2),y(" ",e.journal_date||"Before "+t.startDate," "),a(2),u(e.journal_number||"---"),a(2),m("value",s(9,11,e.journal_description))("severity",t.getSeverity(e.journal_description)),a(3),u(e.journal_notes||"---"),a(),m("ngClass",$(19,Yt,e.debit==0,e.debit!=0)),a(),y(" ",s(14,13,e.debit)," "),a(2),m("ngClass",$(22,$t,e.credit==0,e.credit!=0)),a(),y(" ",s(17,15,e.credit)," "),a(3),y(" ",s(20,17,t.balances[n])," ")}}function ti(i,h){i&1&&(o(0,"tr")(1,"th"),p(2),l(3,"translate"),r(),o(4,"th"),p(5),l(6,"translate"),r(),o(7,"th"),p(8),l(9,"translate"),r(),o(10,"th"),p(11),l(12,"translate"),r(),o(13,"th"),p(14),l(15,"translate"),r()()),i&2&&(a(2),y(" ",s(3,5,"Barcode")," "),a(3),y(" ",s(6,7,"Description")," "),a(3),y(" ",s(9,9,"Purchased Price")," "),a(3),y(" ",s(12,11,"Quantity")," "),a(3),y(" ",s(15,13,"Total")," "))}function ii(i,h){if(i&1&&(o(0,"tr",27)(1,"td"),p(2),r(),o(3,"td"),p(4),r(),o(5,"td"),p(6),l(7,"currency"),r(),o(8,"td"),p(9),r(),o(10,"td"),p(11),l(12,"currency"),r()()),i&2){let e=h.$implicit;a(2),y(" ",e.barcode||"---"," "),a(2),y(" ",e.product_name," "),a(2),y(" ",s(7,5,e.unit_cost_usd)," "),a(3),u(e.quantity),a(2),y(" ",s(12,7,e.unit_cost_usd*e.quantity)," ")}}function ni(i,h){if(i&1&&(o(0,"tr"),x(1,"td"),o(2,"td",25)(3,"p-table",26),D(4,ti,16,15,"ng-template",17)(5,ii,13,9,"ng-template",18),r()(),x(6,"td"),r()),i&2){let e=h.$implicit,n=b(2);a(3),m("value",n.getFilteredDetails(e))}}function oi(i,h){if(i&1&&(o(0,"tr"),x(1,"td",25),o(2,"td"),p(3),l(4,"translate"),r(),o(5,"td",28),p(6),l(7,"currency"),r()()),i&2){let e=b(2);a(3),u(s(4,3,"Balance Due")),a(2),m("ngClass",$(7,Jt,e.balances[e.balances.length-1]<0,e.balances[e.balances.length-1]>0)),a(),y(" ",s(7,5,e.balances[e.balances.length-1])," ")}}function ri(i,h){if(i&1){let e=B();o(0,"div",1),x(1,"p-divider"),o(2,"p-table",16),_("onRowExpand",function(){g(e);let t=b();return S(t.onRowExpand())}),D(3,Xt,22,18,"ng-template",17)(4,ei,21,25,"ng-template",18)(5,ni,7,1,"ng-template",19)(6,oi,8,10,"ng-template",20),r()()}if(i&2){let e=b();a(2),m("value",e.data)("tableStyle",M(3,Kt))("loading",e.tableLoading())}}var xt=(()=>{class i{constructor(){this.suppliersService=f(q),this.dateService=f(ue),this.historyService=f(dt),this.currencyPipe=f(R),this.cashBalanceService=f(Ye),this.subscriptions=new De,this.suppliers=this.suppliersService.suppliers,this.startDate=this.dateService.getStartOfMonth(),this.endDate=this.dateService.getCurrentDate(),this.balances=[],this.balances_lbp=[],this.show_dollar=!0,this.data=[],this.paymentDialogVisible=!1,this.suppliersLoading=this.suppliersService.suppliersLoading,this.tableLoading=this.suppliersService.tableLoading,this.selectedPurchaseItems=this.historyService.selectedPurchaseItems,this.correctDebtDialogVisible=!1}ngOnInit(){this.subscriptions.add(this.suppliersService.supplierBalance$.subscribe(e=>{if(this.data=e,e.length>0){this.balances=[],this.balances_lbp=[],this.balances[0]=parseFloat(e[0].balance),this.balances_lbp[0]=parseFloat(e[0].debit_lbp)-parseFloat(e[0].credit_lbp);for(let n=1;n<e.length;n++)this.balances[n]=this.balances[n-1]+parseFloat(e[n].debit)-parseFloat(e[n].credit),this.balances_lbp[n]=this.balances_lbp[n-1]+parseFloat(e[n].debit_lbp)-parseFloat(e[n].credit_lbp);this.onRowExpand()}else this.balances=[],this.balances_lbp=[]}))}ngOnDestroy(){this.subscriptions.unsubscribe(),this.suppliersService.supplierBalance$.next([])}startDateChanged(){this.startDate=this.dateService.formatDate(this.startDate),this.resetTable(),this.getStatements()}endDateChanged(){this.endDate=this.dateService.formatDate(this.endDate),this.resetTable(),this.getStatements()}accountChanged(){this.resetTable(),this.getStatements()}getStatements(){this.selectedSupplier&&this.startDate&&this.endDate&&this.suppliersService.getSupplierTransactions(this.selectedSupplier,this.startDate,this.endDate)}resetTable(){this.data=[],this.balances=[],this.balances_lbp=[]}getSeverity(e){switch(e){case"Supplier Payment":return"danger";case"Supply":return"success";case"Manual Transaction":return"warning";default:return"contrast"}}onRowExpand(){let e=this.data.filter(n=>n.order_id!=null).map(n=>n.order_id);this.data.length>1&&this.historyService.fetchPurchaseItemsById(e)}getFilteredDetails(e){return this.selectedPurchaseItems().filter(n=>n.order_id_fk===e.order_id)}onCreatePayment(){this.getStatements(),this.cashBalanceService.getBalance()}formatCurrency(e){return this.currencyPipe.transform(e,"USD","symbol","1.2-2")||""}exportToPDF(){let e=new bt;e.addFileToVFS("fonts/cairo/cairo-variable.txt","cairo"),e.addFont("fonts/cairo/Cairo-Variable.ttf","Cairo","normal");let n=e.internal.pageSize.width,t=this.suppliers().find(C=>C.account_id===this.selectedSupplier),c=this.dateService.getCurrentDatetime();e.setFontSize(14);let d="Statement of account",v=e.getTextWidth(d);e.text(d,(n-v)/2,10),e.setFontSize(10),e.text(`${t?.name}`,10,20),e.setFontSize(9);let ve=this.dateService.formatDate(this.startDate,"yyyy-MM-dd"),Tt=this.dateService.formatDate(this.endDate,"yyyy-MM-dd");e.text(`Start Date: ${ve}`,10,30),e.text(`End Date: ${Tt}`,10,35),e.text(`Generated on: ${c}`,150,30);let Ft=["Datetime","Transaction #","Description","Debit","Credit","Balance"],Bt=this.data.map((C,be)=>[C.journal_date?this.dateService.formatDate(C.journal_date,"yyyy-MM-dd"):`Before ${ve}`,C.journal_number||"---",C.journal_description||"---",{hiddenValue:C.order_id||null,content:this.formatCurrency(C.debit),styles:{textColor:C.debit==0?"#D1D5DB":"#D9342B"}},{content:this.formatCurrency(C.credit),styles:{textColor:C.credit==0?"#D1D5DB":"#1DA750"}},this.formatCurrency(this.balances[be])]),U=[];Bt.forEach((C,be)=>{if(U.push(C),be>0&&C[3].hiddenValue){let Mt={order_id:C[3].hiddenValue},Pt=this.getFilteredDetails(Mt);U.push([{content:"",styles:{fillColor:"white",border:"1px solid black"}},{content:"Description",styles:{fontStyle:"bold",fontSize:7}},{content:"Unit Price",styles:{fontStyle:"bold",fontSize:7}},{content:"Qty",styles:{fontStyle:"bold",fontSize:7}},{content:"Total",styles:{fontStyle:"bold",fontSize:7}},{content:"",styles:{fillColor:"white"}}]),Pt.forEach(O=>{U.push([{content:"",styles:{fillColor:"white"}},{content:O.product_name,styles:{fillColor:"#e5e7eb",fontSize:6,font:"Cairo"}},{content:this.formatCurrency(O.unit_cost_usd),styles:{fillColor:"#e5e7eb",fontSize:7}},{content:O.quantity,styles:{fillColor:"#e5e7eb",fontSize:7}},{content:this.formatCurrency(O.unit_cost_usd*O.quantity),styles:{fillColor:"#e5e7eb",fontSize:7}},{content:"",styles:{fillColor:"white"}}])})}});let Et=[{content:"",colSpan:4},"Due",{content:`${this.formatCurrency(this.balances[this.balances.length-1])}`}];gt(e,{startY:40,head:[Ft],body:U,foot:[Et],styles:{halign:"center",fontSize:8},headStyles:{fillColor:"F9FAFB",textColor:"#4B5563"},footStyles:{fillColor:"F9FAFB",textColor:"#4B5563"}}),e.setFontSize(10);let Vt=e.lastAutoTable.finalY||20,xe=`Balance Due: ${this.formatCurrency(this.balances[this.balances.length-1])}`,It=e.getTextWidth(xe);e.text(xe,n-It-15,Vt+10),e.save(`${t?.name}-statement.pdf`)}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=k({type:i,selectors:[["app-statements"]],viewQuery:function(n,t){if(n&1&&E(Gt,5),n&2){let c;V(c=I())&&(t.dt=c.first)}},decls:38,vars:49,consts:[[1,"grid","m-1"],[1,"col-12"],[1,"grid"],[1,"col-12","md:col-2"],[1,"flex","flex-column","gap-1"],["optionLabel","name","optionValue","account_id","styleClass","p-inputtext-sm","appendTo","body",3,"ngModelChange","onChange","options","ngModel","placeholder","showClear","loading","autoOptionFocus","filter"],["styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","iconDisplay","readonlyInput"],[1,"col-6","md:col-1","mt-auto"],["size","small","icon","pi pi-search","styleClass","w-full",3,"onClick","label","loading","disabled"],["severity","help","size","small","icon","pi pi-file-pdf","styleClass","w-full",3,"onClick","label","disabled"],[1,"col-6","md:col-2","mt-auto"],["size","small","icon","pi pi-dollar","severity","success","styleClass","w-full",3,"onClick","label","disabled"],["size","small","icon","pi pi-dollar","severity","warning","styleClass","w-full",3,"onClick","label","disabled"],["class","col-12",4,"ngIf"],[3,"visibleChange","onCreate","visible","account_id"],[3,"onClose","onSubmit","visible","accounts","account"],["dataKey","journal_id","styleClass","p-datatable-sm",1,"ledger_table",3,"onRowExpand","value","tableStyle","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","rowexpansion"],["pTemplate","footer"],["style","cursor: pointer",3,"class","pRowToggler",4,"ngIf"],[3,"value","severity"],[3,"ngClass"],[2,"cursor","pointer",3,"pRowToggler"],["colspan","6"],["styleClass","p-datatable-sm",3,"value"],[1,"bg-success"],[1,"font-bold",3,"ngClass"]],template:function(n,t){n&1&&(o(0,"div",0)(1,"div",1)(2,"p-card")(3,"div",2)(4,"div",3)(5,"div",4)(6,"label"),p(7),l(8,"translate"),r(),o(9,"p-dropdown",5),l(10,"translate"),F("ngModelChange",function(d){return T(t.selectedSupplier,d)||(t.selectedSupplier=d),d}),_("onChange",function(){return t.accountChanged()}),r()()(),o(11,"div",3)(12,"div",4)(13,"label"),p(14),l(15,"translate"),r(),o(16,"p-calendar",6),F("ngModelChange",function(d){return T(t.startDate,d)||(t.startDate=d),d}),_("onSelect",function(){return t.startDateChanged()}),r()()(),o(17,"div",3)(18,"div",4)(19,"label"),p(20),l(21,"translate"),r(),o(22,"p-calendar",6),F("ngModelChange",function(d){return T(t.endDate,d)||(t.endDate=d),d}),_("onSelect",function(){return t.endDateChanged()}),r()()(),o(23,"div",7)(24,"p-button",8),l(25,"translate"),_("onClick",function(){return t.getStatements()}),r()(),o(26,"div",7)(27,"p-button",9),l(28,"translate"),_("onClick",function(){return t.exportToPDF()}),r()(),o(29,"div",10)(30,"p-button",11),l(31,"translate"),_("onClick",function(){return t.paymentDialogVisible=!0}),r()(),o(32,"div",10)(33,"p-button",12),l(34,"translate"),_("onClick",function(){return t.correctDebtDialogVisible=!0}),r()(),D(35,ri,7,4,"div",13),r()()(),o(36,"supplier-payment-dialog",14),F("visibleChange",function(d){return T(t.paymentDialogVisible,d)||(t.paymentDialogVisible=d),d}),_("onCreate",function(){return t.onCreatePayment()}),r()(),o(37,"correct-supplier-debt",15),_("onClose",function(){return t.correctDebtDialogVisible=!1})("onSubmit",function(){return t.getStatements()}),r()),n&2&&(a(7),u(s(8,33,"Select Supplier")),a(2),m("options",t.suppliers()),w("ngModel",t.selectedSupplier),m("placeholder",s(10,35,"Select Supplier"))("showClear",!0)("loading",t.suppliersLoading())("autoOptionFocus",!1)("filter",!0),a(5),u(s(15,37,"Start Date")),a(2),w("ngModel",t.startDate),m("showIcon",!0)("iconDisplay","input")("readonlyInput",!0),a(4),u(s(21,39,"End Date")),a(2),w("ngModel",t.endDate),m("showIcon",!0)("iconDisplay","input")("readonlyInput",!0),a(2),m("label",s(25,41,"Refresh"))("loading",t.tableLoading())("disabled",!t.selectedSupplier),a(3),m("label",s(28,43,"Export"))("disabled",!t.selectedSupplier),a(3),m("label",s(31,45,"Payment"))("disabled",!t.selectedSupplier),a(3),m("label",s(34,47,"Correct Debt"))("disabled",!t.selectedSupplier),a(2),m("ngIf",t.data.length>0),a(),w("visible",t.paymentDialogVisible),m("account_id",t.selectedSupplier),a(),m("visible",t.correctDebtDialogVisible)("accounts",t.suppliers())("account",t.selectedSupplier))},dependencies:[J,Ie,ee,Le,N,j,et,W,se,Qe,ht,nt,Xe,he,fe,R,z],styles:["[_nghost-%COMP%]  .p-card-content{padding:0!important}"]})}}return i})();var ai=["tableSearch"],li=()=>[10,15,50,100],si=()=>["name","phone","address"];function pi(i,h){if(i&1){let e=B();o(0,"div",12)(1,"span",13),x(2,"i",14),o(3,"input",15,1),l(5,"translate"),_("input",function(t){g(e),b();let c=Se(6);return S(c.filterGlobal(t.target.value,"contains"))}),r()()(),o(6,"p-button",16),l(7,"translate"),_("onClick",function(){g(e);let t=b();return S(t.resetTable())}),r(),o(8,"p-button",17),l(9,"translate"),_("onClick",function(){g(e);let t=b();return S(t.openSupplierDialog("add"))}),r()}if(i&2){b();let e=Se(6);a(3),m("placeholder",s(5,4,"Search ..."))("value",e.filters.global==null?null:e.filters.global.value),a(3),m("label",s(7,6,"Reset")),a(2),m("label",s(9,8,"New Supplier"))}}function ci(i,h){if(i&1){let e=B();o(0,"p-button",18),l(1,"translate"),_("onClick",function(){g(e);let t=b();return S(t.openSupplierDialog("edit"))}),r(),o(2,"p-button",19),l(3,"translate"),_("onClick",function(){g(e);let t=b();return S(t.deleteSelectedSupplier())}),r()}if(i&2){let e=b();m("label",s(1,4,"Edit"))("disabled",!e.selectedSupplier()),a(2),m("label",s(3,6,"Delete"))("disabled",!e.selectedSupplier())}}function mi(i,h){i&1&&(o(0,"tr")(1,"th",20),p(2),l(3,"translate"),r(),o(4,"th",21),p(5),l(6,"translate"),r(),o(7,"th",22),p(8),l(9,"translate"),r()()),i&2&&(a(2),u(s(3,3,"Supplier Name")),a(3),u(s(6,5,"Supplier Phone")),a(3),u(s(9,7,"Address")))}function di(i,h){if(i&1&&(o(0,"tr",23)(1,"td"),p(2),r(),o(3,"td"),p(4),r(),o(5,"td"),p(6),r()()),i&2){let e=h.$implicit;m("pSelectableRow",e),a(2),u(e.name),a(2),u(e.phone||" --- "),a(2),u(e.address||" --- ")}}function ui(i,h){i&1&&(o(0,"tr")(1,"td",24),p(2,"No suppliers yet!"),r()())}var Dt=(()=>{class i{constructor(){this.supplierService=f(q),this.confirmationService=f(Z),this.translate=f(ae),this.suppliers=this.supplierService.suppliers,this.selectedSupplier=this.supplierService.selectedSupplier,this.supplierDialogVisible=!1,this.submitted=!1,this.submitLoading=this.supplierService.submitLoading,this.suppliersLoading=this.supplierService.suppliersLoading,this.supplierForm=new Ne({account_id:new L(null),name:new L("",P.required),phone:new L(""),address:new L(""),financial_number:new L("")})}onKeyDown(e){this.supplierDialogVisible||this.tableSearch.nativeElement.focus()}get name(){return this.supplierForm.get("name")}openSupplierDialog(e){this.dialogMode=e,this.supplierDialogVisible=!0}onCreateSupplier(e){console.log(e),this.suppliers.set([...this.suppliers(),e])}onUpdateSupplier(e){console.log(e);let n=this.suppliers().findIndex(t=>t.account_id===e.account_id);this.suppliers.update(t=>[...t.slice(0,n),e,...t.slice(n+1)]),this.supplierService.selectedSupplier.set(e)}resetDialog(){this.submitted=!1,this.supplierForm.reset({})}deleteSelectedSupplier(){this.confirmationService.confirm({key:"home",message:this.translate.instant("Are you sure you want to continue ?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.supplierService.deleteSupplier(this.selectedSupplier())}})}resetTable(){this.selectedSupplier.set(null),this.ct.reset(),this.ct.sortField="account_id",this.ct.sortOrder=1,this.ct.sortSingle(),this.supplierService.getSuppliers()}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275cmp=k({type:i,selectors:[["app-accounts"]],viewQuery:function(n,t){if(n&1&&(E(j,5),E(ai,5)),n&2){let c;V(c=I())&&(t.ct=c.first),V(c=I())&&(t.tableSearch=c.first)}},hostBindings:function(n,t){n&1&&_("keydown",function(d){return t.onKeyDown(d)},!1,Fe)},decls:11,vars:15,consts:[["ct",""],["tableSearch",""],[1,"grid","mr-8","ml-8","mt-1"],[1,"col-12"],["styleClass","p-2"],["pTemplate","left"],["pTemplate","right"],["styleClass","p-datatable-sm p-datatable-striped","selectionMode","single","dataKey","account_id",3,"selectionChange","value","selection","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","globalFilterFields","filterDelay","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"visibleChange","onCreate","onUpdate","visible","mode","supplier"],[1,"flex"],[1,"p-input-icon-left","mr-auto"],[1,"pi","pi-search"],["pInputText","","type","search",1,"p-inputtext-sm",3,"input","placeholder","value"],["icon","pi pi-refresh","styleClass","mx-2","size","small",3,"onClick","label"],["icon","pi pi-plus","styleClass","mr-2","severity","success","size","small",3,"onClick","label"],["icon","pi pi-file-edit","styleClass","mr-2","size","small","severity","warning",3,"onClick","label","disabled"],["icon","pi pi-trash","severity","danger","size","small",3,"onClick","label","disabled"],["width","55%"],["width","%20"],["width","%25"],[3,"pSelectableRow"],["colspan","3"]],template:function(n,t){if(n&1){let c=B();o(0,"div",2)(1,"div",3)(2,"p-toolbar",4),D(3,pi,10,10,"ng-template",5)(4,ci,4,8,"ng-template",6),r(),o(5,"p-table",7,0),F("selectionChange",function(v){return g(c),T(t.selectedSupplier,v)||(t.selectedSupplier=v),S(v)}),D(7,mi,10,9,"ng-template",8)(8,di,7,4,"ng-template",9)(9,ui,3,0,"ng-template",10),r()()(),o(10,"supplier-dialog",11),F("visibleChange",function(v){return g(c),T(t.supplierDialogVisible,v)||(t.supplierDialogVisible=v),S(v)}),_("onCreate",function(v){return g(c),S(t.onCreateSupplier(v))})("onUpdate",function(v){return g(c),S(t.onUpdateSupplier(v))}),r()}n&2&&(a(5),m("value",t.suppliers()),w("selection",t.selectedSupplier),m("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",M(13,li))("alwaysShowPaginator",!0)("globalFilterFields",M(14,si))("filterDelay",0)("loading",t.suppliersLoading()),a(5),w("visible",t.supplierDialogVisible),m("mode",t.dialogMode)("supplier",t.selectedSupplier()))},dependencies:[N,j,Ze,W,pt,oe,_e,z]})}}return i})();var _i=[{path:"statements",data:{breadcrumb:"Statements"},component:xt},{path:"accounts",data:{breadcrumb:"Accounts"},component:Dt},{path:"**",redirectTo:"/suppliers/statements"}],wt=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=K({type:i})}static{this.\u0275inj=G({imports:[ye.forChild(_i),ye]})}}return i})();var no=(()=>{class i{static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275mod=K({type:i})}static{this.\u0275inj=G({providers:[R],imports:[X,wt,te,ie,St,Ke,tt,at,ne,le,ct,Ge,re,ut,st,pe,mt,ce,lt,He,ft,Ue,_t,de,me,he,fe,_e]})}}return i})();export{no as SuppliersModule};
