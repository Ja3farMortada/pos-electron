import{a as zt}from"./chunk-DZEX3CJ6.js";import{a as ut}from"./chunk-B2MKVQYB.js";import{a as rt}from"./chunk-X6LJ2SJU.js";import{a as de,b as at}from"./chunk-XGV4AIQT.js";import{a as mt,b as Nt}from"./chunk-KUB5ILCP.js";import{a as Ee}from"./chunk-ZGTXP7CP.js";import{a as Be,c as dt}from"./chunk-3I7RF6WR.js";import{a as ue}from"./chunk-QLTNVVXU.js";import{a as Oe,b as Ft,c as De}from"./chunk-5CX5K5NM.js";import{a as X}from"./chunk-Z3PNLGRC.js";import"./chunk-6CXWHLUJ.js";import{a as Ie}from"./chunk-WT6Y3HOA.js";import"./chunk-KICUZIBO.js";import{a as qt,b as jt}from"./chunk-B5UDKY34.js";import{a as pt}from"./chunk-HV2OQ7WI.js";import"./chunk-FA4OBAKY.js";import"./chunk-EA4RMISB.js";import{a as Lt}from"./chunk-OY4T6UDA.js";import{b as Ot,d as Wt}from"./chunk-7ZNGIE4A.js";import{a as Rt}from"./chunk-FO7TG3S7.js";import{a as kt,b as ct}from"./chunk-42BTCZ3Y.js";import"./chunk-7QYRFDGN.js";import{a as we,b as Pe}from"./chunk-FHUXGGRO.js";import{a as st}from"./chunk-7KO4RDVD.js";import{a as Z}from"./chunk-UJ5JDQTE.js";import{a as lt}from"./chunk-ZPRVI3IV.js";import{a as Ht}from"./chunk-UVEVFGTS.js";import"./chunk-P4HR6EQA.js";import{d as me,e as J,f as Te}from"./chunk-4PLGKOLD.js";import{a as Tt,b as tt,c as V}from"./chunk-AFTSMEUE.js";import{A as Re,F as ot,f as Dt,g as Bt,i as W,j as it,l as ke,m as Vt,p as L,q as nt,t as Mt,u as N,z as Fe}from"./chunk-LBGQA5HW.js";import"./chunk-4A2WLUYH.js";import{c as z}from"./chunk-VVKQAEX7.js";import{a as R,b as Ze}from"./chunk-FW7KDDDM.js";import{C as h,D as B,E as Ke,Eb as vt,Fa as l,Ga as _,Ha as C,J as Ve,Ja as w,Jb as He,K as g,Ka as I,L as v,La as E,Na as bt,Oa as D,P as _e,Pa as ee,Qa as oe,Qc as Y,Ra as xt,Rc as Pt,Sb as H,Vb as q,Wb as K,Xa as p,Y as a,Ya as c,Yb as G,a as A,ac as k,bc as re,cc as ae,d as te,da as P,eb as wt,ec as F,fc as se,ga as b,gb as xe,gc as le,hc as pe,ia as m,ib as Q,ic as ce,jc as It,kc as $e,la as U,lc as Ye,mb as M,mc as Et,na as St,nb as Ge,oa as n,pa as r,pb as ne,qa as x,r as qe,ua as T,va as y,vc as Je,wa as d,wc as O,xc as Xe,y as ie,yc as $,z as Qe,za as Me,zc as et}from"./chunk-DSVZHE42.js";import{a as Ae,b as Ue}from"./chunk-GAL4ENT6.js";var At=(()=>{class i{constructor(){this.http=h(ne),this.api=h(K),this.notificationService=h(q),this.whatsappLoading=P(!1)}sendMessage(e){this.whatsappLoading.set(!0),this.http.post(`${this.api.host}/send-whatsapp`,e).subscribe({next:o=>{this.notificationService.showInfo(o.message,"home",!1),this.whatsappLoading.set(!1)},error:o=>{this.whatsappLoading.set(!1),this.notificationService.showError("Error sending whatsapp!","home")}})}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=ie({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ut=(()=>{class i{constructor(){this.apiService=h(K),this.http=h(ne),this.notificationService=h(q),this.customersService=h(Ee),this.cashBalanceService=h(Ie),this.host=this.apiService.host,this.currentInvoice=P({}),this.signal_submited=P(!1),this.signal_submit_loading=P(!1),this.action_status$=new te(""),this.selectedCustomerLatestItems=new te([])}checkout(e,o){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.host()}/sell-orders`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{o.getProducts(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.cashBalanceService.getBalance()}})}returnCheckout(e,o){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.host()}/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{o.getProducts(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.cashBalanceService.getBalance()}})}deleteInvoice(e,o){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host()}/sell-orders/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{o.getProducts(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.cashBalanceService.getBalance()}})}returnDeleteInvoice(e,o){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host()}/return/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{o.getProducts(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.cashBalanceService.getBalance()}})}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=ie({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var je=class{constructor(){this.cost_dollar=0,this.subtotal_dollar=0,this.total_dollar=0,this.total_lbp=0,this.total_qty=0,this.total_avg_cost=0}},ft=function(i){return i.unit_price_usd="unit_price_usd",i.wholesale_price_usd="wholesale_price_usd",i}(ft||{});var Qt=(()=>{class i{constructor(){this.http=h(ne),this.apiService=h(K),this.notificationService=h(q),this.stockService=h(me),this.cashBalanceService=h(Ie),this.historyService=h(X),this.localStorageService=h(Tt),this.printService=h(Pe),this.settingsService=h(st),this.discountSettingService=h(lt),this.decimalService=h(J),this.dollarPipe=h(Te),this.invoice=P([]),this.invoiceTotal=P({total_cost:0,total_avg_cost:0,total_price:0,total_lbp:0,total_qty:0}),this.signal_submited=P(!1),this.submitCheckoutLoading=P(!1),this.reset$=new te(!1),this.factor=P(1),this.barcodeResponse=new te(null),this.products=this.stockService.products,this.discountInputEnabled=this.discountSettingService.discountInputEnabled,this.selectedCustomer=P(null),this.operation_type=P(this.discountSettingService.discountInputEnabled()?"normal":"debt"),this.payment_amount=P(0),this.lbp_payment_amount=P(0),this.journal_notes=P(null),this.discount_value=P(0),this.showZeroItems=P(this.localStorageService.getShowZeroItems()),this.invoicesOnHold=P([this.invoice()]),this.selectedInvoice=P(this.invoicesOnHold()[0]),this.customersOnHold=P([this.setCustomerData()]),this.selectedCustomerData=P(this.customersOnHold()[0]),this.selectedInvoiceIndex=P(0)}init(){this.selectedCustomer.set(null),this.operation_type.set(this.discountInputEnabled()?"normal":"debt"),this.payment_amount.set(0),this.journal_notes.set(null),this.invoice.set([]),this.discount_value.set(0),this.calculateTotal()}calculateTotal(){let e=this.invoice();this.invoiceTotal.set(e.reduce(function(o,t){return{total_cost:o.total_cost+t.quantity*t.unit_cost,total_avg_cost:o.total_avg_cost+t.quantity*t.avg_cost,total_price:o.total_price+t.quantity*t.unit_price,total_lbp:o.total_lbp+t.unit_price_lbp*t.quantity,total_qty:o.total_qty+t.quantity}},{total_cost:0,total_avg_cost:0,total_price:0,total_lbp:0,total_qty:0}))}submitBarcode(e){let o=e.toString(),t=this.products().find(s=>s.barcode===o||s.sku?.toLowerCase()===o.toLowerCase());t?this.barcodeResponse.next(t):this.notificationService.showError("Item not found!","home")}checkout(e,o){this.signal_submited.set(!0),this.submitCheckoutLoading.set(!0);let t=null;e.customer_id&&o&&(t={amount:o,customer_id:e.customer_id,payment_date:e.order_datetime}),this.http.post(`${this.apiService.host()}/sell-orders`,{invoice:e,payment:t}).subscribe({next:s=>{if(this.notificationService.showSuccess("Invoice submitted","home"),this.settingsService.thermalPrinterEnabled()){if(this.settingsService.printerSettings().auto_print){let f=structuredClone(s),S=0;f.items.forEach(Ct=>{S=this.decimalService.add(S,this.decimalService.multiply(this.dollarPipe.calculate(Ct.unit_price),Ct.quantity))}),f.total_lbp=S,this.printService.thermalPrint(f,"sales")}localStorage.setItem("PrintInvoice",JSON.stringify(s))}},error:s=>{this.notificationService.showError(s.error.message,"home"),this.submitCheckoutLoading.set(!1)},complete:()=>{this.stockService.getProducts(),this.invoice.set([]),this.signal_submited.set(!1),this.submitCheckoutLoading.set(!1),this.reset$.next(!0),this.cashBalanceService.getBalance(),this.historyService.fetchSalesHistory(),this.clearSelectedInvoice(),this.updateCustomerData()}})}updateZeroItemsState(){this.localStorageService.setShowZeroItems(this.showZeroItems())}initNewCustomerData(){return{selectedCustomer:null,operation_type:this.discountSettingService.discountInputEnabled()?"normal":"debt",payment_amount:0,lbp_payment_amount:0,journal_notes:null,discount_value:0}}setCustomerData(){return{selectedCustomer:this.selectedCustomer(),operation_type:this.operation_type(),payment_amount:this.payment_amount(),lbp_payment_amount:this.lbp_payment_amount(),journal_notes:this.journal_notes(),discount_value:this.discount_value()}}updateCustomerData(){this.customersOnHold.update(e=>[...e.slice(0,this.selectedInvoiceIndex()),this.setCustomerData(),...e.slice(this.selectedInvoiceIndex()+1)])}selectInvoice(e){this.selectedInvoice.set(this.invoicesOnHold()[e]),this.selectedInvoiceIndex.set(e),this.invoice.set(this.invoicesOnHold()[e]),this.selectedCustomerData.set(this.customersOnHold()[e]),this.selectedCustomer.set(this.customersOnHold()[e].selectedCustomer),this.operation_type.set(this.customersOnHold()[e].operation_type),this.payment_amount.set(this.customersOnHold()[e].payment_amount),this.lbp_payment_amount.set(this.customersOnHold()[e].lbp_payment_amount),this.journal_notes.set(this.customersOnHold()[e].journal_notes),this.discount_value.set(this.customersOnHold()[e].discount_value),this.calculateTotal()}clearSelectedInvoice(){this.invoicesOnHold().length>1?(this.invoicesOnHold.update(e=>(e.splice(this.selectedInvoiceIndex(),1),[...e])),this.customersOnHold.update(e=>(e.splice(this.selectedInvoiceIndex(),1),[...e])),this.selectedInvoiceIndex()>0?this.selectInvoice(this.selectedInvoiceIndex()-1):this.selectInvoice(this.selectedInvoiceIndex())):(this.init(),this.invoicesOnHold.set([this.invoice()]),this.customersOnHold.set([this.setCustomerData()]),this.selectInvoice(this.selectedInvoiceIndex()))}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=ie({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var di=()=>({width:"95vw",height:"75vh"}),ui=()=>({standalone:!0}),_i=i=>({"md:col-offset-3":i}),Kt=i=>({invalid:i}),hi=(i,u)=>({"text-red-500":i,"text-orange-500":u}),gi=i=>({"text-red-500":i});function vi(i,u){if(i&1){let e=T();n(0,"div",9)(1,"div",11)(2,"label",28),l(3,"Customer"),r(),n(4,"p-dropdown",29),E("ngModelChange",function(t){g(e);let s=d(2);return I(s.customer_id,t)||(s.customer_id=t),v(t)}),y("onChange",function(t){g(e);let s=d(2);return v(s.customerChange(t.value))}),r()()()}if(i&2){let e=d(2);a(4),w("ngModel",e.customer_id),m("options",e.customers)("filter",!0)("showClear",!0)}}function fi(i,u){if(i&1){let e=T();n(0,"div",14)(1,"div",11)(2,"label",30),l(3,"Notes"),r(),n(4,"input",31,2),E("ngModelChange",function(t){g(e);let s=d(2);return I(s.journal_notes,t)||(s.journal_notes=t),v(t)}),r()()()}if(i&2){let e=d(2);a(4),w("ngModel",e.journal_notes)}}function yi(i,u){i&1&&(n(0,"tr")(1,"th",32),l(2,"Barcode"),r(),n(3,"th",33),l(4,"Description"),r(),n(5,"th",34),l(6,"Unit"),r(),n(7,"th",35),l(8,"Qty"),r(),n(9,"th",34),l(10,"Total"),r(),n(11,"th",35),l(12,"Del?"),r()())}function Ci(i,u){if(i&1){let e=T();n(0,"p-inputNumber",42),E("ngModelChange",function(t){g(e);let s=d().$implicit;return I(s.unit_price,t)||(s.unit_price=t),v(t)}),y("ngModelChange",function(){g(e);let t=d().$implicit,s=d(2);return v(s.setPrice(t))})("onFocus",function(t){g(e);let s=d(3);return v(s.select(t.target))}),r()}if(i&2){let e=d().$implicit;w("ngModel",e.unit_price),m("maxFractionDigits",2)("min",0)}}function Si(i,u){i&1&&x(0,"i",45)}function bi(i,u){if(i&1&&(n(0,"span",43),l(1),p(2,"currency"),p(3,"lira"),n(4,"span"),b(5,Si,1,0,"i",44),r()()),i&2){let e=d().$implicit,o=d(2);m("ngClass",oe(7,hi,!e.unit_price,o.getPriceWarining(e))),a(),_(o.invoice.currency==="dollar"?c(2,3,e.unit_price):c(3,5,e.unit_price)),a(4),m("ngIf",o.getPriceWarining(e))}}function xi(i,u){if(i&1){let e=T();n(0,"p-inputNumber",46),E("ngModelChange",function(t){g(e);let s=d().$implicit;return I(s.quantity,t)||(s.quantity=t),v(t)}),y("onFocus",function(t){g(e);let s=d(3);return v(s.select(t.target))})("ngModelChange",function(){g(e);let t=d().$implicit,s=d(2);return v(s.setQty(t))}),r()}if(i&2){let e=d().$implicit;w("ngModel",e.quantity),m("minFractionDigits",0)("maxFractionDigits",2)}}function wi(i,u){if(i&1&&(n(0,"span",43),l(1),r()),i&2){let e=d().$implicit;m("ngClass",ee(2,gi,!e.quantity)),a(),_(e.quantity)}}function Ii(i,u){if(i&1){let e=T();n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td",36)(6,"p-cellEditor"),b(7,Ci,1,3,"ng-template",37)(8,bi,6,10,"ng-template",38),r()(),n(9,"td",39)(10,"p-cellEditor"),b(11,xi,1,3,"ng-template",37)(12,wi,2,4,"ng-template",38),r()(),n(13,"td"),l(14),p(15,"currency"),p(16,"lira"),r(),n(17,"td",40),y("click",function(){let t=g(e).rowIndex,s=d(2);return v(s.removeRow(t))}),x(18,"i",41),r()()}if(i&2){let e=u.$implicit,o=d(2);a(2),_(e.barcode||"---"),a(2),_(e.product_name),a(),m("pEditableColumn",e.unit_price)("ngClass",ee(11,Kt,!e.unit_price)),a(4),m("pEditableColumn",e.quantity)("ngClass",ee(13,Kt,!e.quantity)),a(5),C(" ",o.invoice.currency==="dollar"?c(15,7,e.unit_price*e.quantity):c(16,9,e.unit_price*e.quantity)," ")}}function Ei(i,u){if(i&1&&(n(0,"h4",48),l(1),r()),i&2){let e=d(3);a(),C(" Total units: ",e.invoiceTotal.total_qty," ")}}function Ti(i,u){i&1&&b(0,Ei,2,1,"ng-template",47)}function Pi(i,u){i&1&&(n(0,"tr",49)(1,"td",50),l(2,"No data yet!"),r()())}function Di(i,u){if(i&1){let e=T();n(0,"p-card",7)(1,"div",8)(2,"div",9)(3,"div",10),x(4,"div",11),n(5,"label"),l(6,"Invoice Date"),r(),n(7,"p-calendar",12),E("ngModelChange",function(t){g(e);let s=d();return I(s.invoice_date,t)||(s.invoice_date=t),v(t)}),r()()(),b(8,vi,5,4,"div",13),n(9,"div",14)(10,"div",11)(11,"label",15),l(12),p(13,"translate"),r(),n(14,"p-dropdown",16),E("ngModelChange",function(t){g(e);let s=d();return I(s.selectedInventoryId,t)||(s.selectedInventoryId=t),v(t)}),r()()(),b(15,fi,6,1,"div",14),n(16,"div",17)(17,"h3",18),l(18),p(19,"currency"),p(20,"exchangedLira"),r(),n(21,"h3",19),l(22),p(23,"dollar"),p(24,"lira"),r()()(),n(25,"div",8)(26,"div",20)(27,"p-table",21,0),b(29,yi,13,0,"ng-template",22)(30,Ii,19,15,"ng-template",4)(31,Ti,1,0,null,23)(32,Pi,3,0,"ng-template",24),r()(),n(33,"div",25)(34,"p-autoComplete",26,1),E("ngModelChange",function(t){g(e);let s=d();return I(s.search_product,t)||(s.search_product=t),v(t)}),y("completeMethod",function(t){g(e);let s=d();return v(s.searchItem(t))})("onKeyUp",function(t){g(e);let s=d();return v(s.submitInvoiceInput(t))}),r(),n(36,"button",27),y("click",function(){g(e);let t=d();return v(t.openProductsDialog())}),r()()()()}if(i&2){let e=d();a(7),w("ngModel",e.invoice_date),m("ngModelOptions",D(36,ui))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0)("showSeconds",!0),a(),m("ngIf",!e.return_invoice_edit),a(4),_(c(13,26,"Inventory")),a(2),w("ngModel",e.selectedInventoryId),m("options",e.inventories())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(),St(e.customer_id&&!e.return_invoice_edit?15:-1),a(),m("ngClass",ee(37,_i,!e.customer_id)),a(2),C(" USD: ",e.invoice.currency==="dollar"?c(19,28,e.invoiceTotal.total_dollar):c(20,30,e.invoiceTotal.total_dollar)," "),a(4),C(" LBP: ",e.invoice.currency==="dollar"?c(23,32,e.invoiceTotal.total_dollar):c(24,34,e.invoiceTotal.total_dollar)," "),a(5),Me("scrollHeight",e.vh),m("value",e.order_items)("scrollable",!0),a(4),m("ngIf",e.invoiceTotal.total_qty),a(3),w("ngModel",e.search_product),m("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function Bi(i,u){if(i&1){let e=T();n(0,"p-button",54),y("click",function(){g(e);let t=d(2);return v(t.deleteInvoice())}),r()}if(i&2){let e=d(2);m("disabled",e.submitted())}}function Vi(i,u){if(i&1){let e=T();b(0,Bi,1,1,"p-button",51),n(1,"p-button",52),y("click",function(){g(e);let t=d();return v(t.closeEditDialog())}),r(),n(2,"p-button",53),y("click",function(){g(e);let t=d();return v(t.submitEditInvoice())}),r()}if(i&2){let e=d();m("ngIf",e.userPermissions().delete_invoice),a(),m("disabled",e.submitted()),a(),m("loading",e.submitted())("disabled",e.order_items.length==0)}}var _t=(()=>{class i{constructor(){this.visible=!1,this.customers=[],this.return_invoice_edit=!1,this.onSubmit=new _e,this.onHide=new _e,this.stockService=h(me),this.editInvoiceService=h(Ut),this.authService=h(we),this.confirmationService=h(He),this.notificationsService=h(q),this.sellService=h(Qt),this.dateService=h(V),this.decimalService=h(J),this.dollarPipe=h(Te),this.userPermissions=this.authService.userPermissions,this.exchangeRate=this.stockService.exchangeRate,this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new je,this.order_items=[],this.customer_id=null,this.invoice_number="",this.selected_price_type="latest",this.selectedCustomerLatestItems=[],this.journal_notes=null,this.productsDialogVisible=!1,this.subscriptions=new A,this.products=this.stockService.products,this.matching_products=[],this.priceTypes=Object.keys(ft),this.inventories=this.stockService.inventories,this.selectedInventoryId=P(null),this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.editInvoiceService.selectedCustomerLatestItems.subscribe(e=>{this.selectedCustomerLatestItems=e})),this.subscriptions.add(this.sellService.barcodeResponse.subscribe(e=>{e&&(this.addProduct(e),this.sellService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.dateService.formatDate(this.invoice.order_datetime,"yyyy-MM-dd HH:mm:ss"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.order_items=structuredClone(this.invoice.items),this.customer_id=this.invoice.customer_id,this.journal_notes=this.invoice.journal_notes,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_avg_cost=this.invoice.total_avg_cost,this.invoiceTotal.total_dollar=this.invoice.total_amount,this.selectedInventoryId.set(this.invoice.inventory_id),this.customerChange(this.invoice.customer_id))}setPrice(e){e.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(e){e.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.order_items.find(o=>!o.unit_price||!o.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){let o=this.order_items.find(t=>t.product_id===e.product_id);if(o)o.quantity+=1,this.calculateTotal("edit");else{let t=e.unit_price_usd,s=e.unit_cost_usd,f=e.avg_cost_usd;this.invoice.currency==="dollar"?e.currency==="lira"&&(t=t/this.exchangeRate().rate_value,s=s/this.exchangeRate().rate_value,f=f/this.exchangeRate().rate_value):e.currency=="dollar"&&(t=this.dollarPipe.calculate(t),s=this.dollarPipe.calculate(s),f=this.dollarPipe.calculate(f)),this.order_items.push({product_id:e.product_id,barcode:e.barcode,product_name:e.product_name,original_price:t,unit_cost:s,avg_cost:f,unit_price:t,quantity:1,stock_management:e.stock_management,currency:e.currency}),this.calculateTotal("add")}}submitInvoiceInput(e){e.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.sellService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(e){if(e){let o=-1,t=["*","+"];for(let S=0;S<t.length;S++)if(e.indexOf(t[S])!==-1){o=e.indexOf(t[S]);break}let s=e.substring(0,o)||1,f=parseInt(e.substring(o+1,e.length));o!=-1&&o!=0?(this.sellService.factor.set(parseInt(s)),this.sellService.submitBarcode(f)):this.sellService.submitBarcode(e)}}calculateTotal(e){let o=new je,t=this.order_items;return t.length>0&&(t.forEach(s=>{o.total_qty=this.decimalService.add(o.total_qty,s.quantity),o.cost_dollar=this.decimalService.add(o.cost_dollar,this.decimalService.multiply(s.unit_cost,s.quantity)),o.total_avg_cost=this.decimalService.add(o.total_avg_cost,this.decimalService.multiply(s.avg_cost,s.quantity)),o.subtotal_dollar=this.decimalService.add(o.subtotal_dollar,this.decimalService.multiply(s.unit_price,s.quantity))}),o.total_dollar=o.subtotal_dollar),this.invoiceTotal=o,o}submitEditInvoice(){let e=this.validateItems();e?e&&this.notificationsService.showError("Please enter price for all items"):this.return_invoice_edit?this.editInvoiceService.returnCheckout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_avg_cost:this.invoiceTotal.total_avg_cost,total_amount:this.invoiceTotal.total_dollar,total_lbp:this.invoiceTotal.total_lbp,order_datetime:this.invoice_date,invoice_number:this.invoice_number,journal_notes:this.journal_notes,inventory_id:this.selectedInventoryId()},this.stockService):this.editInvoiceService.checkout({customer_id:this.customer_id,order_id:this.invoice.order_id,items:this.order_items,total_cost:this.invoiceTotal.cost_dollar,total_avg_cost:this.invoiceTotal.total_avg_cost,total_amount:this.invoiceTotal.total_dollar,total_lbp:this.invoiceTotal.total_lbp,order_datetime:this.invoice_date,invoice_number:this.invoice_number,journal_notes:this.journal_notes,inventory_id:this.selectedInventoryId()},this.stockService)}searchItem(e){let o=this.products(),t=[],s=e.query;for(let f=0;f<o.length;f++){let S=o[f];S.product_name.toLowerCase().indexOf(s.toLowerCase())>-1&&t.push(S)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}customerChange(e){}removeRow(e){this.order_items.splice(e,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.return_invoice_edit?this.editInvoiceService.returnDeleteInvoice(this.invoice,this.stockService):this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(o=>{this.addProduct(o)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}select(e){e.select()}getPriceWarining(e){if(this.userPermissions().show_cost){if(!e.unit_price)return!1;let o=e.unit_cost||0,t=e.unit_price;return typeof o=="string"&&(o=parseFloat(o)),typeof t=="string"&&(t=parseFloat(t)),t<o}else return!1}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["edit-invoice"]],inputs:{visible:"visible",invoice:"invoice",customers:"customers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ve],decls:4,vars:9,consts:[["invoiceTable",""],["barcodeInput",""],["notes_input",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","products"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-2","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime","showSeconds"],["class","col-12 md:col-2 pt-0 pb-0",4,"ngIf"],[1,"col-12","md:col-3","pt-0","pb-0"],["for","inventory"],["styleClass","p-inputtext-sm","id","inventory","appendTo","body","optionLabel","inventory_name","optionValue","inventory_id","placeholder","Select Inventory","filterBy","inventory_name",3,"ngModelChange","ngModel","options","filter","showClear","autoOptionFocus"],[1,"col-12","md:col-3","text-center",3,"ngClass"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],[4,"ngIf"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["pButton","","pRipple","","label","Multi Select","severity","warning","icon","pi pi-list",1,"p-button-sm","ml-2",3,"click"],["for","customer"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear"],["for","currency"],["pInputText","","type","text","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","ngModel"],["width","20%"],["width","40%"],["width","15%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","priceEditable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0.1","mode","decimal",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel","minFractionDigits","maxFractionDigits"],["pTemplate","summary"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small","class","w-full mt-4 md:w-auto md:mt-0",3,"disabled","click",4,"ngIf"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",1,"w-full","mt-2","md:w-auto","md:ml-2",3,"click","disabled"],["size","small","label","Submit Edit","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"click","loading","disabled"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"click","disabled"]],template:function(o,t){o&1&&(n(0,"p-dialog",3),E("visibleChange",function(f){return I(t.visible,f)||(t.visible=f),f}),y("onHide",function(){return t.closeEditDialog()}),b(1,Di,37,39,"ng-template",4)(2,Vi,3,4,"ng-template",5),r(),n(3,"products-dialog",6),y("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(f){return t.assignSelectedProducts(f)}),r()),o&2&&(U(D(8,di)),w("visible",t.visible),m("modal",!0)("closable",!0)("maximizable",!0),a(3),m("visible",t.productsDialogVisible)("products",t.products))},dependencies:[xe,Q,G,k,se,De,N,H,Fe,Re,Je,O,R,Y,$,W,L,ke,Oe,M,Te,Z,z,Nt],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:40px;height:28px}.priceEditable[_ngcontent-%COMP%]{width:60px;height:28px;text-align:center}[_nghost-%COMP%]  .p-inputnumber-input{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}"]})}}return i})();var Mi=()=>[10,25,50],Hi=()=>({width:"95vw"});function ki(i,u){if(i&1){let e=T();n(0,"div",7)(1,"label"),l(2),p(3,"translate"),r(),n(4,"p-dropdown",27),p(5,"translate"),E("ngModelChange",function(t){g(e);let s=d();return I(s.salesHistoryParams().customer_id,t)||(s.salesHistoryParams().customer_id=t),v(t)}),y("ngModelChange",function(){g(e);let t=d();return v(t.submitSearch())}),r()()}if(i&2){let e=d();a(2),_(c(3,7,"Customer")),a(2),w("ngModel",e.salesHistoryParams().customer_id),m("options",e.customers())("placeholder",c(5,9,"Select Customer"))("filter",!0)("showClear",!0)("autoOptionFocus",!1)}}function Fi(i,u){i&1&&(n(0,"th",30),l(1),p(2,"translate"),r()),i&2&&(a(),C(" ",c(2,1,"Customer")," "))}function Ri(i,u){if(i&1&&(n(0,"tr")(1,"th"),l(2),p(3,"translate"),r(),b(4,Fi,3,3,"th",28),n(5,"th",29),l(6),p(7,"translate"),r(),n(8,"th",30),l(9),p(10,"translate"),r(),n(11,"th",30),l(12),p(13,"translate"),r(),n(14,"th"),l(15),p(16,"translate"),r(),n(17,"th"),l(18),p(19,"translate"),r(),n(20,"th",31),l(21),p(22,"translate"),r()()),i&2){let e=d();a(2),C("",c(3,9,"Invoice")," #"),a(2),m("ngIf",e.customersFeaturesEnabled()),a(2),_(c(7,11,"Type")),a(3),_(c(10,13,"Inventory")),a(3),_(c(13,15,"Datetime")),a(3),_(c(16,17,"Total")),a(3),_(c(19,19,"User")),a(2),m("colSpan",e.normalPrinterEnabled()&&e.thermalPrinterEnabled()?4:3),a(),C(" ",c(22,21,"Options")," ")}}function Oi(i,u){if(i&1&&(n(0,"td"),l(1),r()),i&2){let e=d().$implicit;a(),C(" ",e.customer_name||"---"," ")}}function Wi(i,u){if(i&1){let e=T();n(0,"td",38)(1,"p-button",39),y("onClick",function(){g(e);let t=d().$implicit,s=d();return v(s.openPrintDialog(t))}),r()()}}function Li(i,u){if(i&1){let e=T();n(0,"td",40)(1,"p-button",41),y("onClick",function(){g(e);let t=d().$implicit,s=d();return v(s.thermalPrint(t))}),r()()}}function Ni(i,u){if(i&1){let e=T();n(0,"p-button",42),y("onClick",function(){g(e);let t=d().$implicit,s=d();return v(s.openEditDialog(t))}),r()}if(i&2){let e=d(2);m("loading",e.loadingEdit)}}function qi(i,u){if(i&1){let e=T();n(0,"tr")(1,"td"),l(2),r(),b(3,Oi,2,1,"td",32),n(4,"td"),x(5,"p-tag",33),r(),n(6,"td"),l(7),r(),n(8,"td"),l(9),r(),n(10,"td"),l(11),p(12,"currency"),p(13,"lira"),r(),n(14,"td"),l(15),r(),n(16,"td")(17,"p-button",34),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.showInvoiceDialog(t))}),r()(),b(18,Wi,2,0,"td",35)(19,Li,2,0,"td",36),n(20,"td"),b(21,Ni,1,1,"p-button",37),r()()}if(i&2){let e=u.$implicit,o=d();a(2),_(e.invoice_number),a(),m("ngIf",o.customersFeaturesEnabled()),a(2),m("value",e.operation_type||"unknown")("severity",e.operation_type==="debt"?"danger":e.operation_type==="normal"?void 0:"contrast"),a(2),_(e.inventory_name),a(2),_(e.order_date),a(2),C(" ",e.currency==="dollar"?c(12,12,e.total_amount):c(13,14,e.total_amount)," "),a(4),_(e.username||"---"),a(2),m("loading",o.loadingDetails),a(),m("ngIf",o.normalPrinterEnabled()),a(),m("ngIf",o.thermalPrinterEnabled()),a(2),m("ngIf",o.userPermissions().edit_invoice)}}function ji(i,u){i&1&&(n(0,"tr")(1,"td",43),l(2),p(3,"translate"),r()()),i&2&&(a(2),C(" ",c(3,1,"No Records Found!")," "))}function zi(i,u){i&1&&(n(0,"tr")(1,"th",30),l(2),p(3,"translate"),r(),n(4,"th",46),l(5),p(6,"translate"),r(),n(7,"th"),l(8),p(9,"translate"),r(),n(10,"th"),l(11),p(12,"translate"),r(),n(13,"th"),l(14),p(15,"translate"),r(),n(16,"th",47),l(17),p(18,"translate"),r(),n(19,"th"),l(20),p(21,"translate"),r()()),i&2&&(a(2),_(c(3,7,"Barcode")),a(3),_(c(6,9,"Description")),a(3),_(c(9,11,"Original Price")),a(3),_(c(12,13,"Sold Unit Price")),a(3),_(c(15,15,"Discount %")),a(3),_(c(18,17,"Qty")),a(3),_(c(21,19,"Total Price")))}function Ai(i,u){if(i&1&&(n(0,"tr")(1,"td"),l(2),r(),n(3,"td",48),l(4),r(),n(5,"td"),l(6),p(7,"currency"),p(8,"lira"),r(),n(9,"td"),l(10),p(11,"currency"),p(12,"lira"),r(),n(13,"td"),l(14),r(),n(15,"td"),l(16),r(),n(17,"td"),l(18),p(19,"currency"),p(20,"lira"),r()()),i&2){let e=u.$implicit,o=d(3);a(2),_(e.barcode||"---"),a(),m("autoDir",e.product_name),a(),C(" ",e.product_name," "),a(2),C(" ",o.invoiceItems.currency=="dollar"?c(7,8,e.original_price):c(8,10,e.original_price)," "),a(4),C(" ",o.invoiceItems.currency=="dollar"?c(11,12,e.unit_price):c(12,14,e.unit_price)," "),a(4),C("",e.discount_percentage,"%"),a(2),_(e.quantity),a(2),C(" ",o.invoiceItems.currency=="dollar"?c(19,16,e.total_price):c(20,18,e.total_price)," ")}}function Ui(i,u){if(i&1&&(n(0,"tr"),x(1,"td")(2,"td")(3,"td")(4,"td")(5,"td"),n(6,"td"),l(7),r(),n(8,"td"),l(9),p(10,"currency"),p(11,"lira"),r()()),i&2){let e=d(3);a(7),_(e.selectedInvoiceTotals.totalQty),a(2),C(" ",e.invoiceItems.currency==="dollar"?c(10,2,e.selectedInvoiceTotals.totalPrice):c(11,4,e.selectedInvoiceTotals.totalPrice)," ")}}function Qi(i,u){if(i&1&&(n(0,"p-table",45),b(1,zi,22,21,"ng-template",19)(2,Ai,21,20,"ng-template",20)(3,Ui,12,6,"ng-template",24),r()),i&2){let e=d(2);m("value",e.invoiceItems)}}function Ki(i,u){if(i&1&&b(0,Qi,4,1,"p-table",44),i&2){let e=d();m("ngIf",e.invoiceItems.length!=0)}}function Gi(i,u){if(i&1){let e=T();n(0,"p-button",49),p(1,"translate"),y("onClick",function(){g(e);let t=d();return v(t.hideInvoiceDialog())}),r()}i&2&&m("label",c(1,1,"Close"))}var yt=(()=>{class i{constructor(){this.customerService=h(Ee),this.historyService=h(X),this.decimalService=h(J),this.printService=h(Pe),this.authService=h(we),this.whatsappService=h(At),this.dateService=h(V),this.fb=h($e),this.printerSettingsService=h(st),this.customersFeaturesService=h(pt),this.stockService=h(me),this.dollarPipe=h(Te),this.usersService=h(zt),this.currencyService=h(tt),this.api=h(K),this.discountService=h(lt),this.defaultCurrency=this.currencyService.defaultCurrency,this.customersFeaturesEnabled=this.customersFeaturesService.customersFeaturesEnabled,this.printPageSettings=this.printerSettingsService.printPageSettings,this.normalPrinterEnabled=this.printerSettingsService.normalPrinterEnabled,this.thermalPrinterEnabled=this.printerSettingsService.thermalPrinterEnabled,this.userPermissions=this.authService.userPermissions,this.users=this.usersService.users,this.customers=this.customerService.customers,this.inventories=this.stockService.inventories,this.loadingInventories=this.stockService.loadingInventories,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.products=this.stockService.products,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.salesHistory=this.historyService.salesHistory,this.loading=this.historyService.signal_loading,this.salesHistoryParams=this.historyService.salesHistoryParams,this.loadingDetails=!1,this.loadingEdit=!1,this.printDialogVisible=!1,this.currencyOptions=[{label:"USD",value:"dollar"},{label:"LBP",value:"lira"}],this.submitSearch()}submitSearch(){this.historyService.fetchSalesHistory(this.salesHistoryParams())}resetSearch(){this.salesHistoryParams.set(this.historyService.initParams()),this.historyService.fetchSalesHistory(null)}selectToday(){this.salesHistoryParams.update(e=>Ue(Ae({},e),{start_date:this.dateService.getStartOfDay(),end_date:this.dateService.getEndOfDay()})),this.submitSearch()}selectThisMonth(){this.salesHistoryParams.update(e=>Ue(Ae({},e),{start_date:this.dateService.getStartOfMonth(),end_date:this.dateService.getEndOfMonth()})),this.submitSearch()}selectThisYear(){this.salesHistoryParams.update(e=>Ue(Ae({},e),{start_date:this.dateService.getStartOfYear(),end_date:this.dateService.getEndOfYear()})),this.submitSearch()}showInvoiceDialog(e){this.loadingDetails=!0,this.api.post("history/sales/details",[e.order_id]).pipe(qe(()=>{this.loadingDetails=!1})).subscribe({next:o=>{this.invoiceItems=o,this.invoiceItems.currency=e.currency,this.invoiceItems.forEach(t=>{this.selectedInvoiceTotals.totalQty+=parseFloat(t.quantity),this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,t.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,t.unit_cost*t.quantity)}),this.detailsDialogVisible=!0}})}openEditDialog(e){this.loadingEdit=!0,this.api.post("history/sales/details",[e.order_id]).pipe(qe(()=>{this.loadingEdit=!1})).subscribe({next:o=>{this.selectedInvoice=e,this.selectedInvoice.items=o,this.editDialogVisible=!0}})}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(){this.historyService.fetchSalesHistory(this.salesHistoryParams())}openPrintDialog(e){e.type="sale",e.exchange_rate||(e.exchange_rate=this.stockService.exchangeRate().rate_value),this.api.post("history/sales/details",[e.order_id]).pipe(qe(()=>{this.loadingEdit=!1})).subscribe({next:o=>{this.invoiceDetails=e,this.invoiceDetails.items=o,this.printDialogVisible=!0}})}thermalPrint(e){let o=structuredClone(e);this.api.post("history/sales/details",[o.order_id]).pipe(qe(()=>{this.loadingDetails=!1})).subscribe({next:t=>{o.items=t,console.log(o),this.printService.thermalPrint(o,"sale")}})}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["app-sell-history"]],decls:62,vars:103,consts:[["ht",""],[1,"grid","m-1"],[1,"col-12"],[1,"grid"],[1,"col-12","md:col-6","lg:col-1","flex","flex-column","gap-1"],["type","search","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"ngModelChange","ngModel","placeholder"],["class","col-12 md:col-6 lg:col-2 flex flex-column gap-1",4,"ngIf"],[1,"col-12","md:col-6","lg:col-2","flex","flex-column","gap-1"],["for","Inventory"],["styleClass","p-inputtext-sm w-full","optionLabel","inventory_name","optionValue","inventory_id","appendTo","body","filterBy","inventory_name",3,"ngModelChange","ngModel","options","loading","placeholder","filter","showClear","autoOptionFocus"],["styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd",3,"ngModelChange","ngModel","showIcon","showClear","readonlyInput","placeholder","showButtonBar"],["styleClass","p-inputtext-sm w-full","id","product","appendTo","body","optionLabel","product_name","optionValue","product_id","filterBy","product_name",3,"ngModelChange","ngModel","options","placeholder","filter","showClear","autoOptionFocus"],["styleClass","p-inputtext-sm w-full","id","product","appendTo","body","optionLabel","username","optionValue","user_id","filterBy","username",3,"ngModelChange","ngModel","options","placeholder","filter","showClear","autoOptionFocus"],[1,"col-12","md:col-6","lg:col-4"],["icon","pi pi-search","size","small","severity","success",1,"mr-2",3,"onClick","label","loading"],["icon","pi pi-times","size","small","severity","danger",3,"onClick","label","disabled"],["severity","secondary",3,"onClick","label","size"],["styleClass","mx-2","severity","secondary",3,"onClick","label","size"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","top",3,"visibleChange","onHide","header","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers"],[3,"visibleChange","visible","invoice"],["styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","filterBy","name",3,"ngModelChange","ngModel","options","placeholder","filter","showClear","autoOptionFocus"],["width","15%",4,"ngIf"],["width","10%"],["width","15%"],["width","15%",3,"colSpan"],[4,"ngIf"],[3,"value","severity"],["size","small","severity","info","icon","fas fa-eye",3,"onClick","loading"],["pTooltip","A4 Print","tooltipPosition","top",4,"ngIf"],["pTooltip","Thermal Print","tooltipPosition","top",4,"ngIf"],["size","small","icon","fas fa-edit","severity","warning",3,"loading","onClick",4,"ngIf"],["pTooltip","A4 Print","tooltipPosition","top"],["size","small","severity","secondary","icon","pi pi-print",3,"onClick"],["pTooltip","Thermal Print","tooltipPosition","top"],["size","small","severity","contrast","icon","fa-solid fa-print",3,"onClick"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick","loading"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","35%"],["width","5%"],[3,"autoDir"],["icon","pi pi-times","size","small","severity","secondary",3,"onClick","label"]],template:function(o,t){if(o&1){let s=T();n(0,"div",1)(1,"div",2)(2,"p-card")(3,"div",3)(4,"div",4)(5,"label"),l(6),p(7,"translate"),r(),n(8,"input",5),p(9,"translate"),E("ngModelChange",function(S){return g(s),I(t.salesHistoryParams().invoice_number,S)||(t.salesHistoryParams().invoice_number=S),v(S)}),y("ngModelChange",function(){return g(s),v(t.submitSearch())}),r()(),b(10,ki,6,11,"div",6),n(11,"div",7)(12,"label",8),l(13),p(14,"translate"),r(),n(15,"p-dropdown",9),p(16,"translate"),E("ngModelChange",function(S){return g(s),I(t.salesHistoryParams().inventory_id,S)||(t.salesHistoryParams().inventory_id=S),v(S)}),y("ngModelChange",function(){return g(s),v(t.submitSearch())}),r()(),n(17,"div",7)(18,"label"),l(19),p(20,"translate"),r(),n(21,"p-calendar",10),p(22,"translate"),E("ngModelChange",function(S){return g(s),I(t.salesHistoryParams().start_date,S)||(t.salesHistoryParams().start_date=S),v(S)}),y("ngModelChange",function(){return g(s),v(t.submitSearch())}),r()(),n(23,"div",7)(24,"label"),l(25),p(26,"translate"),r(),n(27,"p-calendar",10),p(28,"translate"),E("ngModelChange",function(S){return g(s),I(t.salesHistoryParams().end_date,S)||(t.salesHistoryParams().end_date=S),v(S)}),y("ngModelChange",function(){return g(s),v(t.submitSearch())}),r()(),n(29,"div",7)(30,"label"),l(31),p(32,"translate"),r(),n(33,"p-dropdown",11),p(34,"translate"),E("ngModelChange",function(S){return g(s),I(t.salesHistoryParams().product_id,S)||(t.salesHistoryParams().product_id=S),v(S)}),y("ngModelChange",function(){return g(s),v(t.submitSearch())}),r()(),n(35,"div",4)(36,"label"),l(37),p(38,"translate"),r(),n(39,"p-dropdown",12),p(40,"translate"),E("ngModelChange",function(S){return g(s),I(t.salesHistoryParams().user_id,S)||(t.salesHistoryParams().user_id=S),v(S)}),y("ngModelChange",function(){return g(s),v(t.submitSearch())}),r()(),n(41,"div",13)(42,"p-button",14),p(43,"translate"),y("onClick",function(){return g(s),v(t.submitSearch())}),r(),n(44,"p-button",15),p(45,"translate"),y("onClick",function(){return g(s),v(t.resetSearch())}),r()(),n(46,"div",13)(47,"p-button",16),p(48,"translate"),y("onClick",function(){return g(s),v(t.selectToday())}),r(),n(49,"p-button",17),p(50,"translate"),y("onClick",function(){return g(s),v(t.selectThisMonth())}),r()()(),n(51,"p-table",18,0),b(53,Ri,23,23,"ng-template",19)(54,qi,22,16,"ng-template",20)(55,ji,4,3,"ng-template",21),r()()()(),n(56,"p-dialog",22),p(57,"translate"),E("visibleChange",function(S){return g(s),I(t.detailsDialogVisible,S)||(t.detailsDialogVisible=S),v(S)}),y("onHide",function(){return g(s),v(t.hideInvoiceDialog())}),b(58,Ki,1,1,"ng-template",23)(59,Gi,2,3,"ng-template",24),r(),n(60,"edit-invoice",25),y("onHide",function(){return g(s),v(t.closeEditDialog())})("onSubmit",function(){return g(s),v(t.submitEdit())}),r(),n(61,"print-dialog",26),E("visibleChange",function(S){return g(s),I(t.printDialogVisible,S)||(t.printDialogVisible=S),v(S)}),r()}o&2&&(a(6),C("",c(7,67,"Invoice")," #"),a(2),w("ngModel",t.salesHistoryParams().invoice_number),m("placeholder",c(9,69,"Invoice")),a(2),m("ngIf",t.customersFeaturesEnabled()),a(3),_(c(14,71,"Inventory")),a(2),w("ngModel",t.salesHistoryParams().inventory_id),m("options",t.inventories())("loading",t.loadingInventories())("placeholder",c(16,73,"Select Inventory"))("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(4),_(c(20,75,"Start Date")),a(2),w("ngModel",t.salesHistoryParams().start_date),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("placeholder",c(22,77,"Start Date"))("showButtonBar",!0),a(4),_(c(26,79,"End Date")),a(2),w("ngModel",t.salesHistoryParams().end_date),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("placeholder",c(28,81,"End Date"))("showButtonBar",!0),a(4),_(c(32,83,"Product")),a(2),w("ngModel",t.salesHistoryParams().product_id),m("options",t.products())("placeholder",c(34,85,"Select Product"))("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(4),_(c(38,87,"User")),a(2),w("ngModel",t.salesHistoryParams().user_id),m("options",t.users())("placeholder",c(40,89,"Select User"))("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(3),m("label",c(43,91,"Search"))("loading",t.loading()),a(2),m("label",c(45,93,"Reset"))("disabled",t.loading()),a(3),m("label",c(48,95,"Today"))("size","small"),a(2),m("label",c(50,97,"This Month"))("size","small"),a(2),m("value",t.salesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(101,Mi))("alwaysShowPaginator",!1)("loading",t.loading()),a(5),U(D(102,Hi)),m("header",c(57,99,"Details")),w("visible",t.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),a(4),m("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers()),a(),w("visible",t.printDialogVisible),m("invoice",t.invoiceDetails))},dependencies:[Q,G,k,se,N,H,O,R,Y,$,W,L,Dt,mt,qt,Lt,_t,M,Z,z],styles:["[_nghost-%COMP%]  .p-fieldset-content{padding:.5rem!important}[_nghost-%COMP%]  .p-fieldset-content{padding-bottom:0!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important}"]})}}return i})();var $i=()=>[10,25,50];function Yi(i,u){i&1&&(n(0,"tr")(1,"th"),l(2),p(3,"translate"),r(),n(4,"th"),l(5),p(6,"translate"),r(),n(7,"th"),l(8),p(9,"translate"),r(),n(10,"th"),l(11),p(12,"translate"),r(),n(13,"th",16),l(14),p(15,"translate"),r()()),i&2&&(a(2),C("",c(3,5,"Payment")," #"),a(3),_(c(6,7,"Customer")),a(3),_(c(9,9,"Datetime")),a(3),_(c(12,11,"Total")),a(3),C(" ",c(15,13,"Options")," "))}function Zi(i,u){if(i&1){let e=T();n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td"),l(6),r(),n(7,"td"),l(8),p(9,"currency"),p(10,"lira"),r(),n(11,"td"),x(12,"p-button",17),r(),n(13,"td")(14,"p-button",18),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.openEditDialog(t))}),r()()()}if(i&2){let e=u.$implicit;a(2),_(e.journal_number),a(2),_(e.partner_name),a(2),_(e.payment_date),a(2),C(" ",e.currency==="dollar"?c(9,4,e.total_value):c(10,6,e.total_value)," ")}}function Ji(i,u){i&1&&(n(0,"tr")(1,"td",19),l(2),p(3,"translate"),r()()),i&2&&(a(2),C(" ",c(3,1,"No Records Found!")," "))}var Jt=(()=>{class i{constructor(){this.customerService=h(Ee),this.historyService=h(X),this.dateService=h(V),this.customers=this.customerService.customers,this.customersLoading=this.customerService.signal_tableLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.paymentsHistory=this.historyService.paymentsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new ae({payment_date:new F(null),partner_id:new F(null),payment_number:new F(null)})}ngOnInit(){this.submitSearch()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&this.searchForm.patchValue({payment_date:this.dateService.formatDate(this.searchForm.value.payment_date,"yyyy-MM-dd")}),this.historyService.fetchPaymentHistory(this.searchForm.value),console.log(this.paymentsHistory())}resetSearch(){this.searchForm.reset(),this.historyService.fetchPaymentHistory(null)}openEditDialog(e){this.selectedPayment=e,this.editDialogVisible=!0}onUpdatePayment(e){let o=this.paymentsHistory().findIndex(t=>t.journal_id===e.journal_id);this.paymentsHistory.update(t=>[...t.slice(0,o),e,...t.slice(o+1)]),this.editDialogVisible=!1}onDeletePayment(e){this.paymentsHistory.update(o=>{let t=this.paymentsHistory().findIndex(s=>s.journal_id===e.journal_id);return o.splice(t,1),[...o]}),this.editDialogVisible=!1}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["app-payment-history"]],decls:26,vars:41,consts:[[1,"grid","m-1"],[1,"col-12"],[3,"legend","toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"placeholder"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","filterBy","name",3,"options","loading","placeholder","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd",3,"showClear","showIcon","readonlyInput","placeholder"],["type","submit","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"label","loading"],["icon","pi pi-times","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","label","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"visibleChange","onUpdate","onDelete","visible","payment","mode"],["colspan","2","width","10%"],["size","small","icon","pi pi-print","disabled","",1,"p-button-secondary"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["colspan","11"]],template:function(o,t){o&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2),p(4,"translate"),n(5,"form",3),y("ngSubmit",function(){return t.submitSearch()}),n(6,"div",4)(7,"div",5),x(8,"input",6),p(9,"translate"),r(),n(10,"div",5),x(11,"p-dropdown",7),p(12,"translate"),r(),n(13,"div",5),x(14,"p-calendar",8),p(15,"translate"),r(),n(16,"div",5),x(17,"p-button",9),p(18,"translate"),n(19,"p-button",10),p(20,"translate"),y("onClick",function(){return t.resetSearch()}),r()()()()(),n(21,"p-table",11),b(22,Yi,16,15,"ng-template",12)(23,Zi,15,8,"ng-template",13)(24,Ji,4,3,"ng-template",14),r()()()(),n(25,"payment-dialog",15),E("visibleChange",function(f){return I(t.editDialogVisible,f)||(t.editDialogVisible=f),f}),y("onUpdate",function(f){return t.onUpdatePayment(f)})("onDelete",function(f){return t.onDeletePayment(f)}),r()),o&2&&(a(3),m("legend",c(4,28,"Search Form"))("toggleable",!0),a(2),m("formGroup",t.searchForm),a(3),m("placeholder",c(9,30,"Payment")),a(3),m("options",t.customers())("loading",t.customersLoading())("placeholder",c(12,32,"Select Customer"))("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(3),m("showClear",!0)("showIcon",!1)("readonlyInput",!0)("placeholder",c(15,34,"Date")),a(3),m("label",c(18,36,"Search"))("loading",t.loading()),a(2),m("label",c(20,38,"Reset"))("disabled",t.loading()),a(2),m("value",t.paymentsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(40,$i))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),w("visible",t.editDialogVisible),m("payment",t.selectedPayment)("mode","edit"))},dependencies:[le,G,k,re,pe,ce,N,H,O,R,$,W,L,de,rt,M,Z,z],styles:["[_nghost-%COMP%]  .p-fieldset-content{padding:.5rem!important}"]})}}return i})();var Xi=()=>[10,25,50],en=()=>({width:"95vw"});function tn(i,u){i&1&&(n(0,"th",22),l(1),p(2,"translate"),r()),i&2&&(a(),C(" ",c(2,1,"Customer")," "))}function nn(i,u){if(i&1&&(n(0,"tr")(1,"th"),l(2),p(3,"translate"),r(),b(4,tn,3,3,"th",19),n(5,"th",20),l(6),p(7,"translate"),r(),n(8,"th",20),l(9),p(10,"translate"),r(),n(11,"th"),l(12),p(13,"translate"),r(),n(14,"th",21),l(15,"Options"),r()()),i&2){let e=d();a(2),C("",c(3,5,"Invoice")," #"),a(2),m("ngIf",e.customersFeaturesEnabled()),a(2),_(c(7,7,"Inventory")),a(3),_(c(10,9,"Datetime")),a(3),_(c(13,11,"Total"))}}function on(i,u){if(i&1){let e=T();n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td"),l(6),r(),n(7,"td"),l(8),r(),n(9,"td"),l(10),p(11,"currency"),p(12,"lira"),r(),n(13,"td")(14,"p-button",23),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.showInvoiceDialog(t))}),r()(),n(15,"td")(16,"p-button",24),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.printInvoice(t))}),r()(),n(17,"td")(18,"p-button",25),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.openEditDialog(t))}),r()()()}if(i&2){let e=u.$implicit;a(2),_(e.invoice_number),a(2),_(e.customer_name||"---"),a(2),_(e.inventory_name),a(2),_(e.order_datetime),a(2),C(" ",e.currency==="dollar"?c(11,5,e.total_amount):c(12,7,e.total_amount)," ")}}function rn(i,u){i&1&&(n(0,"tr")(1,"td",26),l(2,"No Records Found!"),r()())}function an(i,u){i&1&&(n(0,"tr")(1,"th",29),l(2,"SKU"),r(),n(3,"th",20),l(4,"Barcode"),r(),n(5,"th",30),l(6,"Description"),r(),n(7,"th",20),l(8,"Unit Price"),r(),n(9,"th",29),l(10,"Qty"),r(),n(11,"th",20),l(12,"Total Price"),r()())}function sn(i,u){if(i&1&&(n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td"),l(6),r(),n(7,"td"),l(8),p(9,"currency"),p(10,"lira"),r(),n(11,"td"),l(12),r(),n(13,"td"),l(14),p(15,"currency"),p(16,"lira"),r()()),i&2){let e=u.$implicit,o=d(3);a(2),_(e.sku||"---"),a(2),_(e.barcode||"---"),a(2),_(e.product_name),a(2),C(" ",o.invoiceItems.currency=="dollar"?c(9,6,e.unit_price):c(10,8,e.unit_price)," "),a(4),_(e.quantity),a(2),C(" ",o.invoiceItems.currency=="dollar"?c(15,10,e.total_price):c(16,12,e.total_price)," ")}}function ln(i,u){if(i&1&&(n(0,"tr"),x(1,"td")(2,"td")(3,"td")(4,"td"),n(5,"td"),l(6),r(),n(7,"td"),l(8),p(9,"currency"),p(10,"lira"),r()()),i&2){let e=d(3);a(6),_(e.selectedInvoiceTotals.totalQty),a(2),C(" Total: ",e.invoiceItems.currency==="dollar"?c(9,2,e.selectedInvoiceTotals.totalPrice):c(10,4,e.selectedInvoiceTotals.totalPrice)," ")}}function pn(i,u){if(i&1&&(n(0,"p-table",28),b(1,an,13,0,"ng-template",12)(2,sn,17,14,"ng-template",13)(3,ln,11,6,"ng-template",17),r()),i&2){let e=d(2);m("value",e.invoiceItems)}}function cn(i,u){if(i&1&&b(0,pn,4,1,"p-table",27),i&2){let e=d();m("ngIf",e.invoiceItems.length!=0)}}function mn(i,u){if(i&1){let e=T();n(0,"p-button",31),y("onClick",function(){g(e);let t=d();return v(t.hideInvoiceDialog())}),r()}}var Xt=(()=>{class i{constructor(){this.customerService=h(Ee),this.historyService=h(X),this.decimalService=h(J),this.dateService=h(V),this.customersFeaturesService=h(pt),this.customersFeaturesEnabled=this.customersFeaturesService.customersFeaturesEnabled,this.customers=this.customerService.customers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0},this.subscriptions=new A,this.returnHistory=this.historyService.returnHistory,this.loading=this.historyService.signal_loading,this.searchForm=new ae({invoice_number:new F(null),customer_id:new F(null),invoice_date:new F(null)}),this.submitSearch()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=this.dateService.formatDate(this.searchForm.value.invoice_date,"yyyy-MM-dd")),this.historyService.fetchReturnHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReturnHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.currency=e.currency,this.invoiceItems.forEach(o=>{this.selectedInvoiceTotals.totalQty+=o.quantity,this.selectedInvoiceTotals.totalPrice=this.decimalService.add(this.selectedInvoiceTotals.totalPrice,o.total_price),this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,o.unit_cost)}),this.detailsDialogVisible=!0}printInvoice(e){}openEditDialog(e){this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalPrice:0,totalCost:0}}submitEdit(e){this.historyService.fetchReturnHistory(this.searchForm.value)}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["app-sell-history"]],decls:23,vars:30,consts:[[1,"grid","m-1"],[1,"col-12"],["legend","Search Form",3,"toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","customer_id","styleClass","p-inputtext-sm w-full","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Customer","filterBy","name",3,"options","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","placeholder","Date",3,"showIcon","showClear","readonlyInput"],["formControlName","invoice_number","type","search","placeholder","Invoice #","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full"],["type","submit","label","search","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"loading"],["icon","pi pi-times","label","Clear","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["header","Details","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","customers","return_invoice_edit"],["width","30%",4,"ngIf"],["width","15%"],["colspan","3","width","10%"],["width","30%"],["size","small","severity","success","icon","fas fa-eye",3,"onClick"],["size","small","severity","secondary","icon","pi pi-print",3,"onClick"],["size","small","severity","warning","icon","fas fa-edit",3,"onClick"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","10%"],["width","35%"],["label","Close","icon","pi pi-times","severity","secondary","size","small",3,"onClick"]],template:function(o,t){o&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2)(4,"form",3),y("ngSubmit",function(){return t.submitSearch()}),n(5,"div",4)(6,"div",5),x(7,"p-dropdown",6),r(),n(8,"div",5),x(9,"p-calendar",7),r(),n(10,"div",5),x(11,"input",8),r(),n(12,"div",5),x(13,"p-button",9),n(14,"p-button",10),y("onClick",function(){return t.resetSearch()}),r()()()()(),n(15,"p-table",11),b(16,nn,16,13,"ng-template",12)(17,on,19,9,"ng-template",13)(18,rn,3,0,"ng-template",14),r()()()(),n(19,"p-dialog",15),E("visibleChange",function(f){return I(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),y("onHide",function(){return t.hideInvoiceDialog()}),b(20,cn,1,1,"ng-template",16)(21,mn,1,0,"ng-template",17),r(),n(22,"edit-invoice",18),y("onHide",function(){return t.closeEditDialog()})("onSubmit",function(f){return t.submitEdit(f)}),r()),o&2&&(a(3),m("toggleable",!0),a(),m("formGroup",t.searchForm),a(3),m("options",t.customers())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(2),m("showIcon",!1)("showClear",!0)("readonlyInput",!0),a(4),m("loading",t.loading()),a(),m("disabled",t.loading()),a(),m("value",t.returnHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(28,Xi))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),U(D(29,en)),w("visible",t.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),a(3),m("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("customers",t.customers())("return_invoice_edit",!0))},dependencies:[Q,le,G,k,re,pe,ce,N,H,O,R,Y,$,W,L,de,_t,M,Z,z]})}}return i})();var ei=(()=>{class i{constructor(){this.apiService=h(K),this.http=h(ne),this.notificationService=h(q),this.suppliersService=h(ue),this.cashBalanceService=h(Ie),this.host=this.apiService.host,this.currentInvoice=P({}),this.signal_submited=P(!1),this.signal_submit_loading=P(!1),this.action_status$=new te(""),this.selectedSupplierLatestItems=new te([])}checkout(e,o){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.host()}/supply`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{o.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}returnCheckout(e,o){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.host()}/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{o.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}deleteInvoice(e,o){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host()}/supply/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{o.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}returnDeleteInvoice(e,o){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host()}/return/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{o.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=ie({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var dn=()=>({width:"95vw",height:"75vh"}),un=()=>({standalone:!0}),ti=i=>({invalid:i}),_n=(i,u)=>({"text-red-500":i,"text-orange-500":u}),hn=i=>({"text-red-500":i});function gn(i,u){i&1&&(n(0,"tr")(1,"th",27),l(2,"Barcode"),r(),n(3,"th",28),l(4,"Description"),r(),n(5,"th",29),l(6,"Unit"),r(),n(7,"th",30),l(8,"Qty"),r(),n(9,"th",29),l(10,"Total"),r(),n(11,"th",30),l(12,"Del?"),r()())}function vn(i,u){if(i&1){let e=T();n(0,"p-inputNumber",37),E("ngModelChange",function(t){g(e);let s=d().$implicit;return I(s.unit_price,t)||(s.unit_price=t),v(t)}),y("ngModelChange",function(){g(e);let t=d().$implicit,s=d(2);return v(s.setPrice(t))}),r()}if(i&2){let e=d().$implicit;w("ngModel",e.unit_price),m("maxFractionDigits",2)("min",0)}}function fn(i,u){i&1&&x(0,"i",40)}function yn(i,u){if(i&1&&(n(0,"span",38),l(1),p(2,"currency"),n(3,"span"),b(4,fn,1,0,"i",39),r()()),i&2){let e=d().$implicit,o=d(2);m("ngClass",oe(5,_n,!e.unit_price,o.getPriceWarining(e))),a(),_(c(2,3,e.unit_price)),a(3),m("ngIf",o.getPriceWarining(e))}}function Cn(i,u){if(i&1){let e=T();n(0,"p-inputNumber",41),E("ngModelChange",function(t){g(e);let s=d().$implicit;return I(s.quantity,t)||(s.quantity=t),v(t)}),y("ngModelChange",function(){g(e);let t=d().$implicit,s=d(2);return v(s.setQty(t))}),r()}if(i&2){let e=d().$implicit;w("ngModel",e.quantity)}}function Sn(i,u){if(i&1&&(n(0,"span",38),l(1),r()),i&2){let e=d().$implicit;m("ngClass",ee(2,hn,!e.quantity)),a(),_(e.quantity)}}function bn(i,u){if(i&1){let e=T();n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td",31)(6,"p-cellEditor"),b(7,vn,1,3,"ng-template",32)(8,yn,5,8,"ng-template",33),r()(),n(9,"td",34)(10,"p-cellEditor"),b(11,Cn,1,1,"ng-template",32)(12,Sn,2,4,"ng-template",33),r()(),n(13,"td"),l(14),p(15,"currency"),r(),n(16,"td",35),y("click",function(){let t=g(e).rowIndex,s=d(2);return v(s.removeRow(t))}),x(17,"i",36),r()()}if(i&2){let e=u.$implicit;a(2),_(e.barcode||"---"),a(2),_(e.product_name),a(),m("pEditableColumn",e.unit_price)("ngClass",ee(9,ti,!e.unit_price)),a(4),m("pEditableColumn",e.quantity)("ngClass",ee(11,ti,!e.quantity)),a(5),C(" ",c(15,7,e.unit_price*e.quantity)," ")}}function xn(i,u){if(i&1&&(n(0,"h4",43),l(1),r()),i&2){let e=d(3);a(),C(" Total units: ",e.invoiceTotal.total_qty," ")}}function wn(i,u){if(i&1&&b(0,xn,2,1,"h4",42),i&2){let e=d(2);m("ngIf",e.invoiceTotal.total_qty)}}function In(i,u){i&1&&(n(0,"tr",44)(1,"td",45),l(2,"No data yet!"),r()())}function En(i,u){if(i&1){let e=T();n(0,"p-card",6)(1,"div",7)(2,"div",8)(3,"div",9),x(4,"div",10),n(5,"label"),l(6,"Invoice Date"),r(),n(7,"p-calendar",11),E("ngModelChange",function(t){g(e);let s=d();return I(s.invoice_date,t)||(s.invoice_date=t),v(t)}),r()()(),n(8,"div",8)(9,"div",10)(10,"label",12),l(11,"Supplier"),r(),n(12,"p-dropdown",13),E("ngModelChange",function(t){g(e);let s=d();return I(s.supplier_id,t)||(s.supplier_id=t),v(t)}),y("onChange",function(t){g(e);let s=d();return v(s.supplierChange(t.value))}),r()()(),n(13,"div",8)(14,"div",10)(15,"label",14),l(16,"Inventory"),r(),n(17,"p-dropdown",15),E("ngModelChange",function(t){g(e);let s=d();return I(s.selectedInventoryId,t)||(s.selectedInventoryId=t),v(t)}),r()()(),n(18,"div",16)(19,"h3",17),l(20),p(21,"currency"),r(),n(22,"h3",18),l(23),p(24,"lira"),r()()(),n(25,"div",7)(26,"div",19)(27,"p-table",20,0),b(29,gn,13,0,"ng-template",21)(30,bn,18,13,"ng-template",3)(31,wn,1,1,"ng-template",22)(32,In,3,0,"ng-template",23),r()(),n(33,"div",24)(34,"p-autoComplete",25,1),E("ngModelChange",function(t){g(e);let s=d();return I(s.search_product,t)||(s.search_product=t),v(t)}),y("completeMethod",function(t){g(e);let s=d();return v(s.searchItem(t))})("onKeyUp",function(t){g(e);let s=d();return v(s.submitInvoiceInput(t))}),r(),n(36,"p-button",26),y("onClick",function(){g(e);let t=d();return v(t.openProductsDialog())}),r()()()()}if(i&2){let e=d();a(7),w("ngModel",e.invoice_date),m("ngModelOptions",D(31,un))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0)("showSeconds",!0)("disabled",!0),a(5),w("ngModel",e.supplier_id),m("options",e.suppliers)("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(5),w("ngModel",e.selectedInventoryId),m("options",e.inventories())("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(3),C(" USD: ",c(21,27,e.invoiceTotal.total_dollar)," "),a(3),C(" LBP: ",c(24,29,e.invoiceTotal.total_dollar*e.invoice.exchange_rate)," "),a(4),Me("scrollHeight",e.vh),m("value",e.invoice_items())("scrollable",!0),a(7),w("ngModel",e.search_product),m("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function Tn(i,u){if(i&1){let e=T();n(0,"p-button",46),y("onClick",function(){g(e);let t=d();return v(t.deleteInvoice())}),r(),n(1,"p-button",47),y("onClick",function(){g(e);let t=d();return v(t.closeEditDialog())}),r(),n(2,"p-button",48),y("onClick",function(){g(e);let t=d();return v(t.submitEditInvoice())}),r()}if(i&2){let e=d();m("disabled",e.submitted()),a(),m("disabled",e.submitted()),a(),m("loading",e.submitted())("disabled",e.invoice_items().length==0)}}var ii=(()=>{class i{constructor(){this.visible=!1,this.suppliers=[],this.return_invoice_edit=!1,this.onSubmit=new _e,this.onHide=new _e,this.stockService=h(me),this.editInvoiceService=h(ei),this.authService=h(we),this.confirmationService=h(He),this.notificationsService=h(q),this.supplyService=h(dt),this.dateService=h(V),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new Be,this.supplier_id=null,this.invoice_number="123",this.invoice_items=P([]),this.selectedInventoryId=P(null),this.selectedSupplierLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new A,this.products=this.stockService.products,this.matching_products=[],this.inventories=this.stockService.inventories,this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.supplyService.barcodeResponse.subscribe(e=>{e&&(this.addProduct(e),this.supplyService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.dateService.formatDate(this.invoice.order_datetime,"yyyy-MM-dd HH:mm:ss"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.invoice_items.set(structuredClone(this.invoice.items)),this.supplier_id=this.invoice.partner_id_fk,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_cost,this.selectedInventoryId.set(this.invoice.inventory_id),this.supplierChange(this.invoice.supplier_id))}setPrice(e){e.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(e){e.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.invoice_items().find(o=>!o.unit_price||!o.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){let o=this.supplyService.factor(),t=structuredClone(this.invoice_items()),s=t.find(f=>f.product_id===e.product_id);s?s.quantity+=o:t.push({product_id:e.product_id,barcode:e.barcode,product_name:e.product_name,unit_cost:e.unit_cost_usd,unit_price:e.unit_cost_usd,quantity:o,unit_abbreviation:e.unit_abbreviation,product_unit_id:e.unit_id_fk,currency:e.currency}),this.invoice_items.set(t),this.supplyService.factor.set(1),this.calculateTotal("add")}submitInvoiceInput(e){e.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.supplyService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(e){if(e){let o=-1,t=["*","+"];for(let S=0;S<t.length;S++)if(e.indexOf(t[S])!==-1){o=e.indexOf(t[S]);break}let s=e.substring(0,o)||1,f=parseInt(e.substring(o+1,e.length));o!=-1&&o!=0?(this.supplyService.factor.set(parseInt(s)),this.supplyService.submitBarcode(f)):this.supplyService.submitBarcode(e)}}calculateTotal(e){let o=new Be,t=this.invoice_items();return t.length>0&&(t.forEach(s=>{o.total_qty+=s.quantity,o.cost_dollar+=s.unit_cost*s.quantity,o.subtotal_dollar+=s.unit_price*s.quantity}),o.total_dollar=o.subtotal_dollar),this.invoiceTotal=o,console.log("called"),console.log(this.invoiceTotal.total_qty),o}submitEditInvoice(){let e=this.validateItems();e?e&&this.notificationsService.showError("Please enter price for all items","home"):this.editInvoiceService.checkout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number,currency:"dollar",inventory_id:this.selectedInventoryId()},this.stockService)}searchItem(e){let o=this.products(),t=[],s=e.query;for(let f=0;f<o.length;f++){let S=o[f];S.product_name.toLowerCase().indexOf(s.toLowerCase())>-1&&t.push(S)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}supplierChange(e){}removeRow(e){this.invoice_items().splice(e,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoice_items.set([]),this.submitted.set(!1),this.invoiceTotal=new Be}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(o=>{this.addProduct(o)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}getPriceWarining(e){if(!e.unit_price)return!1;let o=e.unit_cost||0,t=e.unit_price;return typeof o=="string"&&(o=parseFloat(o)),typeof t=="string"&&(t=parseFloat(t)),t<o}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["edit-purchase"]],inputs:{visible:"visible",invoice:"invoice",suppliers:"suppliers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ve],decls:4,vars:9,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],["price","cost",3,"onHide","onSubmit","visible","products"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime","showSeconds","disabled"],["for","supplier"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","autoOptionFocus"],["for","inventory"],["styleClass","p-inputtext-sm","id","inventory","appendTo","body","optionLabel","inventory_name","optionValue","inventory_id","placeholder","Select Inventory","filterBy","inventory_name",3,"ngModelChange","ngModel","options","filter","showClear","autoOptionFocus"],[1,"col-12","md:col-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["label","Multi Select","severity","warning","styleClass","ml-2","size","small","icon","pi pi-list",3,"onClick"],["width","20%"],["width","40%"],["width","15%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","autoSelect","","step","0",1,"p-inputtext-sm","priceEditable",3,"ngModelChange","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["autoSelect","","min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"onClick","disabled"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",1,"p-button-secondary","w-full","mt-2","md:w-auto","md:ml-2",3,"onClick","disabled"],["label","Submit Edit","icon","pi pi-check","severity","success","size","small","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading","disabled"]],template:function(o,t){o&1&&(n(0,"p-dialog",2),E("visibleChange",function(f){return I(t.visible,f)||(t.visible=f),f}),y("onHide",function(){return t.closeEditDialog()}),b(1,En,37,32,"ng-template",3)(2,Tn,3,4,"ng-template",4),r(),n(3,"products-dialog",5),y("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(f){return t.assignSelectedProducts(f)}),r()),o&2&&(U(D(8,dn)),w("visible",t.visible),m("modal",!0)("closable",!0)("maximizable",!0),a(3),m("visible",t.productsDialogVisible)("products",t.products))},dependencies:[xe,Q,k,se,De,N,H,Fe,Re,O,R,Y,W,L,ke,Oe,Ht,M,Z],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:40px;height:28px}.priceEditable[_ngcontent-%COMP%]{width:60px;height:28px;text-align:center}[_nghost-%COMP%]  .p-inputnumber-input{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}"]})}}return i})();var Dn=()=>[10,25,50],Bn=()=>({width:"95vw"});function Vn(i,u){i&1&&(n(0,"tr")(1,"th"),l(2),p(3,"translate"),r(),n(4,"th"),l(5),p(6,"translate"),r(),n(7,"th"),l(8),p(9,"translate"),r(),n(10,"th"),l(11),p(12,"translate"),r(),n(13,"th"),l(14),p(15,"translate"),r(),n(16,"th",19),l(17),p(18,"translate"),r()()),i&2&&(a(2),C("",c(3,6,"Invoice")," #"),a(3),_(c(6,8,"Supplier")),a(3),_(c(9,10,"Datetime")),a(3),_(c(12,12,"Inventory")),a(3),_(c(15,14,"Total")),a(3),C(" ",c(18,16,"Options")," "))}function Mn(i,u){if(i&1){let e=T();n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td"),l(6),r(),n(7,"td"),l(8),r(),n(9,"td"),l(10),p(11,"currency"),r(),n(12,"td")(13,"p-button",20),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.showInvoiceDialog(t))}),r()(),n(14,"td")(15,"p-button",21),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.openEditDialog(t))}),r()()()}if(i&2){let e=u.$implicit;a(2),_(e.invoice_number),a(2),_(e.supplier_name||"---"),a(2),_(e.order_datetime),a(2),_(e.inventory_name||"---"),a(2),_(c(11,5,e.total_cost))}}function Hn(i,u){i&1&&(n(0,"tr")(1,"td",22),l(2),p(3,"translate"),r()()),i&2&&(a(2),C(" ",c(3,1,"No Records Found!")," "))}function kn(i,u){i&1&&(n(0,"tr")(1,"th",25),l(2),p(3,"translate"),r(),n(4,"th",26),l(5),p(6,"translate"),r(),n(7,"th",25),l(8),p(9,"translate"),r(),n(10,"th",27),l(11),p(12,"translate"),r(),n(13,"th",25),l(14),p(15,"translate"),r()()),i&2&&(a(2),_(c(3,5,"Barcode")),a(3),_(c(6,7,"Description")),a(3),_(c(9,9,"Unit Price")),a(3),_(c(12,11,"Qty")),a(3),_(c(15,13,"Total Price")))}function Fn(i,u){if(i&1&&(n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td"),l(6),p(7,"currency"),r(),n(8,"td"),l(9),r(),n(10,"td"),l(11),p(12,"currency"),r()()),i&2){let e=u.$implicit;a(2),_(e.barcode||"---"),a(2),_(e.product_name),a(2),C(" ",c(7,5,e.unit_cost)," "),a(3),_(e.quantity),a(2),C(" ",c(12,7,e.unit_cost*e.quantity)," ")}}function Rn(i,u){if(i&1&&(n(0,"tr"),x(1,"td")(2,"td")(3,"td"),n(4,"td"),l(5),r(),n(6,"td"),l(7),p(8,"currency"),r()()),i&2){let e=d(3);a(5),_(e.selectedInvoiceTotals.totalQty),a(2),C(" ",c(8,2,e.selectedInvoiceTotals.totalCost)," ")}}function On(i,u){if(i&1&&(n(0,"p-table",24),b(1,kn,16,15,"ng-template",12)(2,Fn,13,9,"ng-template",13)(3,Rn,9,4,"ng-template",17),r()),i&2){let e=d(2);m("value",e.invoiceItems)}}function Wn(i,u){if(i&1&&b(0,On,4,1,"p-table",23),i&2){let e=d();m("ngIf",e.invoiceItems.length!=0)}}function Ln(i,u){if(i&1){let e=T();n(0,"p-button",28),p(1,"translate"),y("onClick",function(){g(e);let t=d();return v(t.hideInvoiceDialog())}),r()}i&2&&m("label",c(1,1,"Close"))}var ni=(()=>{class i{constructor(){this.suppliersService=h(ue),this.historyService=h(X),this.decimalService=h(J),this.printService=h(Pe),this.dateService=h(V),this.suppliers=this.suppliersService.suppliers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0},this.subscriptions=new A,this.purchasesHistory=this.historyService.purchasesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new ae({invoice_number:new F(null),supplier_id:new F(null),invoice_date:new F(null)}),this.submitSearch()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=this.dateService.formatDate(this.searchForm.value.invoice_date,"yyyy-MM-dd")),this.historyService.fetchPurchasesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchPurchasesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(o=>{console.log(o),this.selectedInvoiceTotals.totalQty+=o.quantity,this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,o.unit_cost*o.quantity)}),this.detailsDialogVisible=!0}openEditDialog(e){this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0}}submitEdit(e){this.historyService.fetchPurchasesHistory(this.searchForm.value)}printInvoice(e){e.type="sale",this.printService.print(e)}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["app-return-purchase-history"]],decls:30,vars:51,consts:[[1,"grid","m-1"],[1,"col-12"],[3,"legend","toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"placeholder"],["formControlName","supplier_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","filterBy","name",3,"options","placeholder","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd",3,"showIcon","showClear","readonlyInput","placeholder","showButtonBar"],["type","submit","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"label","loading"],["icon","pi pi-times","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","label","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","top",3,"visibleChange","onHide","header","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","suppliers"],["colspan","3","width","10%"],["size","small","severity","success","icon","fas fa-eye",3,"onClick"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","20%"],["width","35%"],["width","5%"],["icon","pi pi-times","severity","secondary","size","small",3,"onClick","label"]],template:function(o,t){o&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2),p(4,"translate"),n(5,"form",3),y("ngSubmit",function(){return t.submitSearch()}),n(6,"div",4)(7,"div",5),x(8,"input",6),p(9,"translate"),r(),n(10,"div",5),x(11,"p-dropdown",7),p(12,"translate"),r(),n(13,"div",5),x(14,"p-calendar",8),p(15,"translate"),r(),n(16,"div",5),x(17,"p-button",9),p(18,"translate"),n(19,"p-button",10),p(20,"translate"),y("onClick",function(){return t.resetSearch()}),r()()()()(),n(21,"p-table",11),b(22,Vn,19,18,"ng-template",12)(23,Mn,16,7,"ng-template",13)(24,Hn,4,3,"ng-template",14),r()()()(),n(25,"p-dialog",15),p(26,"translate"),E("visibleChange",function(f){return I(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),y("onHide",function(){return t.hideInvoiceDialog()}),b(27,Wn,1,1,"ng-template",16)(28,Ln,2,3,"ng-template",17),r(),n(29,"edit-purchase",18),y("onHide",function(){return t.closeEditDialog()})("onSubmit",function(f){return t.submitEdit(f)}),r()),o&2&&(a(3),m("legend",c(4,35,"Search Form"))("toggleable",!0),a(2),m("formGroup",t.searchForm),a(3),m("placeholder",c(9,37,"Invoice")),a(3),m("options",t.suppliers())("placeholder",c(12,39,"Select Supplier"))("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(3),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("placeholder",c(15,41,"Date"))("showButtonBar",!0),a(3),m("label",c(18,43,"Search"))("loading",t.loading()),a(2),m("label",c(20,45,"Reset"))("disabled",t.loading()),a(2),m("value",t.purchasesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(49,Dn))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),U(D(50,Bn)),m("header",c(26,47,"Details")),w("visible",t.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),a(4),m("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("suppliers",t.suppliers()))},dependencies:[Q,le,G,k,re,pe,ce,N,H,O,R,Y,$,W,L,de,ii,M,z],styles:["[_nghost-%COMP%]  .p-fieldset-content{padding:.5rem!important}"]})}}return i})();var Nn=()=>[10,25,50];function qn(i,u){i&1&&(n(0,"tr")(1,"th"),l(2),p(3,"translate"),r(),n(4,"th"),l(5),p(6,"translate"),r(),n(7,"th"),l(8),p(9,"translate"),r(),n(10,"th"),l(11),p(12,"translate"),r(),n(13,"th"),l(14),p(15,"translate"),r(),n(16,"th",16),l(17),p(18,"translate"),r()()),i&2&&(a(2),C("",c(3,6,"Payment")," #"),a(3),_(c(6,8,"Supplier")),a(3),_(c(9,10,"Datetime")),a(3),_(c(12,12,"Total")),a(3),_(c(15,14,"Notes")),a(3),C(" ",c(18,16,"Options")," "))}function jn(i,u){if(i&1){let e=T();n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td"),l(6),r(),n(7,"td"),l(8),p(9,"currency"),r(),n(10,"td"),l(11),r(),n(12,"td"),x(13,"button",17),r(),n(14,"td")(15,"button",18),y("click",function(){let t=g(e).$implicit,s=d();return v(s.openEditDialog(t))}),r()()()}if(i&2){let e=u.$implicit;a(2),_(e.journal_number),a(2),_(e.partner_name),a(2),_(e.payment_date),a(2),_(c(9,5,e.total_value)),a(3),_(e.journal_notes||"---")}}function zn(i,u){i&1&&(n(0,"tr")(1,"td",19),l(2),p(3,"translate"),r()()),i&2&&(a(2),C(" ",c(3,1,"No Records Found!")," "))}var oi=(()=>{class i{constructor(){this.suppliersService=h(ue),this.historyService=h(X),this.dateService=h(V),this.suppliers=this.suppliersService.suppliers,this.suppliersLoading=this.suppliersService.suppliersLoading,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.subscriptions=new A,this.receiptsHistory=this.historyService.receiptsHistory,this.loading=this.historyService.signal_loading,this.searchForm=new ae({payment_date:new F(null),partner_id:new F(null),payment_number:new F(null)})}ngOnInit(){this.submitSearch()}get partner_id(){return this.searchForm.get("partner_id")}submitSearch(){this.searchForm.value.payment_date&&(this.searchForm.value.payment_date=this.dateService.formatDate(this.searchForm.value.payment_date)),this.historyService.fetchReceiptsHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReceiptsHistory(null)}openEditDialog(e){this.selectedPayment=e,this.editDialogVisible=!0}getPaymentDilogResult(e){this.historyService.fetchReceiptsHistory(this.searchForm.value)}onUpdatePayment(e){let o=this.receiptsHistory().findIndex(t=>t.journal_id===e.journal_id);this.receiptsHistory.update(t=>[...t.slice(0,o),e,...t.slice(o+1)]),this.editDialogVisible=!1}onDeletePayment(e){this.receiptsHistory.update(o=>{let t=this.receiptsHistory().findIndex(s=>s.journal_id===e.journal_id);return o.splice(t,1),[...o]}),this.editDialogVisible=!1}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["app-receipts-history"]],decls:26,vars:41,consts:[[1,"grid","m-1"],[1,"col-12"],[3,"legend","toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","payment_number","type","search","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"placeholder"],["formControlName","partner_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","filterBy","name",3,"options","loading","placeholder","filter","showClear","autoOptionFocus"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd",3,"showIcon","showClear","readonlyInput","placeholder"],["type","submit","icon","pi pi-search","size","small","severity","success",1,"mr-2",3,"label","loading"],["icon","pi pi-times","size","small","severity","danger",3,"onClick","label","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],[3,"visibleChange","onUpdate","onDelete","visible","payment","mode"],["colspan","2","width","10%"],["size","small","pButton","","pRipple","","icon","pi pi-print","disabled","",1,"p-button-secondary"],["size","small","pButton","","pRipple","","icon","fas fa-edit","severity","warning",3,"click"],["colspan","11"]],template:function(o,t){o&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2),p(4,"translate"),n(5,"form",3),y("ngSubmit",function(){return t.submitSearch()}),n(6,"div",4)(7,"div",5),x(8,"input",6),p(9,"translate"),r(),n(10,"div",5),x(11,"p-dropdown",7),p(12,"translate"),r(),n(13,"div",5),x(14,"p-calendar",8),p(15,"translate"),r(),n(16,"div",5),x(17,"p-button",9),p(18,"translate"),n(19,"p-button",10),p(20,"translate"),y("onClick",function(){return t.resetSearch()}),r()()()()(),n(21,"p-table",11),b(22,qn,19,18,"ng-template",12)(23,jn,16,7,"ng-template",13)(24,zn,4,3,"ng-template",14),r()()()(),n(25,"supplier-payment-dialog",15),E("visibleChange",function(f){return I(t.editDialogVisible,f)||(t.editDialogVisible=f),f}),y("onUpdate",function(f){return t.onUpdatePayment(f)})("onDelete",function(f){return t.onDeletePayment(f)}),r()),o&2&&(a(3),m("legend",c(4,28,"Search Form"))("toggleable",!0),a(2),m("formGroup",t.searchForm),a(3),m("placeholder",c(9,30,"Payment")),a(3),m("options",t.suppliers())("loading",t.suppliersLoading())("placeholder",c(12,32,"Select Supplier"))("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(3),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("placeholder",c(15,34,"Date")),a(3),m("label",c(18,36,"Search"))("loading",t.loading()),a(2),m("label",c(20,38,"Reset"))("disabled",t.loading()),a(2),m("value",t.receiptsHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(40,Nn))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),w("visible",t.editDialogVisible),m("payment",t.selectedPayment)("mode","edit"))},dependencies:[le,G,k,re,pe,ce,N,H,Je,O,R,$,W,L,de,ut,M,z],styles:["[_nghost-%COMP%]  .p-fieldset-content{padding:.5rem!important}"]})}}return i})();var ri=(()=>{class i{constructor(){this.api=h(K),this.notificationService=h(q),this.http=h(ne),this.dateService=h(V),this.currencyService=h(tt),this.defaultCurrency=this.currencyService.defaultCurrency,this.startDate=P(this.dateService.getStartOfMonth()),this.endDate=P(this.dateService.getCurrentDate()),this.selectedCurrency=P(this.defaultCurrency()),this.loadingTransactions=P(!1),this.cashTransactions=P([])}startDateChanged(){this.startDate.set(this.dateService.formatDate(this.startDate(),"yyyy-MM-dd"))}getCashTransactions(e,o){this.loadingTransactions.set(!0),e=this.dateService.formatDate(e,"yyyy-MM-dd"),o=this.dateService.formatDate(o,"yyyy-MM-dd"),this.http.get(`${this.api.host()}/balance/transactions/${e}&${o}&${this.selectedCurrency()}`).subscribe({next:t=>{this.cashTransactions.set(t),this.loadingTransactions.set(!1)},error:t=>{this.notificationService.handleError(t.error,"home"),this.loadingTransactions.set(!1)}})}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=ie({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var An=()=>["dollar","lira"],Un=(i,u)=>({"text-300":i,"text-green-600":u}),Qn=(i,u)=>({"text-300":i,"text-red-600":u}),Kn=(i,u,e)=>({"text-red-600":i,"text-green-600":u,"font-bold":e}),Gn=(i,u)=>({"text-red-600":i,"text-green-600":u});function $n(i,u){if(i&1){let e=T();n(0,"label",7),l(1),p(2,"translate"),r(),n(3,"p-calendar",8),E("ngModelChange",function(t){g(e);let s=d();return I(s.startDate,t)||(s.startDate=t),v(t)}),y("onSelect",function(){g(e);let t=d();return v(t.startDateChanged())}),r(),n(4,"label",9),l(5),p(6,"translate"),r(),n(7,"p-calendar",8),E("ngModelChange",function(t){g(e);let s=d();return I(s.endDate,t)||(s.endDate=t),v(t)}),y("onSelect",function(){g(e);let t=d();return v(t.endDateChanged())}),r()}if(i&2){let e=d();a(),_(c(2,14,"Start Date")),a(2),w("ngModel",e.startDate),m("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input"),a(2),_(c(6,16,"End Date")),a(2),w("ngModel",e.endDate),m("showIcon",!0)("readonlyInput",!0)("showButtonBar",!0)("required",!0)("iconDisplay","input")}}function Yn(i,u){if(i&1){let e=T();n(0,"label",7),l(1),p(2,"translate"),r(),n(3,"p-dropdown",10),E("ngModelChange",function(t){g(e);let s=d();return I(s.selectedCurrency,t)||(s.selectedCurrency=t),v(t)}),y("ngModelChange",function(){g(e);let t=d();return v(t.submitSearch())}),r()}if(i&2){let e=d();a(),_(c(2,4,"Account")),a(2),m("options",D(6,An)),w("ngModel",e.selectedCurrency),m("autoOptionFocus",!1)}}function Zn(i,u){if(i&1){let e=T();n(0,"p-button",11),p(1,"translate"),y("onClick",function(){g(e);let t=d();return v(t.selectToday())}),r(),n(2,"p-button",12),p(3,"translate"),y("onClick",function(){g(e);let t=d();return v(t.selectThisMonth())}),r(),n(4,"p-button",11),p(5,"translate"),y("onClick",function(){g(e);let t=d();return v(t.selectThisYear())}),r()}i&2&&(m("label",c(1,6,"Today"))("size","small"),a(2),m("label",c(3,8,"This Month"))("size","small"),a(2),m("label",c(5,10,"This Year"))("size","small"))}function Jn(i,u){i&1&&(n(0,"tr")(1,"th",13),l(2),p(3,"translate"),r(),n(4,"th",13),l(5),p(6,"translate"),r(),n(7,"th",14),l(8),p(9,"translate"),r(),n(10,"th",14),l(11),p(12,"translate"),r(),n(13,"th",14),l(14),p(15,"translate"),r(),n(16,"th",14),l(17),p(18,"translate"),r()()),i&2&&(a(2),_(c(3,6,"Date")),a(3),_(c(6,8,"Transaction")),a(3),_(c(9,10,"Description")),a(3),_(c(12,12,"Debit")),a(3),_(c(15,14,"Credit")),a(3),_(c(18,16,"Balance")))}function Xn(i,u){if(i&1&&(n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td"),l(6),p(7,"translate"),r(),n(8,"td",15),l(9),p(10,"currency"),p(11,"lira"),r(),n(12,"td",15),l(13),p(14,"currency"),p(15,"lira"),r(),n(16,"td",15),l(17),p(18,"currency"),p(19,"lira"),r()()),i&2){let e=u.$implicit,o=u.rowIndex,t=d();a(2),C(" ",e.journal_date||"Before "+t.startDate()," "),a(2),_(e.journal_number||"---"),a(2),C(" ",c(7,9,e.journal_description)||"---"," "),a(2),m("ngClass",oe(23,Un,e.debit==0,e.debit!=0)),a(),C(" ",t.selectedCurrency()==="dollar"?c(10,11,e.debit):c(11,13,e.debit)," "),a(3),m("ngClass",oe(26,Qn,e.credit==0,e.credit!=0)),a(),C(" ",t.selectedCurrency()==="dollar"?c(14,15,e.credit):c(15,17,e.credit)," "),a(3),m("ngClass",xt(29,Kn,t.balances[o]<0,t.balances[o]>0,t.balances[o]==0)),a(),C(" ",t.selectedCurrency()==="dollar"?c(18,19,t.balances[o]):c(19,21,t.balances[o])," ")}}function eo(i,u){if(i&1&&(n(0,"tr"),x(1,"td",16),n(2,"td"),l(3),p(4,"translate"),r(),n(5,"td",17),l(6),p(7,"currency"),p(8,"lira"),r(),n(9,"td",18),l(10),p(11,"currency"),p(12,"lira"),r(),n(13,"td",15),l(14),p(15,"currency"),p(16,"lira"),r()()),i&2){let e=d();a(3),_(c(4,5,"Balance Due")),a(3),C(" ",e.selectedCurrency()==="dollar"?c(7,7,e.totalDebit):c(8,9,e.totalDebit)," "),a(4),C(" ",e.selectedCurrency()==="dollar"?c(11,11,e.totalCredit):c(12,13,e.totalCredit)," "),a(3),m("ngClass",oe(19,Gn,e.balances[e.balances.length-1]<0,e.balances[e.balances.length-1]>0)),a(),C(" ",e.selectedCurrency()==="dollar"?c(15,15,e.balances[e.balances.length-1]):c(16,17,e.balances[e.balances.length-1])," ")}}var gt=(()=>{class i{constructor(){this.transactionService=h(ri),this.fb=h($e),this.dateService=h(V),this.decimalService=h(J),this.loadingTransactions=this.transactionService.loadingTransactions,this.cashTransactions=this.transactionService.cashTransactions,this.startDate=this.transactionService.startDate,this.endDate=this.transactionService.endDate,this.selectedCurrency=this.transactionService.selectedCurrency,this.balances=[],this.totalDebit=0,this.totalCredit=0,this.submitSearch(),wt(()=>{let e=this.cashTransactions();if(e.length>0){this.balances=[],this.balances[0]=parseFloat(e[0].balance);for(let o=1;o<e.length;o++)this.balances[o]=this.balances[o-1]+parseFloat(e[o].debit)-parseFloat(e[o].credit);this.calculateTotals(e)}else this.balances=[]})}submitSearch(){this.transactionService.getCashTransactions(this.startDate(),this.endDate())}startDateChanged(){this.transactionService.startDateChanged(),this.submitSearch()}endDateChanged(){this.submitSearch()}selectToday(){this.transactionService.startDate.set(this.dateService.getCurrentDate()),this.transactionService.endDate.set(this.dateService.getCurrentDate()),this.submitSearch()}selectThisMonth(){this.transactionService.startDate.set(this.dateService.getStartOfMonth()),this.transactionService.endDate.set(this.dateService.getEndOfMonth()),this.submitSearch()}selectThisYear(){this.transactionService.startDate.set(this.dateService.getStartOfYear()),this.transactionService.endDate.set(this.dateService.getEndOfYear()),this.submitSearch()}calculateTotals(e){this.totalDebit=0,this.totalCredit=0;for(let o=1;o<e.length;o++)this.totalDebit=this.decimalService.add(this.totalDebit,parseFloat(e[o].debit)),this.totalCredit=this.decimalService.add(this.totalCredit,parseFloat(e[o].credit))}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["cash-transactions"]],standalone:!0,features:[bt],decls:9,vars:2,consts:[["pTemplate","left"],["pTemplate","center"],["pTemplate","right"],["dataKey","account_number","styleClass","p-datatable-sm","scrollHeight","68vh",1,"ledger_table",3,"value","scrollable"],["pTemplate","header"],["pTemplate","body"],["pTemplate","footer"],[1,"mr-2"],["styleClass","p-inputtext-sm","dateFormat","yy-mm-dd",3,"ngModelChange","onSelect","ngModel","showIcon","readonlyInput","showButtonBar","required","iconDisplay"],[1,"ml-5","mr-2"],["placeholder","Select currency...","styleClass","p-inputtext-sm","appendTo","body",3,"ngModelChange","options","ngModel","autoOptionFocus"],["severity","secondary",3,"onClick","label","size"],["styleClass","mx-2","severity","secondary",3,"onClick","label","size"],["width","20%"],["width","15%"],[3,"ngClass"],["colspan","2"],[1,"text-green-600"],[1,"text-red-600"]],template:function(o,t){o&1&&(n(0,"p-card")(1,"p-toolbar"),b(2,$n,8,18,"ng-template",0)(3,Yn,4,7,"ng-template",1)(4,Zn,6,12,"ng-template",2),r(),n(5,"p-table",3),b(6,Jn,19,18,"ng-template",4)(7,Xn,20,33,"ng-template",5)(8,eo,17,22,"ng-template",6),r()()),o&2&&(a(5),m("value",t.cashTransactions())("scrollable",!0))},dependencies:[Ze,R,H,at,et,nt,L,O,ot,N,Xe,M,it,W,Ye,k,It,se,Ge,xe,ct,kt,z,Z]})}}return i})();var ai=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["app-cash-history"]],decls:3,vars:0,consts:[[1,"grid","m-1"],[1,"col-12"]],template:function(o,t){o&1&&(n(0,"div",0)(1,"div",1),x(2,"cash-transactions"),r()())},dependencies:[gt]})}}return i})();var si=(()=>{class i{constructor(){this.apiService=h(K),this.http=h(ne),this.notificationService=h(q),this.suppliersService=h(ue),this.cashBalanceService=h(Ie),this.host=this.apiService.host,this.currentInvoice=P({}),this.signal_submited=P(!1),this.signal_submit_loading=P(!1),this.action_status$=new te(""),this.selectedSupplierLatestItems=new te([])}checkout(e,o){this.signal_submited.set(!0),this.signal_submit_loading.set(!0),this.http.put(`${this.host()}/supply/return`,e).subscribe({next:t=>{this.notificationService.showSuccess("Invoice Updated","home")},error:t=>{this.notificationService.showError(t.error.message,"home"),this.signal_submited.set(!1),this.signal_submit_loading.set(!1)},complete:()=>{o.getItems(),this.signal_submited.set(!1),this.signal_submit_loading.set(!1),this.action_status$.next("UPDATE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}deleteInvoice(e,o){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host()}/supply/return/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{o.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}returnDeleteInvoice(e,o){let t=e.order_id;this.signal_submited.set(!0),this.http.delete(`${this.host()}/return/${t}`).subscribe({next:s=>{this.notificationService.showSuccess(s.message,"home")},error:s=>{this.notificationService.handleError(s.error,"home"),this.signal_submited.set(!1)},complete:()=>{o.getItems(),this.signal_submited.set(!1),this.action_status$.next("DELETE"),this.suppliersService.getAccountTotalBalance(e.partner_id_fk),this.cashBalanceService.getBalance()}})}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275prov=ie({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var io=()=>({width:"95vw",height:"75vh"}),no=()=>({standalone:!0}),li=i=>({invalid:i}),oo=(i,u)=>({"text-red-500":i,"text-orange-500":u}),ro=i=>({"text-red-500":i});function ao(i,u){i&1&&(n(0,"tr")(1,"th",25),l(2,"Barcode"),r(),n(3,"th",26),l(4,"Description"),r(),n(5,"th",27),l(6,"Unit"),r(),n(7,"th",28),l(8,"Qty"),r(),n(9,"th",27),l(10,"Total"),r(),n(11,"th",28),l(12,"Del?"),r()())}function so(i,u){if(i&1){let e=T();n(0,"p-inputNumber",35),E("ngModelChange",function(t){g(e);let s=d().$implicit;return I(s.unit_price,t)||(s.unit_price=t),v(t)}),y("ngModelChange",function(){g(e);let t=d().$implicit,s=d(2);return v(s.setPrice(t))})("onFocus",function(t){g(e);let s=d(3);return v(s.select(t.target))}),r()}if(i&2){let e=d().$implicit;w("ngModel",e.unit_price),m("maxFractionDigits",2)("min",0)}}function lo(i,u){i&1&&x(0,"i",38)}function po(i,u){if(i&1&&(n(0,"span",36),l(1),p(2,"currency"),n(3,"span"),b(4,lo,1,0,"i",37),r()()),i&2){let e=d().$implicit,o=d(2);m("ngClass",oe(5,oo,!e.unit_price,o.getPriceWarining(e))),a(),_(c(2,3,e.unit_price)),a(3),m("ngIf",o.getPriceWarining(e))}}function co(i,u){if(i&1){let e=T();n(0,"p-inputNumber",39),E("ngModelChange",function(t){g(e);let s=d().$implicit;return I(s.quantity,t)||(s.quantity=t),v(t)}),y("onFocus",function(t){g(e);let s=d(3);return v(s.select(t.target))})("ngModelChange",function(){g(e);let t=d().$implicit,s=d(2);return v(s.setQty(t))}),r()}if(i&2){let e=d().$implicit;w("ngModel",e.quantity)}}function mo(i,u){if(i&1&&(n(0,"span",36),l(1),r()),i&2){let e=d().$implicit;m("ngClass",ee(2,ro,!e.quantity)),a(),_(e.quantity)}}function uo(i,u){if(i&1){let e=T();n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td",29)(6,"p-cellEditor"),b(7,so,1,3,"ng-template",30)(8,po,5,8,"ng-template",31),r()(),n(9,"td",32)(10,"p-cellEditor"),b(11,co,1,1,"ng-template",30)(12,mo,2,4,"ng-template",31),r()(),n(13,"td"),l(14),p(15,"currency"),r(),n(16,"td",33),y("click",function(){let t=g(e).rowIndex,s=d(2);return v(s.removeRow(t))}),x(17,"i",34),r()()}if(i&2){let e=u.$implicit;a(2),_(e.barcode||"---"),a(2),_(e.product_name),a(),m("pEditableColumn",e.unit_price)("ngClass",ee(9,li,!e.unit_price)),a(4),m("pEditableColumn",e.quantity)("ngClass",ee(11,li,!e.quantity)),a(5),C(" ",c(15,7,e.unit_price*e.quantity)," ")}}function _o(i,u){if(i&1&&(n(0,"h4",41),l(1),r()),i&2){let e=d(3);a(),C(" Total units: ",e.invoiceTotal.total_qty," ")}}function ho(i,u){if(i&1&&b(0,_o,2,1,"h4",40),i&2){let e=d(2);m("ngIf",e.invoiceTotal.total_qty)}}function go(i,u){i&1&&(n(0,"tr",42)(1,"td",43),l(2,"No data yet!"),r()())}function vo(i,u){if(i&1){let e=T();n(0,"p-card",6)(1,"div",7)(2,"div",8)(3,"div",9),x(4,"div",10),n(5,"label"),l(6,"Invoice Date"),r(),n(7,"p-calendar",11),E("ngModelChange",function(t){g(e);let s=d();return I(s.invoice_date,t)||(s.invoice_date=t),v(t)}),r()()(),n(8,"div",8)(9,"div",10)(10,"label",12),l(11,"Supplier"),r(),n(12,"p-dropdown",13),E("ngModelChange",function(t){g(e);let s=d();return I(s.supplier_id,t)||(s.supplier_id=t),v(t)}),y("onChange",function(t){g(e);let s=d();return v(s.supplierChange(t.value))}),r()()(),n(13,"div",14)(14,"h3",15),l(15),p(16,"currency"),r(),n(17,"h3",16),l(18),p(19,"lira"),r()()(),n(20,"div",7)(21,"div",17)(22,"p-table",18,0),b(24,ao,13,0,"ng-template",19)(25,uo,18,13,"ng-template",3)(26,ho,1,1,"ng-template",20)(27,go,3,0,"ng-template",21),r()(),n(28,"div",22)(29,"p-autoComplete",23,1),E("ngModelChange",function(t){g(e);let s=d();return I(s.search_product,t)||(s.search_product=t),v(t)}),y("completeMethod",function(t){g(e);let s=d();return v(s.searchItem(t))})("onKeyUp",function(t){g(e);let s=d();return v(s.submitInvoiceInput(t))}),r(),n(31,"p-button",24),y("onClick",function(){g(e);let t=d();return v(t.openProductsDialog())}),r()()()()}if(i&2){let e=d();a(7),w("ngModel",e.invoice_date),m("ngModelOptions",D(26,no))("readonlyInput",!0)("showIcon",!0)("iconDisplay","input")("showTime",!0)("showSeconds",!0)("disabled",!0),a(5),w("ngModel",e.supplier_id),m("options",e.suppliers)("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(3),C(" USD: ",c(16,22,e.invoiceTotal.total_dollar)," "),a(3),C(" LBP: ",c(19,24,e.invoiceTotal.total_dollar*e.invoice.exchange_rate)," "),a(4),Me("scrollHeight",e.vh),m("value",e.invoice_items())("scrollable",!0),a(7),w("ngModel",e.search_product),m("suggestions",e.matching_products)("delay",150)("autofocus",!0)}}function fo(i,u){if(i&1){let e=T();n(0,"p-button",44),y("onClick",function(){g(e);let t=d();return v(t.deleteInvoice())}),r(),n(1,"p-button",45),y("onClick",function(){g(e);let t=d();return v(t.closeEditDialog())}),r(),n(2,"p-button",46),y("onClick",function(){g(e);let t=d();return v(t.submitEditInvoice())}),r()}if(i&2){let e=d();m("disabled",e.submitted()),a(),m("disabled",e.submitted()),a(),m("loading",e.submitted())("disabled",e.invoice_items().length==0)}}var pi=(()=>{class i{constructor(){this.visible=!1,this.suppliers=[],this.return_invoice_edit=!1,this.onSubmit=new _e,this.onHide=new _e,this.stockService=h(me),this.editInvoiceService=h(si),this.authService=h(we),this.confirmationService=h(He),this.notificationsService=h(q),this.supplyService=h(dt),this.dateService=h(V),this.submitted=this.editInvoiceService.signal_submited,this.form_error=!1,this.invoiceTotal=new Be,this.supplier_id=null,this.invoice_number="123",this.invoice_items=P([]),this.selectedSupplierLatestItems=[],this.productsDialogVisible=!1,this.subscriptions=new A,this.products=this.stockService.products,this.matching_products=[],this.editDialogVisible=!1,this.vh="50vh"}ngOnInit(){this.subscriptions.add(this.editInvoiceService.action_status$.subscribe(e=>{(e==="UPDATE"||e==="DELETE")&&(this.onSubmit.emit({action:e}),this.editInvoiceService.action_status$.next(""),this.visible=!1)})),this.subscriptions.add(this.supplyService.barcodeResponse.subscribe(e=>{e&&(this.addProduct(e),this.supplyService.barcodeResponse.next(null))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.invoice&&(this.invoice_date=this.dateService.formatDate(this.invoice.order_datetime,"yyyy-MM-dd HH:mm:ss"),this.invoice_number=this.invoice.invoice_number.substring(3,this.invoice.invoice_number.length),this.invoice_items.set(structuredClone(this.invoice.items)),this.supplier_id=this.invoice.partner_id_fk,this.invoiceTotal.cost_dollar=this.invoice.total_cost,this.invoiceTotal.total_dollar=this.invoice.total_cost,this.supplierChange(this.invoice.supplier_id))}setPrice(e){e.unit_price?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}setQty(e){e.quantity?this.validateItems():this.form_error=!0,this.calculateTotal("edit")}validateItems(){return this.invoice_items().find(o=>!o.unit_price||!o.quantity)?(this.form_error=!0,!0):(this.form_error=!1,!1)}addProduct(e){let o=this.supplyService.factor(),t=structuredClone(this.invoice_items()),s=t.find(f=>f.product_id===e.product_id);s?s.quantity+=o:t.push({product_id:e.product_id,barcode:e.barcode,product_name:e.product_name,unit_cost:e.unit_cost_usd,unit_price:e.unit_cost_usd,quantity:o,unit_abbreviation:e.unit_abbreviation,product_unit_id:e.unit_id_fk,currency:e.currency}),this.invoice_items.set(t),this.supplyService.factor.set(1),this.calculateTotal("add")}submitInvoiceInput(e){e.key==="Enter"&&this.search_product&&(typeof this.search_product=="string"?this.submitBarcode(this.search_product):this.supplyService.barcodeResponse.next(this.search_product),this.search_product=null)}submitBarcode(e){if(e){let o=-1,t=["*","+"];for(let S=0;S<t.length;S++)if(e.indexOf(t[S])!==-1){o=e.indexOf(t[S]);break}let s=e.substring(0,o)||1,f=parseInt(e.substring(o+1,e.length));o!=-1&&o!=0?(this.supplyService.factor.set(parseInt(s)),this.supplyService.submitBarcode(f)):this.supplyService.submitBarcode(e)}}calculateTotal(e){let o=new Be,t=this.invoice_items();return t.length>0&&(t.forEach(s=>{o.total_qty+=s.quantity,o.cost_dollar+=s.unit_cost*s.quantity,o.subtotal_dollar+=s.unit_price*s.quantity}),o.total_dollar=o.subtotal_dollar),this.invoiceTotal=o,console.log("called"),console.log(this.invoiceTotal.total_qty),o}submitEditInvoice(){console.log("called");let e=this.validateItems();e?e&&this.notificationsService.showError("Please enter price for all items","home"):this.editInvoiceService.checkout({partner_id_fk:this.supplier_id,order_id:this.invoice.order_id,items:this.invoice_items(),total_cost:this.invoiceTotal.total_dollar,order_datetime:this.invoice_date,invoice_number:this.invoice_number,currency:"dollar",inventory_id:this.invoice.inventory_id},this.stockService)}searchItem(e){let o=this.products(),t=[],s=e.query;for(let f=0;f<o.length;f++){let S=o[f];S.product_name.toLowerCase().indexOf(s.toLowerCase())>-1&&t.push(S)}this.matching_products=t}closeEditDialog(){this.visible=!1,this.onHide.emit(!1)}supplierChange(e){}removeRow(e){this.invoice_items().splice(e,1),this.calculateTotal("remove")}openProductsDialog(){this.productsDialogVisible=!0}clearInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to clear invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoice_items.set([]),this.submitted.set(!1),this.invoiceTotal=new Be}})}deleteInvoice(){this.confirmationService.confirm({key:"home",message:'Are you sure that you want to delete invoice"?',header:"Warning",icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.editInvoiceService.deleteInvoice(this.invoice,this.stockService)}})}closeProductsDialog(){}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(o=>{this.addProduct(o)})}getPriceTypeLabel(e){return{unit_price_usd:"\u0645\u0641\u0631\u0642",whole_price_usd:"\u062C\u0645\u0644\u0629",grandwhole_price_usd:"\u062C\u0645\u0644\u0629 \u0627\u0644\u062C\u0645\u0644\u0629",latest:"\u0622\u062E\u0631 \u0633\u0639\u0631"}[e]}select(e){e.select()}getPriceWarining(e){if(!e.unit_price)return!1;let o=e.unit_cost||0,t=e.unit_price;return typeof o=="string"&&(o=parseFloat(o)),typeof t=="string"&&(t=parseFloat(t)),t<o}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["edit-return-purchase"]],inputs:{visible:"visible",invoice:"invoice",suppliers:"suppliers",return_invoice_edit:"return_invoice_edit"},outputs:{onSubmit:"onSubmit",onHide:"onHide"},features:[Ve],decls:4,vars:9,consts:[["invoiceTable",""],["barcodeInput",""],["header","Edit Invoice","position","top",3,"visibleChange","onHide","visible","modal","closable","maximizable"],["pTemplate","body"],["pTemplate","footer"],["price","cost",3,"onHide","onSubmit","visible","products"],["styleClass","mt-2"],[1,"grid"],[1,"col-12","md:col-3","pt-0","pb-0"],[1,"field","mb-0"],[1,"flex","flex-column","gap-2"],["inputId","order_datetime","name","order_datetime","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd","size","small","appendTo","body",3,"ngModelChange","ngModel","ngModelOptions","readonlyInput","showIcon","iconDisplay","showTime","showSeconds","disabled"],["for","supplier"],["styleClass","p-inputtext-sm","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","placeholder","Select Supplier","filterBy","name",3,"ngModelChange","onChange","ngModel","options","filter","showClear","autoOptionFocus"],[1,"col-12","md:col-3","md:col-offset-3","text-center"],[1,"text-green-600","m-2"],[1,"text-primary","m-2"],[1,"col-12"],["dataKey","product_id","styleClass","p-datatable-sm p-datatable-gridlines","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","header"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"col-12","md:col-4"],["field","product_name","name","barcodeInput","placeholder","scan or search ...","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","completeMethod","onKeyUp","ngModel","suggestions","delay","autofocus"],["label","Multi Select","severity","warning","styleClass","ml-2","size","small","icon","pi pi-list",3,"onClick"],["width","20%"],["width","40%"],["width","15%"],["width","5%"],["pEditableColumnField","unit_price",3,"pEditableColumn","ngClass"],["pTemplate","input"],["pTemplate","output"],["pEditableColumnField","quantity",3,"pEditableColumn","ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm","priceEditable",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min"],[3,"ngClass"],["class","pi pi-exclamation-triangle ml-2",4,"ngIf"],[1,"pi","pi-exclamation-triangle","ml-2"],["min","0","step","0",1,"p-inputtext-sm","editable",3,"ngModelChange","onFocus","ngModel"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["label","Delete","icon","pi pi-trash","severity","danger","size","small",1,"w-full","mt-4","md:w-auto","md:mt-0",3,"onClick","disabled"],["label","Cancel Edit","icon","pi pi-times","severity","secondary","size","small",1,"p-button-secondary","w-full","mt-2","md:w-auto","md:ml-2",3,"onClick","disabled"],["label","Submit Edit","icon","pi pi-check","severity","success","size","small","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","loading","disabled"]],template:function(o,t){o&1&&(n(0,"p-dialog",2),E("visibleChange",function(f){return I(t.visible,f)||(t.visible=f),f}),y("onHide",function(){return t.closeEditDialog()}),b(1,vo,32,27,"ng-template",3)(2,fo,3,4,"ng-template",4),r(),n(3,"products-dialog",5),y("onHide",function(){return t.productsDialogVisible=!1})("onSubmit",function(f){return t.assignSelectedProducts(f)}),r()),o&2&&(U(D(8,io)),w("visible",t.visible),m("modal",!0)("closable",!0)("maximizable",!0),a(3),m("visible",t.productsDialogVisible)("products",t.products))},dependencies:[xe,Q,k,se,De,N,H,Fe,Re,O,R,Y,W,L,ke,Oe,M,Z],styles:["[_nghost-%COMP%]  .p-fieldset .p-fieldset-content{padding:.5rem}.editable[_ngcontent-%COMP%]{width:40px;height:28px}.priceEditable[_ngcontent-%COMP%]{width:60px;height:28px;text-align:center}[_nghost-%COMP%]  .p-inputnumber-input{width:100%}td[_ngcontent-%COMP%]:has(span.p-inputnumber.p-component){padding:0}td[_ngcontent-%COMP%]:has(.no-padding){padding:0}.input-align-center[_ngcontent-%COMP%], [_nghost-%COMP%]   .editable[_ngcontent-%COMP%]     span.p-inputnumber.p-component .p-inputnumber-input{text-align:center}input[_ngcontent-%COMP%]::-webkit-outer-spin-button, input[_ngcontent-%COMP%]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}input[type=number][_ngcontent-%COMP%]{appearance:textfield;-moz-appearance:textfield}.invalid[_ngcontent-%COMP%]{border-bottom:1px solid var(--red-500)!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important;padding-bottom:0!important}"]})}}return i})();var Co=()=>[10,25,50],So=()=>({width:"95vw"});function bo(i,u){i&1&&(n(0,"tr")(1,"th"),l(2),p(3,"translate"),r(),n(4,"th"),l(5),p(6,"translate"),r(),n(7,"th"),l(8),p(9,"translate"),r(),n(10,"th"),l(11),p(12,"translate"),r(),n(13,"th",19),l(14),p(15,"translate"),r()()),i&2&&(a(2),C("",c(3,5,"Invoice")," #"),a(3),_(c(6,7,"Supplier")),a(3),_(c(9,9,"Datetime")),a(3),_(c(12,11,"Total")),a(3),C(" ",c(15,13,"Options")," "))}function xo(i,u){if(i&1){let e=T();n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td"),l(6),r(),n(7,"td"),l(8),p(9,"currency"),r(),n(10,"td")(11,"p-button",20),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.showInvoiceDialog(t))}),r()(),n(12,"td")(13,"p-button",21),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.openEditDialog(t))}),r()(),n(14,"td")(15,"p-button",22),y("onClick",function(){let t=g(e).$implicit,s=d();return v(s.printInvoice(t))}),r()()()}if(i&2){let e=u.$implicit;a(2),_(e.invoice_number),a(2),_(e.supplier_name||"---"),a(2),_(e.order_datetime),a(2),_(c(9,4,e.total_cost))}}function wo(i,u){i&1&&(n(0,"tr")(1,"td",23),l(2),p(3,"translate"),r()()),i&2&&(a(2),C(" ",c(3,1,"No Records Found!")," "))}function Io(i,u){i&1&&(n(0,"tr")(1,"th",26),l(2),p(3,"translate"),r(),n(4,"th",27),l(5),p(6,"translate"),r(),n(7,"th",26),l(8),p(9,"translate"),r(),n(10,"th",28),l(11),p(12,"translate"),r(),n(13,"th",26),l(14),p(15,"translate"),r()()),i&2&&(a(2),_(c(3,5,"Barcode")),a(3),_(c(6,7,"Description")),a(3),_(c(9,9,"Unit Price")),a(3),_(c(12,11,"Qty")),a(3),_(c(15,13,"Total Price")))}function Eo(i,u){if(i&1&&(n(0,"tr")(1,"td"),l(2),r(),n(3,"td"),l(4),r(),n(5,"td"),l(6),p(7,"currency"),r(),n(8,"td"),l(9),r(),n(10,"td"),l(11),p(12,"currency"),r()()),i&2){let e=u.$implicit;a(2),_(e.barcode||"---"),a(2),_(e.product_name),a(2),C(" ",c(7,5,e.unit_cost)," "),a(3),_(e.quantity),a(2),C(" ",c(12,7,e.unit_cost*e.quantity)," ")}}function To(i,u){if(i&1&&(n(0,"tr"),x(1,"td")(2,"td")(3,"td"),n(4,"td"),l(5),r(),n(6,"td"),l(7),p(8,"currency"),r()()),i&2){let e=d(3);a(5),_(e.selectedInvoiceTotals.totalQty),a(2),C(" ",c(8,2,e.selectedInvoiceTotals.totalCost)," ")}}function Po(i,u){if(i&1&&(n(0,"p-table",25),b(1,Io,16,15,"ng-template",12)(2,Eo,13,9,"ng-template",13)(3,To,9,4,"ng-template",17),r()),i&2){let e=d(2);m("value",e.invoiceItems)}}function Do(i,u){if(i&1&&b(0,Po,4,1,"p-table",24),i&2){let e=d();m("ngIf",e.invoiceItems.length!=0)}}function Bo(i,u){if(i&1){let e=T();n(0,"p-button",29),p(1,"translate"),y("onClick",function(){g(e);let t=d();return v(t.hideInvoiceDialog())}),r()}i&2&&m("label",c(1,1,"Close"))}var ci=(()=>{class i{constructor(){this.suppliersService=h(ue),this.historyService=h(X),this.decimalService=h(J),this.printService=h(Pe),this.dateService=h(V),this.suppliers=this.suppliersService.suppliers,this.detailsDialogVisible=!1,this.editDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0},this.subscriptions=new A,this.returnPurchasesHistory=this.historyService.returnPurchasesHistory,this.loading=this.historyService.signal_loading,this.searchForm=new ae({invoice_number:new F(null),supplier_id:new F(null),invoice_date:new F(null)}),this.submitSearch()}submitSearch(){this.searchForm.value.invoice_date&&(this.searchForm.value.invoice_date=this.dateService.formatDate(this.searchForm.value.invoice_date,"yyyy-MM-dd")),this.historyService.fetchReturnPurchasesHistory(this.searchForm.value)}resetSearch(){this.searchForm.reset(),this.historyService.fetchReturnPurchasesHistory(null)}showInvoiceDialog(e){this.invoiceItems=e.items,this.invoiceItems.forEach(o=>{this.selectedInvoiceTotals.totalQty+=o.quantity,this.selectedInvoiceTotals.totalCost=this.decimalService.add(this.selectedInvoiceTotals.totalCost,o.unit_cost*o.quantity)}),this.detailsDialogVisible=!0}openEditDialog(e){this.selectedInvoice=e,this.editDialogVisible=!0}closeEditDialog(){this.selectedInvoice=null,this.editDialogVisible=!1}hideInvoiceDialog(){this.detailsDialogVisible=!1,this.selectedInvoiceTotals={totalQty:0,totalCost:0}}submitEdit(e){this.historyService.fetchReturnPurchasesHistory(this.searchForm.value)}printInvoice(e){e.type="return purchase",this.printService.print(e)}static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275cmp=B({type:i,selectors:[["app-return-purchase-history"]],decls:30,vars:51,consts:[[1,"grid","m-1"],[1,"col-12"],[3,"legend","toggleable"],[3,"ngSubmit","formGroup"],[1,"grid"],[1,"col-12","md:col-6","lg:col-3"],["formControlName","invoice_number","type","search","pInputText","","spellcheck","false",1,"p-inputtext-sm","w-full",3,"placeholder"],["formControlName","supplier_id","styleClass","p-inputtext-sm w-full","id","supplier","appendTo","body","optionLabel","name","optionValue","account_id","filterBy","name",3,"options","placeholder","filter","showClear","autoOptionFocus"],["formControlName","invoice_date","styleClass","p-inputtext-sm w-full","dateFormat","yy-mm-dd",3,"showIcon","showClear","readonlyInput","placeholder","showButtonBar"],["type","submit","icon","pi pi-search","pRipple","","size","small","severity","success",1,"mr-2",3,"label","loading"],["icon","pi pi-times","styleClass","p-button-primary p-button-sm","severity","danger",3,"onClick","label","disabled"],["dataKey","order_id","styleClass","p-datatable-sm",3,"value","paginator","rows","showCurrentPageReport","rowsPerPageOptions","alwaysShowPaginator","loading"],["pTemplate","header"],["pTemplate","body"],["pTemplate","emptymessage"],["position","top",3,"visibleChange","onHide","header","visible","modal","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"onHide","onSubmit","visible","invoice","suppliers"],["colspan","3","width","10%"],["size","small","severity","success","icon","fas fa-eye",3,"onClick"],["size","small","icon","fas fa-edit","severity","warning",3,"onClick"],["size","small","icon","fas fa-print","severity","contrast",3,"onClick"],["colspan","11"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value",4,"ngIf"],["dataKey","order_item_id","styleClass","p-datatable-sm",3,"value"],["width","20%"],["width","35%"],["width","5%"],["icon","pi pi-times","severity","secondary","size","small",3,"onClick","label"]],template:function(o,t){o&1&&(n(0,"div",0)(1,"div",1)(2,"p-card")(3,"p-fieldset",2),p(4,"translate"),n(5,"form",3),y("ngSubmit",function(){return t.submitSearch()}),n(6,"div",4)(7,"div",5),x(8,"input",6),p(9,"translate"),r(),n(10,"div",5),x(11,"p-dropdown",7),p(12,"translate"),r(),n(13,"div",5),x(14,"p-calendar",8),p(15,"translate"),r(),n(16,"div",5),x(17,"p-button",9),p(18,"translate"),n(19,"p-button",10),p(20,"translate"),y("onClick",function(){return t.resetSearch()}),r()()()()(),n(21,"p-table",11),b(22,bo,16,15,"ng-template",12)(23,xo,16,6,"ng-template",13)(24,wo,4,3,"ng-template",14),r()()()(),n(25,"p-dialog",15),p(26,"translate"),E("visibleChange",function(f){return I(t.detailsDialogVisible,f)||(t.detailsDialogVisible=f),f}),y("onHide",function(){return t.hideInvoiceDialog()}),b(27,Do,1,1,"ng-template",16)(28,Bo,2,3,"ng-template",17),r(),n(29,"edit-return-purchase",18),y("onHide",function(){return t.closeEditDialog()})("onSubmit",function(f){return t.submitEdit(f)}),r()),o&2&&(a(3),m("legend",c(4,35,"Search Form"))("toggleable",!0),a(2),m("formGroup",t.searchForm),a(3),m("placeholder",c(9,37,"Invoice")),a(3),m("options",t.suppliers())("placeholder",c(12,39,"Select Supplier"))("filter",!0)("showClear",!0)("autoOptionFocus",!1),a(3),m("showIcon",!1)("showClear",!0)("readonlyInput",!0)("placeholder",c(15,41,"Date"))("showButtonBar",!0),a(3),m("label",c(18,43,"Search"))("loading",t.loading()),a(2),m("label",c(20,45,"Reset"))("disabled",t.loading()),a(2),m("value",t.returnPurchasesHistory())("paginator",!0)("rows",10)("showCurrentPageReport",!0)("rowsPerPageOptions",D(49,Co))("alwaysShowPaginator",!1)("loading",t.loading()),a(4),U(D(50,So)),m("header",c(26,47,"Details")),w("visible",t.detailsDialogVisible),m("modal",!0)("closable",!0)("maximizable",!0),a(4),m("visible",t.editDialogVisible)("invoice",t.selectedInvoice)("suppliers",t.suppliers()))},dependencies:[Q,le,G,k,re,pe,ce,N,H,O,R,Y,$,W,L,de,pi,M,z],styles:["[_nghost-%COMP%]  .p-fieldset-content{padding:.5rem!important}"]})}}return i})();var Vo=[{path:"",data:{breadcrumb:"Sales"},component:yt},{path:"sales-history",data:{breadcrumb:"Sales"},component:yt},{path:"payment-history",data:{breadcrumb:"Payments"},component:Jt},{path:"return-history",data:{breadcrumb:"Returns"},component:Xt},{path:"purchases-history",data:{breadcrumb:"Purchases"},component:ni},{path:"return-purchase-history",data:{breadcrumb:"Returned Purchases"},component:ci},{path:"receipts-history",data:{breadcrumb:"Receipts"},component:oi},{path:"cash-history",data:{breadcrumb:"Cash"},component:ai}],mi=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=Ke({type:i})}static{this.\u0275inj=Qe({imports:[vt.forChild(Vo),vt]})}}return i})();var yp=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=Ke({type:i})}static{this.\u0275inj=Qe({imports:[Ge,mi,Ye,Et,De,ot,Xe,Ze,Pt,et,ct,it,nt,at,Ot,Vt,Wt,Ft,Rt,rt,ut,gt,Mt,Bt,mt,jt]})}}return i})();export{yp as HistoryModule};
