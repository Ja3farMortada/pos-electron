import{a as D}from"./chunk-XFMQNLNY.js";import{a as pe}from"./chunk-7CR6E6US.js";import{b as ye}from"./chunk-FA4OBAKY.js";import{a as we,b as Fe}from"./chunk-7QYRFDGN.js";import{a as me,d as ge,e as De,f as xe}from"./chunk-QJMHFOYW.js";import{c as Se}from"./chunk-G5UOHYUM.js";import{i as fe,j as be,l as _e,m as ve,q as Ce}from"./chunk-LBGQA5HW.js";import{b as $}from"./chunk-4A2WLUYH.js";import{b as ce,c as ue}from"./chunk-VVKQAEX7.js";import{Ba as V,C as r,Ca as B,D as N,Da as E,Fa as u,Ga as f,J as M,Ja as A,Jb as H,K as b,Ka as R,L as _,La as P,Na as L,Oa as I,P as w,Pa as C,Qc as de,Rc as he,Sb as G,Vb as U,Wb as W,Xa as l,Y as a,Ya as c,Yb as J,_b as v,ac as K,bc as X,da as y,eb as T,ga as q,gb as z,gc as Y,hc as Z,ia as m,ic as ee,jc as te,kc as ie,la as O,lc as oe,mc as ne,nb as Q,oa as o,pa as s,pb as j,qa as S,ua as F,va as h,wa as d,wc as re,xc as se,y as k,yc as ae,zc as le}from"./chunk-DSVZHE42.js";var Ve=(()=>{class n{constructor(){this.http=r(j),this.api=r(W),this.notificationService=r(U),this.cashBalanceService=r(pe),this.customersService=r(D),this.socket=r(me),this.userService=r($),this.loading=y(!1),this.dialogVisible=y(!1),this.submitEmitted=y(null),this.socketId=this.userService.socketId,this.initializeSockets()}addManualDebt(e){this.loading.set(!0),this.http.post(`${this.api.host()}/customers/debts`,e).subscribe({next:t=>{this.notificationService.showSuccess("Debt added successfully!","home"),e.modifyCash&&this.cashBalanceService.getBalance()},error:t=>{this.loading.set(!1),this.notificationService.showError(t.error,"home")},complete:()=>{this.loading.set(!1),this.submitEmitted.set({action:"add"}),this.dialogVisible.set(!this.dialogVisible()),this.customersService.getDebts(this.customersService.defaultCurrency())}})}initializeSockets(){this.socket.on("addedCustomerDebt",e=>{e.user_id!=this.socketId()&&(this.customersService.getDebts(this.customersService.defaultCurrency()),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("A new debt has been added!","home"))})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=k({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})();var Ie=["amountInput"],Te=["customerDropdown"],ke=()=>({width:"75vw"}),Ne=()=>({"1199px":"85vw","575px":"95vw"}),g=n=>({"ng-invalid ng-dirty":n});function Me(n,Be){if(n&1){let e=F();o(0,"form",5),h("ngSubmit",function(){b(e);let i=d();return _(i.submit())}),o(1,"div",6)(2,"div",7)(3,"div",8)(4,"label",9),u(5),l(6,"translate"),o(7,"span",10),u(8," *"),s()(),o(9,"p-dropdown",11),l(10,"translate"),h("onChange",function(){b(e);let i=d();return _(i.getCustomerBalance())}),s()()(),o(11,"div",12)(12,"label"),u(13),l(14,"translate"),o(15,"span",13),u(16,"*"),s()(),S(17,"p-dropdown",14),l(18,"translate"),s(),o(19,"div",15)(20,"div",16)(21,"label",17),u(22),l(23,"translate"),s(),S(24,"br")(25,"p-inputSwitch",18),s()(),o(26,"div",12)(27,"div",8)(28,"label",19),u(29),l(30,"translate"),o(31,"span",10),u(32," *"),s()(),o(33,"p-inputNumber",20,0),h("onFocus",function(i){b(e);let p=d();return _(p.selectInput(i))}),s()()(),o(35,"div",7)(36,"label"),u(37),l(38,"translate"),s(),o(39,"p-inputNumber",21,1),h("onFocus",function(i){b(e);let p=d();return _(p.selectInput(i))}),s(),o(41,"small"),u(42),l(43,"translate"),s()(),o(44,"div",22)(45,"label"),u(46),l(47,"translate"),o(48,"span",10),u(49," *"),s()(),S(50,"input",23),s()()()}if(n&2){let e=d();m("formGroup",e.correctDebtForm),a(5),f(c(6,30,"Customer")),a(4),m("options",e.accounts)("placeholder",c(10,32,"Select Customer"))("required",!0)("filter",!0)("showClear",!0)("autoOptionFocus",!1)("ngClass",C(48,g,(e.selected_account==null?null:e.selected_account.invalid)&&((e.selected_account==null?null:e.selected_account.dirty)||(e.selected_account==null?null:e.selected_account.touched)||e.submitted))),a(4),f(c(14,34,"Option")),a(4),m("autoOptionFocus",!1)("options",e.transactionOptions)("placeholder",c(18,36,"transaction type"))("required",!0)("ngClass",C(50,g,(e.transaction_type==null?null:e.transaction_type.invalid)&&((e.transaction_type==null?null:e.transaction_type.dirty)||(e.transaction_type==null?null:e.transaction_type.touched)||e.submitted))),a(5),f(c(23,38,"Modify Cash")),a(7),f(c(30,40,"Amount")),a(4),m("required",!0)("autofocus",e.selected_account)("step",1)("min",0)("ngClass",C(52,g,(e.amount==null?null:e.amount.invalid)&&((e.amount==null?null:e.amount.dirty)||(e.amount==null?null:e.amount.touched)||e.submitted))),a(4),f(c(38,42,"LBP amount")),a(2),m("required",!0)("step",1e3)("min",0)("ngClass",C(54,g,e.submitted&&!e.amount)),a(3),f(c(43,44,"LBP payments are reference only, payments are always submitted in USD")),a(4),f(c(47,46,"Notes")),a(4),m("ngClass",C(56,g,(e.transaction_notes==null?null:e.transaction_notes.invalid)&&((e.transaction_notes==null?null:e.transaction_notes.dirty)||(e.transaction_notes==null?null:e.transaction_notes.touched)||e.submitted)))}}function qe(n,Be){if(n&1){let e=F();o(0,"p-button",24),l(1,"translate"),h("onClick",function(){b(e);let i=d();return _(i.closeDialog())}),s(),o(2,"p-button",25),l(3,"translate"),h("onClick",function(){b(e);let i=d();return _(i.submit())}),s()}if(n&2){let e=d();m("label",c(1,4,"Cancel"))("disabled",e.loading()),a(2),m("label",c(3,6,"Submit"))("loading",e.loading())}}var xt=(()=>{class n{ngOnChanges(e){e.visible&&e.visible.currentValue&&(this.correctDebtForm.patchValue({selected_account:this.account,amount:0}),this.location==="home"&&this.correctDebtForm.patchValue({transaction_type:"ADD"}),this.getCustomerBalance())}constructor(){this.visible=!1,this.accounts=[],this.dialog_mode="add",this.type="customer",this.location="",this.onClose=new w,this.onSubmit=new w,this.correctDebtService=r(Ve),this.customersService=r(D),this.confirmationService=r(H),this.dateService=r(Se),this.decimalService=r(De),this.fb=r(ie),this.stockService=r(ge),this.dollarPipe=r(xe),this.translate=r(ce),this.submitted=!1,this.loading=this.correctDebtService.loading,this.exchangeRate=this.stockService.exchangeRate,this.transactionOptions=[{name:this.translate.instant("Add Debt"),value:"ADD"},{name:this.translate.instant("Remove Debt"),value:"REMOVE"}],this.customer_balance_loading=this.customersService.signal_balanceLoading,this.customer_balance=this.customersService.customersTotalDebts$,T(()=>{this.correctDebtService.dialogVisible(),this.onClose.emit()}),T(()=>{let e=this.correctDebtService.submitEmitted();this.onSubmit.emit()}),this.correctDebtForm=this.fb.group({selected_account:[null,v.required],transaction_datetime:[this.dateService.getFullDatetime()],transaction_type:[{value:null,disabled:!1},v.required],amount:[0,[v.required,v.min(.1)]],lbpAmount:[0],modifyCash:[!1,v.required],transaction_notes:[null,v.required],exchange_rate:[this.exchangeRate().rate_value]}),this.setupValueChanges()}setupValueChanges(){this.correctDebtForm.get("amount")?.valueChanges.subscribe(e=>{if(e!==null){let t=this.dollarPipe.calculate(e);this.correctDebtForm.get("lbpAmount")?.setValue(t,{emitEvent:!1})}}),this.correctDebtForm.get("lbpAmount")?.valueChanges.subscribe(e=>{if(e!==null){let t=e/this.exchangeRate().rate_value;this.correctDebtForm.get("amount")?.setValue(t,{emitEvent:!1})}})}get selected_account(){return this.correctDebtForm.get("selected_account")}get transaction_type(){return this.correctDebtForm.get("transaction_type")}get amount(){return this.correctDebtForm.get("amount")}get transaction_notes(){return this.correctDebtForm.get("transaction_notes")}selectInput(e){e.target.select()}closeDialog(){this.visible=!1,this.submitted=!1,this.correctDebtForm.reset({amount:0,modifyCash:!1}),this.onClose.emit()}submit(){this.submitted=!0,this.correctDebtForm.valid&&(this.correctDebtForm.patchValue({transaction_datetime:this.dateService.getFullDatetime()}),this.correctDebtService.addManualDebt(this.correctDebtForm.value))}getCustomerBalance(){let e=this.correctDebtForm.controls.selected_account.value;e?this.customersService.getAccountTotalBalance(e,this.currency):this.customersService.customersTotalDebts$.set({id:0,balance:0})}calculateNewBalance(e=0,t=0){return e=parseFloat(e),this.decimalService.subtract(e,t)}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275cmp=N({type:n,selectors:[["correct-debt"]],viewQuery:function(t,i){if(t&1&&(V(Ie,5),V(Te,5)),t&2){let p;B(p=E())&&(i.amountInput=p.first),B(p=E())&&(i.customerDropdown=p.first)}},inputs:{visible:"visible",accounts:"accounts",account:"account",selected_payment:"selected_payment",dialog_mode:"dialog_mode",type:"type",location:"location",currency:"currency"},outputs:{onClose:"onClose",onSubmit:"onSubmit"},standalone:!0,features:[M,L],decls:4,vars:13,consts:[["amountInput",""],["liraInput",""],["position","top","styleClass","p-fluid",3,"visibleChange","onHide","header","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-3"],[1,"flex","flex-column","gap-2"],["for","customer"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","customer","appendTo","body","optionLabel","name","optionValue","account_id","formControlName","selected_account","filterBy","name",3,"onChange","options","placeholder","required","filter","showClear","autoOptionFocus","ngClass"],[1,"field","col-12","md:col-2"],[1,"text-red-600"],["styleClass","p-inputtext-sm","scrollHeight","400px","appendTo","body","formControlName","transaction_type","optionLabel","name","optionValue","value",3,"autoOptionFocus","options","placeholder","required","ngClass"],[1,"col-12","md:col-2","flex","justify-content-center"],[1,"field"],["for","modifyCash"],["formControlName","modifyCash","styleClass","mt-1"],["for","amount"],["styleClass","input-align-center","formControlName","amount","mode","currency","currency","USD","locale","en-US",1,"p-inputtext-sm",3,"onFocus","required","autofocus","step","min","ngClass"],["styleClass","input-align-center","formControlName","lbpAmount","mode","currency","currency","LBP","locale","en-LB",1,"p-inputtext-sm",3,"onFocus","required","step","min","ngClass"],[1,"field","col-12","md:col-6"],["type","text","spellcheck","false","pInputText","","formControlName","transaction_notes",1,"w-full","p-inputtext-sm",3,"ngClass"],["icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","disabled"],["icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","loading"]],template:function(t,i){t&1&&(o(0,"p-dialog",2),l(1,"translate"),P("visibleChange",function(x){return R(i.visible,x)||(i.visible=x),x}),h("onHide",function(){return i.closeDialog()}),q(2,Me,51,58,"ng-template",3)(3,qe,4,8,"ng-template",4),s()),t&2&&(O(I(11,ke)),m("header",c(1,9,"Modify Debts"))("modal",!0),A("visible",i.visible),m("breakpoints",I(12,Ne))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[he,de,G,se,re,le,ae,ve,_e,be,fe,Q,z,oe,Y,J,K,X,te,ne,Z,ee,Ce,ye,Fe,we,ue]})}}return n})();export{xt as a};
