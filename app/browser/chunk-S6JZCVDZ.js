import{a as be}from"./chunk-XFMQNLNY.js";import{c as oe}from"./chunk-6CXWHLUJ.js";import{a as he,b as ge}from"./chunk-FA4OBAKY.js";import{a as ve}from"./chunk-UJ5JDQTE.js";import{a as ye}from"./chunk-UVEVFGTS.js";import{d as _e,e as xe,f as we}from"./chunk-QJMHFOYW.js";import{c as Ce}from"./chunk-G5UOHYUM.js";import{i as se,j as me,l as pe,m as ce,p as ue,q as de,t as fe}from"./chunk-LBGQA5HW.js";import{b as ne,c as ae}from"./chunk-VVKQAEX7.js";import{Ba as D,C as u,Ca as B,D as E,Da as P,Fa as p,Ga as g,Ha as b,J as T,Ja as k,Jb as z,K as _,Ka as N,L as h,La as M,Na as q,Oa as V,P as x,Qc as re,Rc as le,Sb as Q,Vb as U,Wb as j,Xa as o,Y as i,Ya as r,_b as y,ac as W,bc as G,ga as v,gc as H,hc as $,ia as m,ib as A,ic as Y,jc as J,kc as K,la as L,lc as X,mb as R,mc as Z,nb as O,oa as n,pa as a,qa as w,r as F,ua as S,va as d,wa as c,wc as ee,xc as te,zc as ie}from"./chunk-DSVZHE42.js";var Se=["amountInput"],De=["customerDropdown"],Be=["paymentDateCalendar"],Pe=()=>({width:"75vw"}),Ve=()=>({"1199px":"85vw","575px":"95vw"}),Ie=()=>["dollar","lira"];function Fe(l,C){if(l&1){let e=S();n(0,"p-button",22),o(1,"translate"),d("onClick",function(){_(e);let t=c(2);return h(t.submitAllBalance())}),a()}l&2&&m("label",r(1,1,"Submit All Balance"))}function Ee(l,C){l&1&&(n(0,"div",15)(1,"label"),p(2),o(3,"translate"),a(),w(4,"p-inputNumber",23,2),n(6,"small"),p(7),o(8,"translate"),a()()),l&2&&(i(2),g(r(3,5,"LBP amount")),i(2),m("required",!0)("step",1e3)("min",0),i(3),g(r(8,7,"LBP payments are reference only, payments are always submitted in USD")))}function Te(l,C){if(l&1&&(n(0,"div",24)(1,"div",25)(2,"table",26)(3,"tr")(4,"th",27),p(5),o(6,"translate"),a(),n(7,"th")(8,"text-with-loading",28)(9,"span"),p(10),o(11,"currency"),o(12,"lira"),a()()()(),n(13,"tr")(14,"th",27),p(15),o(16,"translate"),a(),n(17,"th"),p(18),o(19,"currency"),o(20,"lira"),a()(),n(21,"tr")(22,"td",29),w(23,"p-divider",30),a()(),n(24,"tr")(25,"th",27),p(26),o(27,"translate"),a(),n(28,"th")(29,"text-with-loading",31)(30,"span"),p(31),o(32,"currency"),o(33,"lira"),a()()()()()()()),l&2){let e=c(2);i(5),b(" ",r(6,10,"Old Balance")," "),i(3),m("isLoading",e.customer_balance_loading())("loadingBar",!0),i(2),g(e.f.currency.value=="dollar"?r(11,12,e.customer_balance().balance):r(12,14,e.customer_balance().balance)),i(5),b(" ",r(16,16,"Payment")," "),i(3),b(" ",e.f.currency.value==="dollar"?r(19,18,e.f.amount.value||0):r(20,20,e.f.amount.value||0)," "),i(8),b(" ",r(27,22,"Remaining")," "),i(3),m("isLoading",e.customer_balance_loading())("loadingBar",!0),i(2),g(e.f.currency.value==="dollar"?r(32,24,e.calculateNewBalance(e.customer_balance().balance,e.f.amount.value||0)):r(33,26,e.calculateNewBalance(e.customer_balance().balance,e.f.amount.value||0)))}}function Le(l,C){if(l&1){let e=S();n(0,"form",6),d("ngSubmit",function(){_(e);let t=c();return h(t.submitPayment())}),n(1,"div",7)(2,"div",8)(3,"div",9)(4,"label",10),p(5),o(6,"translate"),n(7,"span",11),p(8," *"),a()(),n(9,"p-dropdown",12),o(10,"translate"),d("ngModelChange",function(){_(e);let t=c();return h(t.getCustomerBalance())}),a()()(),n(11,"div",8)(12,"label",13),p(13),o(14,"translate"),n(15,"span",11),p(16," *"),a()(),w(17,"p-calendar",14,0),o(19,"translate"),a(),n(20,"div",15)(21,"div",9)(22,"label"),p(23),o(24,"translate"),a(),n(25,"p-dropdown",16),d("ngModelChange",function(){_(e);let t=c();return h(t.getCustomerBalance(t.f.currency.value))}),a()()(),n(26,"div",15)(27,"div",9)(28,"label",17),p(29),o(30,"translate"),n(31,"span",11),p(32," *"),a()(),w(33,"p-inputNumber",18,1),v(35,Fe,2,3,"p-button",19),a()(),v(36,Ee,9,9,"div",20),a()(),v(37,Te,34,28,"div",21)}if(l&2){let e=c();m("formGroup",e.paymentForm),i(5),g(r(6,28,"Customer")),i(4),m("options",e.customers())("placeholder",r(10,30,"Select Customer"))("required",!0)("filter",!0)("showClear",!0)("autoOptionFocus",!1),i(4),b(" ",r(14,32,"Payment Date")," "),i(4),m("showIcon",!1)("showClear",!1)("readonlyInput",!0)("placeholder",r(19,34,"Date"))("showTime",!0)("showSeconds",!0),i(6),g(r(24,36,"Account")),i(2),m("options",V(40,Ie))("autoOptionFocus",!1),i(4),g(r(30,38,"Amount")),i(4),m("required",!0)("autofocus",e.account_id)("currency",e.f.currency.value==="dollar"?"USD":"LBP")("locale",e.f.currency.value==="dollar"?"en-US":"en-LB")("step",1)("min",0),i(2),m("ngIf",e.mode==="add"),i(),m("ngIf",e.f.currency.value==="dollar"),i(),m("ngIf",e.mode==="add")}}function ke(l,C){if(l&1){let e=S();n(0,"p-button",35),o(1,"translate"),d("onClick",function(){_(e);let t=c(2);return h(t.deletePayment())}),a()}if(l&2){let e=c(2);m("label",r(1,2,"Delete"))("disabled",e.submitLoading)}}function Ne(l,C){if(l&1){let e=S();v(0,ke,2,4,"p-button",32),n(1,"p-button",33),o(2,"translate"),d("onClick",function(){_(e);let t=c();return h(t.closeDialog())}),a(),n(3,"p-button",34),o(4,"translate"),d("onClick",function(){_(e);let t=c();return h(t.submitPayment())}),a()}if(l&2){let e=c();m("ngIf",e.mode==="edit"),i(),m("label",r(2,5,"Cancel"))("disabled",e.submitLoading),i(2),m("label",r(4,7,"Submit"))("loading",e.submitLoading)}}var bt=(()=>{class l{constructor(){this.customersService=u(be),this.confirmationService=u(z),this.dateService=u(Ce),this.decimalService=u(xe),this.stockService=u(_e),this.dollarPipe=u(we),this.translate=u(ne),this.fb=u(K),this.apiService=u(j),this.notificationService=u(U),this.visible=!1,this.mode="add",this.account_id=null,this.visibleChange=new x,this.onCreate=new x,this.onUpdate=new x,this.onDelete=new x,this.exchangeRate=this.stockService.exchangeRate,this.customers=this.customersService.customers,this.paymentForm=this.fb.group({journal_id:[null],account_id:[null,y.required],payment_date:[null,y.required],amount:[null,[y.required,y.min(.01)]],lbpAmount:[null,y.required],currency:[this.currency,y.required],exchange_rate:[this.exchangeRate().rate_value]}),this.submitLoading=!1,this.customer_balance_loading=this.customersService.signal_balanceLoading,this.customer_balance=this.customersService.customersTotalDebts$}get f(){return this.paymentForm.controls}ngOnChanges(e){e.visible&&this.visible&&(this.setupValueChanges(),this.mode=="edit"?this.paymentForm.patchValue(this.payment):(this.paymentForm.reset({account_id:this.account_id,payment_date:this.dateService.getFullDatetime(),currency:this.currency,exchange_rate:this.exchangeRate().rate_value}),this.getCustomerBalance()))}closeDialog(){this.submitLoading=!1,this.visibleChange.emit(!1)}submitAllBalance(){this.paymentForm.patchValue({amount:this.customer_balance().balance})}setupValueChanges(){this.paymentForm.get("amount")?.valueChanges.subscribe(e=>{if(e!==null){let s=this.dollarPipe.calculate(e);this.paymentForm.get("lbpAmount")?.setValue(s,{emitEvent:!1})}}),this.paymentForm.get("lbpAmount")?.valueChanges.subscribe(e=>{if(e!==null){let s=e/this.exchangeRate().rate_value;this.paymentForm.get("amount")?.setValue(s,{emitEvent:!1})}})}submitPayment(){if(console.log(this.f.currency.value),console.log(this.f.exchange_rate.value),this.paymentForm.valid){let e=this.paymentForm.getRawValue();this.submitLoading=!0,(this.mode=="add"?this.apiService.post("payment/customer",e):this.apiService.put("payment/customer",e)).pipe(F(()=>{this.submitLoading=!1})).subscribe({next:t=>{this.mode=="add"?this.onCreate.emit(t):this.onUpdate.emit(t),this.closeDialog(),this.notificationService.showSuccess()}})}else!this.f.amount.value||this.f.amount.value>0?this.amountInput.el.nativeElement.children[0].children[0].focus():this.f.account_id.value?this.paymentDateCalendar.inputfieldViewChild.nativeElement.focus():this.customerDropdown.applyFocus()}deletePayment(){this.confirmationService.confirm({key:"home",message:this.translate.instant("Are you sure you want to continue ?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.submitLoading=!0,this.apiService.delete(`payment/${this.payment.journal_id}`).pipe(F(()=>{this.submitLoading=!1})).subscribe({next:()=>{this.notificationService.showSuccess(),this.onDelete.emit(this.payment)}})}})}getCustomerBalance(e=this.currency){this.f.amount.setValue(null),this.f.lbpAmount.setValue(null),this.f.account_id.value?this.customersService.getAccountTotalBalance(this.f.account_id.value,e):this.customer_balance.set({id:0,balance:0})}calculateNewBalance(e=0,s=0){return e=parseFloat(e),this.decimalService.subtract(e,s)}static{this.\u0275fac=function(s){return new(s||l)}}static{this.\u0275cmp=E({type:l,selectors:[["payment-dialog"]],viewQuery:function(s,t){if(s&1&&(D(Se,5),D(De,5),D(Be,5)),s&2){let f;B(f=P())&&(t.amountInput=f.first),B(f=P())&&(t.customerDropdown=f.first),B(f=P())&&(t.paymentDateCalendar=f.first)}},inputs:{visible:"visible",mode:"mode",account_id:"account_id",payment:"payment",currency:"currency"},outputs:{visibleChange:"visibleChange",onCreate:"onCreate",onUpdate:"onUpdate",onDelete:"onDelete"},standalone:!0,features:[T,q],decls:4,vars:13,consts:[["paymentDateCalendar",""],["amountInput",""],["liraInput",""],["position","top","styleClass","p-fluid",3,"visibleChange","onHide","header","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-3"],[1,"flex","flex-column","gap-2"],["for","customer"],[1,"text-red-500"],["id","customer","formControlName","account_id","styleClass","p-inputtext-sm","appendTo","body","optionLabel","name","optionValue","account_id","filterBy","name",3,"ngModelChange","options","placeholder","required","filter","showClear","autoOptionFocus"],["for","payment_date"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd",3,"showIcon","showClear","readonlyInput","placeholder","showTime","showSeconds"],[1,"field","col-12","md:col-2"],["formControlName","currency","placeholder","Select currency...","styleClass","p-inputtext-sm","appendTo","body",3,"ngModelChange","options","autoOptionFocus"],["for","amount"],["styleClass","input-align-center","formControlName","amount","mode","currency","autoSelect","",1,"p-inputtext-sm",3,"required","autofocus","currency","locale","step","min"],["size","small","severity","contrast",3,"label","onClick",4,"ngIf"],["class","field col-12 md:col-2",4,"ngIf"],["class","grid",4,"ngIf"],["size","small","severity","contrast",3,"onClick","label"],["styleClass","input-align-center","formControlName","lbpAmount","mode","currency","currency","LBP","locale","en-LB","autoSelect","",1,"p-inputtext-sm",3,"required","step","min"],[1,"grid"],[1,"col-3","align-self-center"],[1,"text-left"],[1,"text-green-500"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","50%",3,"isLoading","loadingBar"],["colspan","2"],["styleClass","m-0"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","63%",3,"isLoading","loadingBar"],["icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"label","disabled","onClick",4,"ngIf"],["icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","disabled"],["icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","loading"],["icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"onClick","label","disabled"]],template:function(s,t){s&1&&(n(0,"p-dialog",3),o(1,"translate"),M("visibleChange",function(I){return N(t.visible,I)||(t.visible=I),I}),d("onHide",function(){return t.closeDialog()}),v(2,Le,38,41,"ng-template",4)(3,Ne,5,9,"ng-template",5),a()),s&2&&(L(V(11,Pe)),m("header",r(1,9,"Receive Payment"))("modal",!0),k("visible",t.visible),m("breakpoints",V(12,Ve))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[le,re,Q,te,ee,ie,ce,pe,me,se,fe,O,A,R,X,H,W,G,J,Z,$,Y,de,ue,oe,ge,he,ae,ye,ve]})}}return l})();export{bt as a};
