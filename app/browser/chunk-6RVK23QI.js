import{a as yt,b as xt}from"./chunk-ZROZKD44.js";import{a as gt}from"./chunk-O7X5CCTE.js";import{a as dt,b as mt}from"./chunk-VL5A4WUO.js";import{a as wt,b as St}from"./chunk-SVHA7J7U.js";import"./chunk-TQK45RMZ.js";import{a as pt,b as ut}from"./chunk-I32A4TGG.js";import"./chunk-4ONBVWLA.js";import"./chunk-UIPYUTXU.js";import{c as ht}from"./chunk-NAO374LW.js";import{a as vt}from"./chunk-YRUXN2TF.js";import"./chunk-ARZ4TFMZ.js";import{b as ot}from"./chunk-XGV4AIQT.js";import{a as Ct,b as bt}from"./chunk-GUGZD4RY.js";import{a as nt}from"./chunk-XFMQNLNY.js";import{a as st,b as lt,c as ft}from"./chunk-4MBB4EGX.js";import{a as _t}from"./chunk-5T7DQN3S.js";import{a as Re,b as Ke,c as He}from"./chunk-6CXWHLUJ.js";import{a as Ue}from"./chunk-7CR6E6US.js";import"./chunk-KICUZIBO.js";import{a as _e}from"./chunk-J64MJ6MF.js";import{a as it,b as le}from"./chunk-FA4OBAKY.js";import"./chunk-EA4RMISB.js";import{a as fe}from"./chunk-OY4T6UDA.js";import"./chunk-7ZNGIE4A.js";import{a as ct}from"./chunk-FO7TG3S7.js";import{b as ge}from"./chunk-42BTCZ3Y.js";import{a as rt,b as at}from"./chunk-7QYRFDGN.js";import{a as We,b as me}from"./chunk-5JE6H3SD.js";import{a as ue}from"./chunk-GUPSDBPB.js";import{a as ce}from"./chunk-UJ5JDQTE.js";import{a as de}from"./chunk-ZOJPJJYV.js";import"./chunk-UVEVFGTS.js";import"./chunk-P4HR6EQA.js";import{d as se,e as pe,f as be}from"./chunk-QJMHFOYW.js";import{a as ze,b as oe}from"./chunk-G5UOHYUM.js";import{F as tt,f as re,g as ae,i as Ze,j as Ye,l as Je,m as Ge,s as Xe,t as $e,u as et}from"./chunk-LBGQA5HW.js";import"./chunk-4A2WLUYH.js";import{b as H,c as z}from"./chunk-VVKQAEX7.js";import{a as Q,b as j}from"./chunk-FW7KDDDM.js";import{Ba as M,C,Ca as B,D,Da as k,Ea as V,Fa as h,G as Te,Ga as x,Ha as w,Ia as De,J as Ve,Ja as S,Jb as Le,K as d,Ka as I,L as m,La as T,Na as F,Oa as W,P as Pe,Pa as J,Qa as Fe,S as ve,Sb as Oe,Vb as ee,Wb as qe,X as Me,Xa as p,Y as r,Ya as u,Yb as Ae,ac as te,da as Y,db as Ne,fc as ie,ga as y,gb as G,hb as X,ia as c,ib as A,ka as Be,la as he,lc as ne,mb as $,na as Ce,nb as N,oa as s,pa as a,qa as E,r as Se,ra as ke,sa as Ee,ua as b,va as v,wa as l,wc as R,xc as K,y as Ie,yc as Qe,za as ye,zc as je}from"./chunk-DSVZHE42.js";import"./chunk-GAL4ENT6.js";var L=(()=>{class o{updateZeroItemsState(){this.localStorageService.setShowZeroItems(this.showZeroItems())}constructor(){this.customersFeaturesService=C(_e),this.discountprinterSettingsService=C(de),this.notificationService=C(ee),this.printerSettingsService=C(ue),this.printService=C(me),this.localStorageService=C(ze),this.decimalService=C(pe),this.currencySetting=C(oe),this.defaultCurrency=this.currencySetting.defaultCurrency,this.invoices=[],this.activeInvoiceId=null,this.nextId=1,this.fieldsetCollapsed=Y(!1),this.defaultOperationType=this.customersFeaturesService.defaultOperationType,this.showZeroItems=Y(this.localStorageService.getShowZeroItems()),this.customerDialogVisible=Y(!1),this.openInvoice()}openInvoice(e=this.defaultOperationType()){let i={id:this.nextId++,operation_type:e,discount_value:0,total_cost:0,total_avg_cost:0,total_amount:0,total_lbp:0,payment_amount:0,journal_notes:null,total_qty:0,currency:this.defaultCurrency(),items:[]};this.invoices.push(i),this.setActiveInvoice(i.id)}closeInvoice(e){if(this.invoices.length===1){this.clearInvoice(this.invoices[0]);return}if(this.invoices=this.invoices.filter(i=>i.id!==e),this.activeInvoiceId===e){let i=this.invoices[0];this.setActiveInvoice(i.id)}}clearInvoice(e){e.customer_id=void 0,e.total_amount=0,e.total_cost=0,e.total_avg_cost=0,e.total_lbp=0,e.total_qty=0,e.operation_type=this.defaultOperationType(),e.items=[]}setActiveInvoice(e){this.activeInvoiceId=e}get activeInvoice(){return this.invoices.find(e=>e.id===this.activeInvoiceId)}addItemToActiveInvoice(e){let i=this.activeInvoice;i&&(i.items.push(e),this.recalculateTotals(i))}recalculateTotals(e){let i=e.items.reduce((t,n)=>{let _=n.quantity||0,g=n.unit_price||0,P=n.unit_price_lbp||0,O=n.unit_cost||0,q=n.avg_cost||0;return t.total_amount=this.decimalService.add(t.total_amount,this.decimalService.multiply(g,_)),t.total_lbp=this.decimalService.add(t.total_lbp,this.decimalService.multiply(P,_)),t.total_cost=this.decimalService.add(t.total_cost,this.decimalService.multiply(O,_)),t.total_avg_cost=this.decimalService.add(t.total_avg_cost,this.decimalService.multiply(q,_)),t.total_qty=this.decimalService.add(t.total_qty,_),t},{total_amount:0,total_lbp:0,total_cost:0,total_avg_cost:0,total_qty:0});e.total_amount=i.total_amount,e.total_lbp=i.total_lbp,e.total_cost=i.total_cost,e.total_avg_cost=i.total_avg_cost,e.total_qty=i.total_qty}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275prov=Ie({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function Et(o,f){if(o&1){let e=b();s(0,"p-button",3),p(1,"translate"),v("onClick",function(){let t=d(e).$implicit,n=l();return m(n.invoiceService.setActiveInvoice(t.id))}),a()}if(o&2){let e=f.$implicit,i=l();c("label",u(1,2,"invoice ")+e.id)("outlined",e.id!==i.invoiceService.activeInvoiceId)}}var Vt=(()=>{class o{constructor(){this.invoiceService=C(L),this.translate=C(H)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=D({type:o,selectors:[["invoice-tabs"]],standalone:!0,features:[F],decls:4,vars:5,consts:[["styleClass","mb-1"],["size","small","severity","primary","styleClass","mr-2",3,"label","outlined","onClick",4,"ngFor","ngForOf"],["size","small","icon","pi pi-plus","severity","success",3,"onClick","label","outlined"],["size","small","severity","primary","styleClass","mr-2",3,"onClick","label","outlined"]],template:function(i,t){i&1&&(s(0,"p-card",0),y(1,Et,2,4,"p-button",1),s(2,"p-button",2),p(3,"translate"),v("onClick",function(){return t.invoiceService.openInvoice()}),a()()),i&2&&(r(),c("ngForOf",t.invoiceService.invoices),r(),c("label",u(3,3,"New"))("outlined",!0))},dependencies:[N,X,K,R,j,Q,z],styles:["[_nghost-%COMP%]  .p-card-body{padding:.9rem!important}[_nghost-%COMP%]  .p-card-content{padding:0!important}"]})}}return o})();var Nt=["invoiceTable"],Lt=["customersDropdown"],Ot=["productAutoComplete"],qt=["barcodeInput"],Wt=["payment_input"],At=["lira_input"],Qt=["notes_input"],jt=["discount_input"],Rt=["confirmDialog"],Kt=["payment_amount"],Pt=()=>({width:"50vw"}),Mt=()=>({"1199px":"65vw","575px":"90vw"}),Ht=()=>["name","phone"],zt=o=>({"text-red-500":o}),Ut=(o,f)=>({"text-orange-500":o,"text-red-500":f});function Zt(o,f){if(o&1&&(s(0,"div"),h(1),a(),s(2,"small"),h(3),a()),o&2){let e=f.$implicit;r(),x(e.name),r(2),x(e.phone)}}function Yt(o,f){if(o&1&&(s(0,"div"),h(1),a()),o&2){let e=l(3);r(),w(" ",e.selectedCustomer.name," ")}}function Jt(o,f){if(o&1&&(s(0,"small"),h(1),a()),o&2){let e=l(3);r(),x(e.selectedCustomer.phone)}}function Gt(o,f){if(o&1&&y(0,Yt,2,1,"div",26)(1,Jt,2,1,"small",26),o&2){let e=l(2);c("ngIf",e.selectedCustomer),r(),c("ngIf",e.selectedCustomer)}}function Xt(o,f){if(o&1){let e=b();s(0,"div",45)(1,"div",46)(2,"label",55),h(3),p(4,"translate"),a(),s(5,"p-dropdown",56),p(6,"translate"),p(7,"translate"),T("ngModelChange",function(t){d(e);let n=l(2);return I(n.invoice.operation_type,t)||(n.invoice.operation_type=t),m(t)}),v("onChange",function(){d(e);let t=l(2);return m(t.onOperationTypeChange())}),a()()()}if(o&2){let e=l(2);r(3),x(u(4,6,"Operation Type")),r(2),c("options",e.operationTypes),S("ngModel",e.invoice.operation_type),c("placeholder",u(6,8,"Operation Type"))("emptyMessage",u(7,10,"No results found"))("autoOptionFocus",!1)}}function $t(o,f){if(o&1){let e=b();s(0,"div",45)(1,"div",46)(2,"label"),h(3),p(4,"translate"),a(),s(5,"p-inputNumber",57,4),v("onFocus",function(t){d(e);let n=l(2);return m(n.select(t.target))}),T("ngModelChange",function(t){d(e);let n=l(2);return I(n.paymentAmountUSD,t)||(n.paymentAmountUSD=t),m(t)}),v("ngModelChange",function(t){d(e);let n=l(2);return m(n.onUSDChange(t))}),a()()()}if(o&2){let e=l(2);r(3),x(u(4,6,"Payment")),r(2),c("currency",e.defaultCurrency()==="dollar"?"USD":"LBP")("locale",e.defaultCurrency()==="dollar"?"en-US":"en-LB")("step",1)("min",0),S("ngModel",e.paymentAmountUSD)}}function ei(o,f){if(o&1){let e=b();s(0,"div",45)(1,"div",46)(2,"label"),h(3),p(4,"translate"),a(),s(5,"p-inputNumber",58,5),v("onFocus",function(t){d(e);let n=l(2);return m(n.select(t.target))}),T("ngModelChange",function(t){d(e);let n=l(2);return I(n.paymentAmountLBP,t)||(n.paymentAmountLBP=t),m(t)}),v("ngModelChange",function(t){d(e);let n=l(2);return m(n.onLBPChange(t))}),a()()()}if(o&2){let e=l(2);r(3),x(u(4,4,"LBP amount")),r(2),c("step",1e3)("min",0),S("ngModel",e.paymentAmountLBP)}}function ti(o,f){if(o&1){let e=b();s(0,"div")(1,"div",46)(2,"label",59),h(3),p(4,"translate"),a(),s(5,"input",60,6),T("ngModelChange",function(t){d(e);let n=l(2);return I(n.invoice.journal_notes,t)||(n.invoice.journal_notes=t),m(t)}),a()()()}if(o&2){let e=l(2);Be("col-8",!e.discountInputEnabled())("col-4",e.discountInputEnabled()),r(3),x(u(4,6,"Notes")),r(2),S("ngModel",e.invoice.journal_notes)}}function ii(o,f){if(o&1){let e=b();s(0,"div",45)(1,"div",46)(2,"label",61),h(3),p(4,"translate"),a(),s(5,"p-inputNumber",62,7),T("ngModelChange",function(t){d(e);let n=l(2);return I(n.invoice.discount_value,t)||(n.invoice.discount_value=t),m(t)}),v("onFocus",function(t){d(e);let n=l(2);return m(n.select(t.target))}),a()()()}if(o&2){let e=l(2);r(3),x(u(4,5,"Discount %")),r(2),S("ngModel",e.invoice.discount_value),c("maxFractionDigits",2)("min",0)("max",100)}}function ni(o,f){if(o&1&&(s(0,"div",63)(1,"table")(2,"thead")(3,"tr",64)(4,"th"),h(5),p(6,"translate"),a(),s(7,"th"),h(8),p(9,"translate"),a(),s(10,"th"),h(11),p(12,"translate"),a(),s(13,"th"),h(14),p(15,"translate"),a()()(),s(16,"tbody")(17,"tr",65)(18,"th")(19,"text-with-loading",66)(20,"span"),h(21),p(22,"currency"),p(23,"lira"),a()()(),s(24,"th"),h(25),p(26,"currency"),p(27,"lira"),a(),s(28,"th"),h(29),p(30,"currency"),p(31,"lira"),a(),s(32,"th")(33,"text-with-loading",67)(34,"span"),h(35),p(36,"currency"),p(37,"lira"),a()()()()()()()),o&2){let e=l(2);r(5),x(u(6,12,"Old Balance")),r(3),w(" ",u(9,14,"Current Invoice")," "),r(3),x(u(12,16,"Payment")),r(3),x(u(15,18,"New Balance")),r(5),c("isLoading",e.customer_balance_loading())("loadingBar",!0),r(2),x(e.defaultCurrency()==="dollar"?u(22,20,e.customer_balance().balance):u(23,22,e.customer_balance().balance)),r(4),w(" ",e.defaultCurrency()==="dollar"?u(26,24,e.invoice.total_amount):u(27,26,e.invoice.total_amount)," "),r(4),w(" ",e.defaultCurrency()==="dollar"?u(30,28,e.invoice.payment_amount||0):u(31,30,e.invoice.payment_amount||0)," "),r(4),c("isLoading",e.customer_balance_loading())("loadingBar",!0),r(2),x(e.defaultCurrency()==="dollar"?u(36,32,e.calculateNewBalance(e.customer_balance().balance,e.invoice.total_amount,e.invoice.payment_amount)):u(37,34,e.calculateNewBalance(e.customer_balance().balance,e.invoice.total_amount,e.invoice.payment_amount)))}}function oi(o,f){if(o&1){let e=b();s(0,"div",68)(1,"p-button",69),p(2,"translate"),v("onClick",function(){d(e);let t=l(2);return m(t.openCustomerDialog())}),a()()}o&2&&(r(),ye("label",u(2,1,"New Customer")))}function ri(o,f){if(o&1){let e=b();s(0,"div",44)(1,"div",45)(2,"div",46)(3,"label",47),h(4),p(5,"translate"),a(),s(6,"p-dropdown",48,3),p(8,"translate"),p(9,"translate"),v("onShow",function(){d(e);let t=l();return m(t.dropDownVisible=!0)})("onHide",function(){d(e);let t=l();return m(t.dropDownVisible=!1)})("onChange",function(t){d(e);let n=l();return m(n.onCustomerChange(t.value))}),y(10,Zt,4,2,"ng-template",49)(11,Gt,2,2,"ng-template",50),a()()(),y(12,Xt,8,12,"div",51)(13,$t,7,8,"div",51)(14,ei,7,6,"div",51)(15,ti,7,8,"div",52)(16,ii,7,7,"div",51)(17,ni,38,36,"div",53)(18,oi,3,3,"div",54),a()}if(o&2){let e=l();r(4),x(u(5,17,"Customer")),r(2),c("loading",e.loadingCustomers())("placeholder",u(8,19,"Select Customer"))("emptyMessage",u(9,21,"No results found"))("filter",!0)("showClear",!0)("autoOptionFocus",!1)("filterFields",W(23,Ht))("options",e.customers())("ngModel",e.selectedCustomer),r(6),c("ngIf",e.selectedCustomer),r(),c("ngIf",e.selectedCustomer&&e.invoice.operation_type=="debt"),r(),c("ngIf",e.selectedCustomer&&e.invoice.operation_type=="debt"&&e.defaultCurrency()==="dollar"),r(),c("ngIf",e.selectedCustomer&&e.invoice.operation_type=="debt"),r(),c("ngIf",e.discountInputEnabled()&&e.selectedCustomer),r(),c("ngIf",e.selectedCustomer&&e.invoice.operation_type==="debt"),r(),c("ngIf",!e.selectedCustomer)}}function ai(o,f){if(o&1&&(s(0,"div",75),h(1),a(),s(2,"small"),h(3),p(4,"currency"),p(5,"lira"),a()),o&2){let e=f.$implicit;c("autoDir",e.product_name),r(),w(" ",e.product_name," "),r(2),x(e.currency==="dollar"?u(4,3,e.unit_price_usd):u(5,5,e.unit_price_usd))}}function si(o,f){if(o&1){let e=b();s(0,"div",76)(1,"div",77)(2,"p-selectButton",78),T("ngModelChange",function(t){d(e);let n=l(2);return I(n.selected_price_type,t)||(n.selected_price_type=t),m(t)}),a()()()}if(o&2){let e=l(2);r(2),c("options",e.stateOptions),S("ngModel",e.selected_price_type),c("allowEmpty",!1)}}function li(o,f){if(o&1){let e=b();s(0,"div",44)(1,"div",70)(2,"p-autoComplete",71,8),p(5,"translate"),p(6,"translate"),v("completeMethod",function(t){d(e);let n=l();return m(n.filterProducts(t))}),T("ngModelChange",function(t){d(e);let n=l();return I(n.productSearchText,t)||(n.productSearchText=t),m(t)}),v("onKeyUp",function(t){d(e);let n=l();return m(n.handleProductInputKeydown(t))}),y(7,ai,6,7,"ng-template",49),a(),s(8,"p-button",72),v("onClick",function(){d(e);let t=l();return m(t.productsDialogVisible=!0)}),a(),s(9,"p-button",73),p(10,"translate"),v("onClick",function(){d(e);let t=l();return m(t.productDialogVisible=!0)}),a()(),y(11,si,3,3,"div",74),a()}if(o&2){let e=l();r(2),c("suggestions",e.filteredProducts)("dropdown",!1)("minLength",1)("showClear",!0),S("ngModel",e.productSearchText),c("placeholder",u(5,10,"scan or search"))("emptyMessage",u(6,12,"No results found"))("delay",0),r(7),c("label",u(10,14,"New Product")),r(2),c("ngIf",e.wholesaleEnabled())}}function ci(o,f){o&1&&(s(0,"th"),h(1),p(2,"translate"),a()),o&2&&(r(),w(" ",u(2,1,"Dis %")," "))}function pi(o,f){if(o&1&&(s(0,"tr")(1,"th",79),h(2),p(3,"translate"),a(),s(4,"th",80),h(5),p(6,"translate"),a(),y(7,ci,3,3,"th",26),s(8,"th",81),h(9),p(10,"translate"),a(),s(11,"th",82),p(12,"translate"),h(13),p(14,"translate"),a(),s(15,"th",80),h(16),p(17,"translate"),a(),s(18,"th",81),h(19),p(20,"translate"),a()()),o&2){let e=l();r(2),w(" ",u(3,8,"Description")," "),r(3),x(u(6,10,"Unit")),r(2),c("ngIf",e.discountInputEnabled()),r(2),x(u(10,12,"Qty")),r(2),c("pTooltip",u(12,14,"Remaining quantity")),r(2),w(" ",u(14,16,"Rem.")," "),r(3),x(u(17,18,"Total")),r(3),x(u(20,20,"Del"))}}function ui(o,f){if(o&1&&(s(0,"div")(1,"small"),h(2),p(3,"dollar"),p(4,"lira"),a()()),o&2){let e=l().$implicit;r(2),x(e.currency==="dollar"?u(3,1,e.unit_price):u(4,3,e.unit_price_lbp))}}function di(o,f){if(o&1){let e=b();s(0,"td",86),v("click",function(t){d(e);let n=l().rowIndex,_=l(),g=V(33);return m(_.openEdit(g,t,n,"discount"))}),h(1),a()}if(o&2){let e=l().$implicit;r(),w(" ",e.discount_percentage,"% ")}}function mi(o,f){if(o&1&&(s(0,"div")(1,"small"),h(2),p(3,"dollar"),p(4,"lira"),a()()),o&2){let e=l().$implicit;r(2),x(e.currency==="dollar"?u(3,1,e.unit_price*e.quantity):u(4,3,e.unit_price_lbp*e.quantity))}}function _i(o,f){if(o&1){let e=b();s(0,"tr")(1,"td",83),p(2,"currency"),p(3,"lira"),h(4),a(),s(5,"td",84),v("click",function(t){let n=d(e).rowIndex,_=l(),g=V(33);return m(_.openEdit(g,t,n,"price"))}),h(6),p(7,"currency"),p(8,"lira"),y(9,ui,5,5,"div",26),a(),y(10,di,2,1,"td",85),s(11,"td",86),v("click",function(t){let n=d(e).rowIndex,_=l(),g=V(33);return m(_.openEdit(g,t,n,"quantity"))}),h(12),a(),s(13,"td",87),h(14),a(),s(15,"td",86),v("click",function(t){let n=d(e).rowIndex,_=l(),g=V(33);return m(_.openEdit(g,t,n,"total"))}),h(16),p(17,"currency"),p(18,"lira"),y(19,mi,5,5,"div",26),a(),s(20,"td",88),v("click",function(){let t=d(e).rowIndex,n=l();return m(n.removeRow(t))}),E(21,"i",89),a()()}if(o&2){let e=f.$implicit,i=l();r(),c("pTooltip",i.userPermissions().show_cost?i.defaultCurrency()==="dollar"?u(2,12,e.unit_cost).toString():u(3,14,e.unit_cost).toString():"")("autoDir",e.product_name),r(3),w(" ",e.product_name," "),r(),c("ngClass",J(24,zt,i.getPriceWarning(e))),r(),w(" ",i.defaultCurrency()==="dollar"?u(7,16,e.unit_price):u(8,18,e.unit_price)," "),r(3),c("ngIf",i.defaultCurrency()==="dollar"),r(),c("ngIf",i.discountInputEnabled()),r(2),w(" ",e.quantity," "),r(),c("ngClass",Fe(26,Ut,e.stock-e.quantity<=e.low_stock_threshold&&e.stock_management,e.stock-e.quantity<0&&e.stock_management)),r(),w(" ",e.stock_management?(e.stock-e.quantity).toFixed(2):"--"," "),r(2),w(" ",i.defaultCurrency()==="dollar"?u(17,20,e.unit_price*e.quantity):u(18,22,e.unit_price*e.quantity)," "),r(3),c("ngIf",i.defaultCurrency()==="dollar")}}function gi(o,f){if(o&1&&(s(0,"h4",91),h(1),p(2,"translate"),a()),o&2){let e=l(2);r(),De(" ",u(2,2,"Total units:")," ",e.invoice.total_qty," ")}}function fi(o,f){if(o&1&&y(0,gi,3,4,"h4",90),o&2){let e=l();c("ngIf",e.invoice.total_qty)}}function vi(o,f){o&1&&(s(0,"tr",92)(1,"td",93),h(2),p(3,"translate"),a()()),o&2&&(r(2),w(" ",u(3,1,"No data yet!")," "))}function hi(o,f){if(o&1){let e=b();s(0,"div",94)(1,"p-button",95),p(2,"translate"),v("onClick",function(){d(e);let t=l();return m(t.openPrintDialog())}),a()()}if(o&2){let e=l();r(),c("label",u(2,2,"Print Quote"))("disabled",e.invoice.items.length==0)}}function Ci(o,f){o&1&&(s(0,"small"),h(1),p(2,"translate"),a()),o&2&&(r(),w(" ",u(2,1,"Note: Press `Space` to print last invoice")," "))}function yi(o,f){if(o&1){let e=b();s(0,"p-inputNumber",96),T("ngModelChange",function(t){d(e);let n=l();return I(n.editingValue,t)||(n.editingValue=t),m(t)}),v("onFocus",function(t){d(e);let n=l();return m(n.select(t.target))})("onBlur",function(){d(e);let t=l(),n=V(33);return m(t.applyEdit(n))})("onKeyDown",function(t){d(e);let n=l(),_=V(33);return m(n.submitEdit(t,_))}),a()}if(o&2){let e=l();S("ngModel",e.editingValue),c("maxFractionDigits",2)("min",0)("autofocus",!0)}}function bi(o,f){if(o&1){let e=b();s(0,"p-inputNumber",96),T("ngModelChange",function(t){d(e);let n=l();return I(n.editingValue,t)||(n.editingValue=t),m(t)}),v("onFocus",function(t){d(e);let n=l();return m(n.select(t.target))})("onBlur",function(){d(e);let t=l(),n=V(33);return m(t.applyEdit(n))})("onKeyDown",function(t){d(e);let n=l(),_=V(33);return m(n.submitEdit(t,_))}),a()}if(o&2){let e=l();S("ngModel",e.editingValue),c("maxFractionDigits",2)("min",0)("autofocus",!0)}}function xi(o,f){if(o&1){let e=b();s(0,"p-inputNumber",97),T("ngModelChange",function(t){d(e);let n=l();return I(n.editingValue,t)||(n.editingValue=t),m(t)}),v("onFocus",function(t){d(e);let n=l();return m(n.select(t.target))})("onBlur",function(){d(e);let t=l(),n=V(33);return m(t.applyEdit(n))})("onKeyDown",function(t){d(e);let n=l(),_=V(33);return m(n.submitEdit(t,_))}),a()}if(o&2){let e=l();S("ngModel",e.editingValue),c("maxFractionDigits",2)("minFractionDigits",0)("autofocus",!0)}}function wi(o,f){if(o&1){let e=b();s(0,"p-inputNumber",98),T("ngModelChange",function(t){d(e);let n=l();return I(n.editingValue,t)||(n.editingValue=t),m(t)}),v("onFocus",function(t){d(e);let n=l();return m(n.select(t.target))})("onBlur",function(){d(e);let t=l(),n=V(33);return m(t.applyEdit(n))})("onKeyDown",function(t){d(e);let n=l(),_=V(33);return m(n.submitEdit(t,_))}),a()}if(o&2){let e=l();S("ngModel",e.editingValue),c("maxFractionDigits",2)("min",0)("max",100)("autofocus",!0)}}function Si(o,f){if(o&1){let e=b();s(0,"p-inputNumber",99),T("ngModelChange",function(t){d(e);let n=l();return I(n.editingValue,t)||(n.editingValue=t),m(t)}),v("onFocus",function(t){d(e);let n=l();return m(n.select(t.target))})("onKeyDown",function(t){d(e);let n=l(),_=V(33);return m(n.submitEdit(t,_))}),a()}if(o&2){let e=l();S("ngModel",e.editingValue),c("maxFractionDigits",2)("min",0)("max",100)("autofocus",!0)}}function Ii(o,f){if(o&1){let e=b();s(0,"p-button",100),v("onClick",function(){d(e);let t=l();return m(t.applyDiscount(66))}),a()}}function Ti(o,f){if(o&1){let e=b();s(0,"p-button",101),v("onClick",function(){d(e);let t=l();return m(t.applyDiscount(33))}),a()}}function Vi(o,f){if(o&1){let e=b();s(0,"p-button",102),p(1,"translate"),v("onClick",function(){d(e);let t=l();return m(t.confirmCheckoutAndPrint())}),a(),s(2,"p-button",103),p(3,"translate"),v("onClick",function(){d(e);let t=l();return m(t.rejectCheckout())}),a(),s(4,"p-button",104),p(5,"translate"),v("onClick",function(){d(e);let t=l();return m(t.confirmCheckout())}),a()}o&2&&(c("label",u(1,3,"Yes & Print")),r(2),c("label",u(3,5,"No")),r(2),c("label",u(5,7,"Yes")))}var we=(()=>{class o{constructor(){this.invoiceService=C(L),this.customersService=C(nt),this.dollarPipe=C(be),this.stockService=C(se),this.translate=C(H),this.decimalService=C(pe),this.authService=C(We),this.wholesaleSettingService=C(vt),this.notificationService=C(ee),this.printService=C(me),this.printerSettingsService=C(ue),this.confirmationService=C(Le),this.apiService=C(qe),this.historyService=C(_t),this.cashBalanceService=C(Ue),this.customersFeaturesService=C(_e),this.priceQuoteService=C(yt),this.discountSettings=C(de),this.currencySetting=C(oe),this.sellScaleService=C(xt),this.vh=this.sellScaleService.sellPageVH,this.defaultCurrency=this.currencySetting.defaultCurrency,this.productDialogVisible=!1,this.userPermissions=this.authService.userPermissions,this.productsDialogVisible=!1,this.stockTableLoading=this.stockService.tableLoading,this.wholesaleEnabled=this.wholesaleSettingService.wholesaleEnabled,this.priceQuoteEnabled=this.priceQuoteService.priceQuoteEnabled,this.customersFeaturesEnabled=this.customersFeaturesService.customersFeaturesEnabled,this.products=this.stockService.products,this.filteredProducts=[],this.productSearchText="",this.view_currency="dollar",this.selected_price_type="unit_price_usd",this.stateOptions=[{label:this.translate.instant("Retail"),value:"unit_price_usd"},{label:this.translate.instant("Wholesale"),value:"wholesale_price_usd"}],this.exchangeRate=this.stockService.exchangeRate,this.customers=this.customersService.customers,this.loadingCustomers=this.customersService.signal_tableLoading,this.discountInputEnabled=this.discountSettings.discountInputEnabled,this.dropDownVisible=!1,this.paymentAmountUSD=0,this.paymentAmountLBP=0,this.customerDialogVisible=!1,this.customer_balance_loading=this.customersService.signal_balanceLoading,this.customer_balance=this.customersService.customersTotalDebts$,this.operationTypes=[{label:this.translate.instant("Normal"),value:"normal"},{label:this.translate.instant("Debt"),value:"debt"}],this.editModeEnabled=!1,this.editingRowIndex=null,this.editingField="",this.defaultDiscountType=this.discountSettings.defaultDiscountType,this.printerSettings=this.printerSettingsService.printerSettings,this.thermalPrinterEnabled=this.printerSettingsService.thermalPrinterEnabled,this.confirmShowed=!1,this.checkoutLoading=!1,this.printDialogVisible=!1}focusAcceptButton(){let e=this.confirmDialog.nativeElement.querySelector(".p-confirm-dialog-accept");e&&e.focus()}focusRejectButton(){let e=this.confirmDialog.nativeElement.querySelector(".p-confirm-dialog-reject");e&&e.focus()}focusBarcodeInput(){this.barcodeInput.nativeElement.querySelector("input").focus()}blurBarcodeInput(){this.barcodeInput.nativeElement.querySelector("input").blur()}onKeyDown(e){if(this.editModeEnabled||this.productDialogVisible||this.printDialogVisible)return;let t=navigator.userAgent.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey,n=e.key.toLowerCase();if(n==="meta"||n==="control"||n==="shift"||n==="alt"||t&&["c","v","p","x","a","s","z","y"].includes(n))return;if(this.confirmShowed){e.code=="ArrowRight"?this.focusAcceptButton():e.code=="ArrowLeft"&&this.focusRejectButton();return}else if(this.dropDownVisible||this.productsDialogVisible||this.customerDialogVisible||this.confirmShowed)return;let g=this.payment_input,P=this.lira_input,O=this.discount_input,q=this.notes_input?this.notes_input.nativeElement:null;if((!g||!g.focused)&&(!P||!P.focused)&&(!O||!O.focused)&&document.activeElement!==q){if(e.code=="Space"&&this.thermalPrinterEnabled()){let U=JSON.parse(localStorage.getItem("PrintInvoice"));U&&!this.productSearchText&&(this.printService.thermalPrint(U,"Sale"),setTimeout(()=>{this.productSearchText="",this.blurBarcodeInput()}));return}else e.code=="Enter"&&!this.productSearchText&&this.invoice.items.length>0?this.checkout():this.focusBarcodeInput();e.key==="+"?this.productSearchText||(this.addQtyToLastItem(),setTimeout(()=>{this.productSearchText="",this.blurBarcodeInput(),this.productAutoComplete.hide()})):e.key==="-"?this.productSearchText||(this.removeQtyFromLastItem(),setTimeout(()=>{this.productSearchText="",this.blurBarcodeInput(),this.productAutoComplete.hide()})):this.focusBarcodeInput()}}recalculateTotals(){this.invoiceService.recalculateTotals(this.invoice)}filterProducts(e){let i=e.query.toLowerCase();this.filteredProducts=this.products().filter(t=>t.product_name.toLowerCase().includes(i)||t.sku?.toLowerCase().includes(i)||t.barcode?.toLowerCase().includes(i))}handleProductInputKeydown(e){e.key==="Enter"&&(this.productSearchText&&(this.processProductSearch(this.productSearchText),e.preventDefault()),this.productSearchText="",setTimeout(()=>{this.productAutoComplete.hide()},50))}processProductSearch(e){if(typeof e=="string"){if(!e?.trim())return;let i=1,t=e.trim(),n=["*","+"];for(let g of n){let P=t.indexOf(g);if(P>0){let O=t.substring(0,P),q=t.substring(P+1),U=parseInt(O);!isNaN(U)&&q&&(i=U,t=q);break}}let _=this.products().find(g=>g.barcode?.toLowerCase()===t.toLowerCase()||g.sku?.toLowerCase()===t.toLowerCase()||g.product_name?.toLowerCase()===t.toLowerCase());_?(this.addProductToInvoice(_,i),this.resetProductSearch()):this.notificationService.showError("Item not found!","home")}else typeof e=="object"&&e?.product_id&&(this.addProductToInvoice(e,1),this.resetProductSearch());this.productAutoComplete.hide()}addProductToInvoice(e,i=1){let t=this.invoice.items.find(n=>n.product_id===e.product_id);if(t)t.quantity+=i,t.total_price=t.unit_price*t.quantity;else{let n=this.wholesaleEnabled()&&this.selected_price_type==="wholesale_price_usd"&&e.wholesale_price_usd||e.unit_price_usd,_=e.unit_cost_usd,g=e.avg_cost_usd;this.defaultCurrency()==="dollar"?e.currency=="lira"&&(n=n/this.exchangeRate().rate_value,_=_/this.exchangeRate().rate_value,g=g/this.exchangeRate().rate_value):e.currency=="dollar"&&(n=this.dollarPipe.calculate(n),_=this.dollarPipe.calculate(_),g=this.dollarPipe.calculate(g)),this.invoice.items.push({product_id:e.product_id,barcode:e.barcode,product_name:e.product_name,unit_cost:_,avg_cost:g,original_price:n,unit_price:this.discountInputEnabled()?n*(1-this.invoice.discount_value/100):n,discount_percentage:this.invoice.discount_value,unit_price_lbp:this.dollarPipe.calculate(n),quantity:i,stock_management:e.stock_management,stock:e.quantity,low_stock_threshold:e.low_stock_threshold,currency:e.currency}),setTimeout(()=>{this.invoiceTable&&this.invoiceTable.scrollTo({top:this.invoiceTable.wrapperViewChild.nativeElement.scrollHeight})},10)}this.recalculateTotals()}onProductSelection(e){this.addProductToInvoice(e)}resetProductSearch(){this.productSearchText="",this.filteredProducts=[],this.productAutoComplete.hide()}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(i=>{this.addProductToInvoice(i,1)})}getPriceWarning(e){if(this.userPermissions().show_cost){if(!e.unit_price)return!1;let i=e.unit_cost||0,t=e.unit_price;return typeof i=="string"&&(i=parseFloat(i)),typeof t=="string"&&(t=parseFloat(t)),t<i}else return!1}getTooltipData(e){return this.userPermissions().show_cost?e.unit_cost:null}removeRow(e){e<0||e>=this.invoice.items.length||(this.invoice.items.splice(e,1),this.recalculateTotals())}addQtyToLastItem(e=1){let i=this.invoice.items;if(i.length===0)return;let t=i[i.length-1];t.quantity=(t.quantity||0)+e,this.recalculateTotals()}removeQtyFromLastItem(e=1){let i=this.invoice.items;if(i.length===0)return;let t=i.length-1,n=i[t];(n.quantity||0)>1?(n.quantity-=e,n.quantity<1&&(n.quantity=1)):i.splice(t,1),this.recalculateTotals()}onCreateProduct(e){this.addProductToInvoice(e),this.stockService.onCreateProduct(e)}onUSDChange(e){this.paymentAmountUSD=e,this.paymentAmountLBP=this.dollarPipe.calculate(e),this.invoice.payment_amount=e}onLBPChange(e){this.paymentAmountLBP=e;let i=e/this.exchangeRate().rate_value||0;this.paymentAmountUSD=i,this.invoice.payment_amount=i}resetData(){this.invoice.customer_id=null,this.invoice.discount_value=0,this.invoice.journal_notes=null,this.onUSDChange(0),this.onLBPChange(0),this.customer_balance.set({id:0,balance:0})}get selectedCustomer(){return this.customers().find(e=>e.account_id===this.invoice.customer_id)}onCustomerChange(e){this.invoice.customer_id=e?.account_id,this.loadCustomerInfo(e?.account_id),this.discountInputEnabled()&&(e?this.invoice.discount_value=e?.default_discount:this.invoice.discount_value=0),setTimeout(()=>{this.focusBarcodeInput()},10)}openCustomerDialog(){this.customerDialogVisible=!0}newCustomerCreated(e){this.customers.set([...this.customers(),e]),e&&this.onCustomerChange(e)}loadCustomerInfo(e){e?this.customersService.getAccountTotalBalance(e,this.defaultCurrency()):this.resetData()}onOperationTypeChange(){this.invoice.customer_id&&this.loadCustomerInfo(this.invoice.customer_id)}ngOnChanges(e){e.invoice&&(this.paymentAmountUSD=this.invoice.payment_amount??0,this.paymentAmountLBP=this.dollarPipe.calculate(this.paymentAmountUSD),this.loadCustomerInfo(this.invoice.customer_id))}select(e){e.select()}calculateNewBalance(e=0,i,t=0){return e=parseFloat(e),t||(t=0),this.decimalService.subtract(this.decimalService.add(e,i),t)}openEdit(e,i,t,n){this.editingRowIndex=t,this.editingField=n;let _=this.invoice.items[t];switch(n){case"quantity":this.editingValue=_.quantity;break;case"price":this.editingValue=_.unit_price;break;case"discount":this.editingValue=_.discount_percentage;break;case"total":this.editingValue=_.unit_price*_.quantity;break}e.show(i)}applyEdit(e){if(this.editingRowIndex===null)return;let i=this.invoice.items[this.editingRowIndex];if(this.editingField==="quantity")i.quantity=this.editingValue;else if(this.editingField==="price")if(i.unit_price=this.editingValue,i.unit_price_lbp=this.dollarPipe.calculate(this.editingValue),i.original_price){let t=100*(1-i.unit_price/i.original_price);i.discount_percentage=parseFloat(t.toFixed(2))}else i.discount_percentage=0;else if(this.editingField==="total")if(i.unit_price=this.editingValue/i.quantity,i.unit_price_lbp=this.dollarPipe.calculate(i.unit_price),i.original_price){let t=100*(1-i.unit_price/i.original_price);i.discount_percentage=parseFloat(t.toFixed(2))}else i.discount_percentage=0;else if(this.editingField==="discount")if(i.discount_percentage=this.editingValue,i.original_price){let t=(100-i.discount_percentage)/100;i.unit_price=parseFloat((i.original_price*t).toFixed(2))}else i.unit_price=0;this.editingRowIndex=null,this.editingField="",e.hide(),this.recalculateTotals()}applyDiscount(e){if(this.editingRowIndex===null)return;let i=this.invoice.items[this.editingRowIndex],n=this.decimalService.subtract(i.original_price,i.unit_cost)*(1-e/100),_=this.decimalService.add(i.unit_cost,n);console.log(_.toFixed(2));let g=100*(1-_/i.original_price);this.editingValue=g.toFixed(2)}submitEdit(e,i){e.key=="Enter"&&this.applyEdit(i)}checkout(){this.confirmShowed=!0,this.confirmationService.confirm({key:"sell",message:this.translate.instant("Are you sure that you want to submit invoice ?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-success",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject"})}confirmCheckout(e=!1){this.confirmShowed=!1,this.checkoutLoading=!0;let i=null;this.invoice.customer_id&&this.invoice.payment_amount&&(i={amount:this.invoice.payment_amount,customer_id:this.invoice.customer_id});let t=this.invoice;t.exchange_rate=this.stockService.exchangeRate().rate_value,t.currency=this.defaultCurrency(),t.customer_id||(t.operation_type="normal"),this.confirmationService.close(),this.apiService.post("sell-orders",{invoice:t,payment:i}).pipe(Se(()=>{this.checkoutLoading=!1,this.confirmationService.close()})).subscribe({next:n=>{if(this.resetData(),this.notificationService.showSuccess("Invoice submitted","home"),this.invoiceService.closeInvoice(this.invoice.id),this.stockService.getItems(),this.historyService.fetchSalesHistory(),this.cashBalanceService.getBalance(),e&&(this.dataToPrint=n,this.printDialogVisible=!0),this.thermalPrinterEnabled()){let _=structuredClone(n),g=0;_.items.forEach(P=>{g=this.decimalService.add(g,this.decimalService.multiply(this.dollarPipe.calculate(P.unit_price),P.quantity))}),_.total_lbp=g,this.printerSettings().auto_print&&this.printService.thermalPrint(_,"sales"),localStorage.setItem("PrintInvoice",JSON.stringify(_))}}})}rejectCheckout(){this.confirmationService.close(),this.confirmShowed=!1,this.checkoutLoading=!1}confirmCheckoutAndPrint(){this.confirmCheckout(!0)}clearInvoice(){this.confirmShowed=!0,this.confirmationService.confirm({key:"clearInvoice",message:this.translate.instant("Are you sure you want to clear invoice?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoiceService.closeInvoice(this.invoice.id),this.checkoutLoading=!1,this.confirmShowed=!1},reject:()=>{this.confirmShowed=!1}})}openPrintDialog(){this.dataToPrint=structuredClone(this.invoice),this.dataToPrint.type="quote",this.dataToPrint.order_datetime=new Date,this.dataToPrint.exchange_rate=this.stockService.exchangeRate().rate_value,this.printDialogVisible=!0}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=D({type:o,selectors:[["invoice-table"]],viewQuery:function(i,t){if(i&1&&(M(Nt,5),M(Lt,5),M(Ot,5),M(qt,5,ve),M(Wt,5),M(At,5),M(Qt,5),M(jt,5),M(Rt,5,ve),M(Kt,5)),i&2){let n;B(n=k())&&(t.invoiceTable=n.first),B(n=k())&&(t.customersDropdown=n.first),B(n=k())&&(t.productAutoComplete=n.first),B(n=k())&&(t.barcodeInput=n.first),B(n=k())&&(t.payment_input=n.first),B(n=k())&&(t.lira_input=n.first),B(n=k())&&(t.notes_input=n.first),B(n=k())&&(t.discount_input=n.first),B(n=k())&&(t.confirmDialog=n.first),B(n=k())&&(t.payment_amount=n.first)}},hostBindings:function(i,t){i&1&&v("keydown",function(_){return t.onKeyDown(_)},!1,Me)},inputs:{invoice:"invoice"},standalone:!0,features:[Ve,F],decls:56,vars:64,consts:[["invoiceTable",""],["op",""],["confirmDialog",""],["customersDropdown",""],["payment_input",""],["lira_input",""],["notes_input",""],["discount_input",""],["productAutoComplete","","barcodeInput",""],["styleClass","mb-2"],[1,"flex","justify-content-between"],["tooltipPosition","top",1,"text-green-600","m-0","mt-2","pointer",3,"pTooltip"],["tooltipPosition","top",1,"text-primary","m-0","mt-2","pointer",3,"pTooltip"],["class","grid",4,"ngIf"],["dataKey","product_id","styleClass","p-datatable-sm ","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"grid","mt-3"],[3,"ngClass"],["icon","pi pi-times","severity","danger","size","small","styleClass","w-full",3,"onClick","label"],["class","col-3",4,"ngIf"],[1,"col-6"],["icon","pi pi-cart-plus","severity","success","size","small","styleClass","w-full",3,"onClick","label","loading","disabled"],[4,"ngIf"],["appendTo","body",3,"onShow","onHide","dismissable"],[1,"formgrid","grid"],[1,"field","col-12"],["class","p-inputtext-sm","styleClass","input-align-center","step","0",3,"ngModel","maxFractionDigits","min","autofocus","ngModelChange","onFocus","onBlur","onKeyDown",4,"ngIf"],["class","p-inputtext-sm","min","0.1","step","0.1",3,"ngModel","maxFractionDigits","minFractionDigits","autofocus","ngModelChange","onFocus","onBlur","onKeyDown",4,"ngIf"],["class","p-inputtext-sm","styleClass","input-align-center","step","0.1",3,"ngModel","maxFractionDigits","min","max","autofocus","ngModelChange","onFocus","onBlur","onKeyDown",4,"ngIf"],["class","p-inputtext-sm","styleClass","input-align-center","step","0.1",3,"ngModel","maxFractionDigits","min","max","autofocus","ngModelChange","onFocus","onKeyDown",4,"ngIf"],["size","small","severity","success","label","apply","styleClass","ml-2",3,"onClick"],["size","small","label","66%",3,"onClick",4,"ngIf"],["size","small","label","33%","styleClass","mx-2",3,"onClick",4,"ngIf"],[3,"visibleChange","onCreate","visible","mode"],[3,"onHide","onSubmit","visible","products","tableLoading"],["mode","add",3,"visibleChange","onCreate","visible"],[3,"visibleChange","visible","invoice"],["key","sell",3,"breakpoints"],["pTemplate","footer"],["key","clearInvoice",3,"breakpoints"],[1,"grid"],[1,"col-4"],[1,"flex","flex-column","gap-1"],["for","customer"],["styleClass","p-inputtext-sm","appendTo","body",3,"onShow","onHide","onChange","loading","placeholder","emptyMessage","filter","showClear","autoOptionFocus","filterFields","options","ngModel"],["pTemplate","item"],["pTemplate","selectedItem"],["class","col-4",4,"ngIf"],[3,"col-8","col-4",4,"ngIf"],["class","col-12",4,"ngIf"],["class","col-8 flex align-self-end justify-content-end",4,"ngIf"],["for","option"],["styleClass","p-inputtext-sm","appendTo","body","optionLabel","label","optionValue","value",3,"ngModelChange","onChange","options","ngModel","placeholder","emptyMessage","autoOptionFocus"],["inputId","currency-us","mode","currency","styleClass","p-inputtext-sm w-full",3,"onFocus","ngModelChange","currency","locale","step","min","ngModel"],["inputId","currency-lb","mode","currency","currency","LBP","locale","en-LB","styleClass","p-inputtext-sm w-full",3,"onFocus","ngModelChange","step","min","ngModel"],["for","currency"],["pInputText","","type","text","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","ngModel"],["for","discount"],["styleClass","p-inputtext-sm w-full","suffix"," %","step","0",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min","max"],[1,"col-12"],[1,"text-green-500"],[1,"text-center"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","50%",3,"isLoading","loadingBar"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","63%",3,"isLoading","loadingBar"],[1,"col-8","flex","align-self-end","justify-content-end"],["icon","pi pi-user","severity","success","size","small",3,"onClick","label"],[1,"col-8"],["dataKey","product_id","field","product_name","spellcheck","false","styleClass","p-inputtext-sm",3,"completeMethod","ngModelChange","onKeyUp","suggestions","dropdown","minLength","showClear","ngModel","placeholder","emptyMessage","delay"],["severity","warning","size","small","icon","pi pi-list","styleClass","mx-2",3,"onClick"],["icon","pi pi-plus","size","small","severity","success",3,"onClick","label"],["class","col-4 flex justify-content-end",4,"ngIf"],[3,"autoDir"],[1,"col-4","flex","justify-content-end"],[1,"flex","justify-content-center"],["optionLabel","label","optionValue","value","styleClass","p-button-sms",3,"ngModelChange","options","ngModel","allowEmpty"],["width","45%"],["width","20%"],["width","5%"],["width","5%","tooltipPosition","top",3,"pTooltip"],["tooltipPosition","top",1,"pointer",3,"pTooltip","autoDir"],[1,"editable",3,"click","ngClass"],["class","editable",3,"click",4,"ngIf"],[1,"editable",3,"click"],[1,"font-bold",3,"ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],[1,"col-3"],["icon","pi pi-print","size","small","severity","contrast","styleClass","w-full",3,"onClick","label","disabled"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm",3,"ngModelChange","onFocus","onBlur","onKeyDown","ngModel","maxFractionDigits","min","autofocus"],["min","0.1","step","0.1",1,"p-inputtext-sm",3,"ngModelChange","onFocus","onBlur","onKeyDown","ngModel","maxFractionDigits","minFractionDigits","autofocus"],["styleClass","input-align-center","step","0.1",1,"p-inputtext-sm",3,"ngModelChange","onFocus","onBlur","onKeyDown","ngModel","maxFractionDigits","min","max","autofocus"],["styleClass","input-align-center","step","0.1",1,"p-inputtext-sm",3,"ngModelChange","onFocus","onKeyDown","ngModel","maxFractionDigits","min","max","autofocus"],["size","small","label","66%",3,"onClick"],["size","small","label","33%","styleClass","mx-2",3,"onClick"],["icon","pi pi-print","severity","contrast","size","small",1,"mr-6",3,"onClick","label"],["icon","pi pi-times","styleClass","mr-2 p-confirm-dialog-reject","severity","danger","size","small",3,"onClick","label"],["styleClass","p-confirm-dialog-accept","icon","pi pi-check","severity","success","size","small",3,"onClick","label"]],template:function(i,t){if(i&1){let n=b();s(0,"p-card",9)(1,"div",10)(2,"h2",11),p(3,"currency"),p(4,"exchangedLira"),h(5),p(6,"currency"),p(7,"exchangedLira"),a(),s(8,"h2",12),p(9,"dollar"),p(10,"lira"),h(11),p(12,"lira"),p(13,"lira"),a()(),E(14,"p-divider"),y(15,ri,19,24,"div",13),s(16,"p-table",14,0),y(18,li,12,16,"ng-template",15)(19,pi,21,22,"ng-template",16)(20,_i,22,29,"ng-template",17)(21,fi,1,1,"ng-template",18)(22,vi,4,3,"ng-template",19),a(),s(23,"div",20)(24,"div",21)(25,"p-button",22),p(26,"translate"),v("onClick",function(){return d(n),m(t.clearInvoice())}),a()(),y(27,hi,3,4,"div",23),s(28,"div",24)(29,"p-button",25),p(30,"translate"),v("onClick",function(){return d(n),m(t.checkout())}),a()()(),y(31,Ci,3,3,"small",26),a(),s(32,"p-overlayPanel",27,1),v("onShow",function(){return d(n),m(t.editModeEnabled=!0)})("onHide",function(){return d(n),m(t.editModeEnabled=!1)}),s(34,"div",28)(35,"div",29)(36,"label"),h(37),p(38,"translate"),a(),y(39,yi,1,4,"p-inputNumber",30)(40,bi,1,4,"p-inputNumber",30)(41,xi,1,4,"p-inputNumber",31)(42,wi,1,5,"p-inputNumber",32)(43,Si,1,5,"p-inputNumber",33),s(44,"p-button",34),v("onClick",function(){d(n);let g=V(33);return m(t.applyEdit(g))}),a()(),y(45,Ii,1,0,"p-button",35)(46,Ti,1,0,"p-button",36),a()(),s(47,"customer-dialog",37),T("visibleChange",function(g){return d(n),I(t.customerDialogVisible,g)||(t.customerDialogVisible=g),m(g)}),v("onCreate",function(g){return d(n),m(t.newCustomerCreated(g))}),a(),s(48,"products-dialog",38),v("onHide",function(){return d(n),m(t.productsDialogVisible=!1)})("onSubmit",function(g){return d(n),m(t.assignSelectedProducts(g))}),a(),s(49,"product-form",39),T("visibleChange",function(g){return d(n),I(t.productDialogVisible,g)||(t.productDialogVisible=g),m(g)}),v("onCreate",function(g){return d(n),m(t.onCreateProduct(g))}),a(),s(50,"print-dialog",40),T("visibleChange",function(g){return d(n),I(t.printDialogVisible,g)||(t.printDialogVisible=g),m(g)}),a(),s(51,"p-confirmDialog",41,2),y(53,Vi,6,9,"ng-template",42),a(),E(54,"p-confirmDialog",43,2)}i&2&&(r(2),c("pTooltip",t.userPermissions().show_cost?t.defaultCurrency()==="dollar"?u(3,38,t.invoice.total_cost).toString():u(4,40,t.invoice.total_cost).toString():""),r(3),w(" USD: ",t.defaultCurrency()==="dollar"?u(6,42,t.invoice.total_amount):u(7,44,t.invoice.total_amount)," "),r(3),c("pTooltip",t.userPermissions().show_cost?t.defaultCurrency()==="dollar"?u(9,46,t.invoice.total_cost).toString():u(10,48,t.invoice.total_cost).toString():""),r(3),w(" ",t.defaultCurrency()==="dollar"?u(12,50,t.invoice.total_lbp):u(13,52,t.invoice.total_amount)," "),r(4),c("ngIf",t.customersFeaturesEnabled()),r(),ye("scrollHeight",t.vh()),c("value",t.invoice.items)("scrollable",!0),r(8),c("ngClass",t.priceQuoteEnabled()?"col-3":"col-6"),r(),c("label",u(26,54,"Clear")),r(2),c("ngIf",t.priceQuoteEnabled()),r(2),c("label",u(30,56,"Checkout"))("loading",t.checkoutLoading)("disabled",t.invoice.items.length==0),r(2),c("ngIf",t.thermalPrinterEnabled()),r(),c("dismissable",!0),r(5),w("",u(38,58,t.editingField),": "),r(2),c("ngIf",t.editingField==="price"),r(),c("ngIf",t.editingField==="total"),r(),c("ngIf",t.editingField==="quantity"),r(),c("ngIf",t.editingField==="discount"&&t.defaultDiscountType()==="normal"),r(),c("ngIf",t.editingField==="discount"&&t.defaultDiscountType()==="on-profit"),r(2),c("ngIf",t.editingField==="discount"&&t.defaultDiscountType()==="on-profit"),r(),c("ngIf",t.editingField==="discount"&&t.defaultDiscountType()==="on-profit"),r(),S("visible",t.customerDialogVisible),c("mode","add"),r(),c("visible",t.productsDialogVisible)("products",t.products)("tableLoading",t.stockTableLoading()),r(),S("visible",t.productDialogVisible),r(),S("visible",t.printDialogVisible),c("invoice",t.dataToPrint),r(),he(W(60,Pt)),c("breakpoints",W(61,Mt)),r(3),he(W(62,Pt)),c("breakpoints",W(63,Mt)))},dependencies:[N,G,A,$,j,Q,Oe,Ye,Ze,z,ne,Ae,te,ie,He,K,R,Ge,Je,je,Qe,gt,tt,et,ae,re,ge,lt,st,ft,ct,ut,pt,$e,Xe,mt,dt,ht,Ct,ce,be,bt,le,it,fe],styles:["[_nghost-%COMP%]  .p-card-body{padding:.8rem!important;padding-top:.3!important}[_nghost-%COMP%]  .p-card-content{padding:0!important}[_nghost-%COMP%]  .p-datatable{font-size:.9rem!important}[_nghost-%COMP%]  .p-datatable-header{padding-bottom:0!important}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.9rem;text-align:center}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;border:none}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;border-bottom:1px solid #dee2e6}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-top:1px solid #dee2e6}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.editable-cell[_ngcontent-%COMP%]{cursor:pointer;background-color:#f8f9fa}.editable[_ngcontent-%COMP%]{cursor:pointer;background-color:#e6e6e6}.editable[_ngcontent-%COMP%]:hover{background-color:#bebebe}[_nghost-%COMP%]  .p-button{padding:.6rem 1.09375rem!important}[_nghost-%COMP%]  .p-button.p-button-sm{font-size:.875rem!important;padding:.65625rem 1.09375rem!important}"]})}}return o})();var Bt=(()=>{class o{transform(e){return e.filter(i=>i.show_on_sell==1)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275pipe=Te({name:"category",type:o,pure:!0,standalone:!0})}}return o})();var Pi=o=>({selected:o});function Mi(o,f){o&1&&E(0,"p-progressSpinner")}function Bi(o,f){if(o&1){let e=b();s(0,"div",10)(1,"div",11),v("click",function(){let t=d(e).$implicit,n=l(3);return m(n.selectCategory(t))}),s(2,"p",12),h(3),a()()()}if(o&2){let e=f.$implicit,i=l(3);r(),c("ngClass",J(2,Pi,i.selectedCategory()==e)),r(2),w(" ",e.category_name," ")}}function ki(o,f){if(o&1&&(ke(0),y(1,Bi,4,4,"div",9),p(2,"category"),Ee()),o&2){let e=l(2);r(),c("ngForOf",u(2,1,e.categories()))}}function Ei(o,f){if(o&1&&y(0,ki,3,3,"ng-container",8),o&2){let e=l();c("ngIf",!e.selectedCategory())}}function Di(o,f){o&1&&E(0,"p-progressSpinner")}function Fi(o,f){if(o&1){let e=b();s(0,"div",16)(1,"div",17),p(2,"currency"),p(3,"lira"),v("click",function(){let t=d(e).$implicit,n=l(2);return m(n.selectProduct(t))}),s(4,"p",18),h(5),a()()()}if(o&2){let e=f.$implicit;r(),c("pTooltip",e.currency==="dollar"?u(2,3,e.unit_price_usd).toString():u(3,5,e.unit_price_usd).toString()),r(3),c("autoDir",e.product_name),r(),w(" ",e.product_name," ")}}function Ni(o,f){if(o&1){let e=b();s(0,"p-messages",19),T("valueChange",function(t){d(e);let n=l(2);return I(n.message,t)||(n.message=t),m(t)}),a()}if(o&2){let e=l(2);S("value",e.message),c("closable",!1)}}function Li(o,f){if(o&1&&(s(0,"div",13),y(1,Fi,6,7,"div",14),a(),y(2,Ni,1,2,"p-messages",15)),o&2){let e,i=l();r(),c("ngForOf",i.visibleProducts()),r(),c("ngIf",i.visibleProducts().length===0&&((e=i.selectedCategory())==null?null:e.category_id))}}var kt=(()=>{class o{constructor(){this.stockService=C(se),this.invoiceService=C(L),this.translate=C(H),this.productSelected=new Pe,this.fieldsetCollapsed=this.invoiceService.fieldsetCollapsed,this.categories=this.stockService.categories,this.selectedCategory=this.stockService.selectedCategorySell,this.products=this.stockService.products,this.showZeroItems=this.invoiceService.showZeroItems,this.visibleProducts=Ne(()=>{let e=this.products(),i=this.selectedCategory(),t=this.showZeroItems();return i?e.filter(n=>{let _=!i||n.category_id_fk===i.category_id,g=!n.is_hidden,P=n.quantity>0||!n.stock_management;return _&&g&&(t||P)}):[]}),this.categoriesLoading=this.stockService.categoriesLoading,this.sellProductsLoading=this.stockService.sellProductsLoading}toggleCollapse(e){this.fieldsetCollapsed.set(e)}ngOnInit(){this.message=[{severity:"info",detail:this.translate.instant("No items in this category yet")}],this.messages=[{severity:"info",detail:"No Invoice Yet!"}]}updateZeroItemsState(){this.invoiceService.updateZeroItemsState()}selectCategory(e){this.stockService.selectedCategorySell()==e?this.stockService.selectedCategorySell.set(null):this.stockService.selectedCategorySell.set(e)}selectProduct(e){this.productSelected.emit(e)}setBack(){this.selectedCategory.set(null)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=D({type:o,selectors:[["categories-pos"]],outputs:{productSelected:"productSelected"},standalone:!0,features:[F],decls:17,vars:11,consts:[[1,"grid"],[1,"col-4"],["severity","contrast","icon","pi pi-chevron-left",3,"onClick","label","disabled"],[1,"col-4","flex","align-items-center","justify-content-center"],[1,"m-0"],[1,"col-4","flex","align-items-center","justify-content-end"],[1,"m-0","p-2"],["id","showOnSell",3,"ngModelChange","ngModel"],[4,"ngIf"],["class","col-3 p-1",4,"ngFor","ngForOf"],[1,"col-3","p-1"],[1,"dark-hover","p-2","border-round","shadow-2","maxHeight","flex","align-items-center","justify-content-center",3,"click","ngClass"],[1,"m-0","text-center","p-1"],[1,"grid","pt-2"],["class","col-3 p-1 z-1s",4,"ngFor","ngForOf"],[3,"value","closable","valueChange",4,"ngIf"],[1,"col-3","p-1","z-1s"],["tooltipPosition","top",1,"bg-gray","shadow-3","p-2","border-round","maxHeight","flex","align-items-center","justify-content-center",3,"click","pTooltip"],[1,"m-0","text-center","p-1","font-bold",3,"autoDir"],[3,"valueChange","value","closable"]],template:function(i,t){if(i&1&&(s(0,"p-card")(1,"div",0)(2,"div",1)(3,"p-button",2),p(4,"translate"),v("onClick",function(){return t.setBack()}),a()(),s(5,"div",3)(6,"h2",4),h(7),a()(),s(8,"div",5)(9,"p",6),h(10),p(11,"translate"),a(),s(12,"p-inputSwitch",7),T("ngModelChange",function(_){return I(t.showZeroItems,_)||(t.showZeroItems=_),_}),v("ngModelChange",function(){return t.updateZeroItemsState()}),a()(),y(13,Mi,1,0,"p-progressSpinner")(14,Ei,1,1,"ng-container"),a(),y(15,Di,1,0,"p-progressSpinner")(16,Li,3,2),a()),i&2){let n;r(3),c("label",u(4,7,"Back"))("disabled",!t.selectedCategory()),r(4),w(" ",(n=t.selectedCategory())==null?null:n.category_name," "),r(3),x(u(11,9,"Show Zero Items ?")),r(2),S("ngModel",t.showZeroItems),r(),Ce(t.categoriesLoading()?13:14),r(2),Ce(t.sellProductsLoading()?15:16)}},dependencies:[N,G,X,A,$,ge,at,rt,j,Q,Ke,Re,le,St,wt,ne,te,ie,z,Bt,ae,re,ot,ce,K,R,fe],styles:[".category-cards[_ngcontent-%COMP%]{border-radius:6px;color:#343a40;text-align:center;padding:.8rem;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f}.selected[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}[_nghost-%COMP%]  .p-card-body{padding:.8rem!important}[_nghost-%COMP%]  .maxHeight{height:100%!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important}[_nghost-%COMP%]  .p-fieldset-content{padding:0!important}"]})}}return o})();function Oi(o,f){if(o&1&&E(0,"invoice-table",4),o&2){let e=l();c("invoice",e.invoiceService.activeInvoice)}}var Ko=(()=>{class o{constructor(){this.invoiceService=C(L)}onProductSelection(e){this.invoiceTableComponent.addProductToInvoice(e)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=D({type:o,selectors:[["invoice-home"]],viewQuery:function(i,t){if(i&1&&M(we,5),i&2){let n;B(n=k())&&(t.invoiceTableComponent=n.first)}},standalone:!0,features:[F],decls:6,vars:1,consts:[[1,"grid","m-1"],[1,"col-6"],[3,"invoice",4,"ngIf"],[3,"productSelected"],[3,"invoice"]],template:function(i,t){i&1&&(s(0,"div",0)(1,"div",1),E(2,"invoice-tabs"),y(3,Oi,1,1,"invoice-table",2),a(),s(4,"div",1)(5,"categories-pos",3),v("productSelected",function(_){return t.onProductSelection(_)}),a()()()),i&2&&(r(3),c("ngIf",t.invoiceService.activeInvoice))},dependencies:[N,A,Vt,kt,we]})}}return o})();export{Ko as InvoiceHomeComponent};
