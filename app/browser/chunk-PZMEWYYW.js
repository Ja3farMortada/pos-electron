import{a as De}from"./chunk-QLTNVVXU.js";import{a as me}from"./chunk-7CR6E6US.js";import{a as xe,b as we}from"./chunk-7QYRFDGN.js";import{a as ve}from"./chunk-UVEVFGTS.js";import{d as be,f as Ce}from"./chunk-QJMHFOYW.js";import{c as Se}from"./chunk-G5UOHYUM.js";import{i as de,j as he,l as fe,m as _e,p as ye,q as ge}from"./chunk-LBGQA5HW.js";import{b as se,c as pe}from"./chunk-VVKQAEX7.js";import{B as w,Ba as D,C as m,Ca as B,D as L,Da as P,Fa as c,Ga as h,J as j,Ja as M,Jb as G,K as y,Ka as $,L as g,La as R,Na as z,Oa as k,P as v,Qc as ce,Rc as ue,Sb as H,Vb as I,Wb as E,Xa as s,Y as l,Ya as p,Yb as W,_b as b,ac as Y,bc as J,d as T,da as q,ga as S,gc as K,hc as X,ia as r,ib as Q,ic as Z,jc as ee,kc as te,la as A,lc as ie,mc as ne,nb as U,oa as o,pa as a,pb as O,qa as f,r as F,ua as C,va as _,wa as u,wc as ae,xc as oe,y as N,yc as le,zc as re}from"./chunk-DSVZHE42.js";var Be=(()=>{class i{constructor(e,t,n){this.http=e,this.api=t,this.notificationService=n,this.signal_loading=q(!1),this.visible$=new T(!1),this.status_action$=new T({}),this.cashBalanceService=m(me)}deletePayment(e){this.signal_loading.set(!0),this.http.delete(`${this.api.host()}/payment/${e}`).subscribe({next:t=>{this.notificationService.showSuccess("Payment deleted successfully","home")},error:t=>{this.signal_loading.set(!1),this.notificationService.showError(t.error,"home")},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.status_action$.next({action:"DELETE"}),this.cashBalanceService.getBalance()}})}submitSupplierPayment(e){this.signal_loading.set(!0),this.http.post(`${this.api.host()}/payment/supplier`,e).subscribe({next:t=>{this.notificationService.showSuccess("Payment submitted successfully","home")},error:t=>{this.signal_loading.set(!1),this.notificationService.showError(t.error,"home")},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.status_action$.next({action:"ADD"}),this.cashBalanceService.getBalance()}})}submitSupplierEditPayment(e){this.signal_loading.set(!0),this.http.put(`${this.api.host()}/payment/supplier`,e).subscribe({next:t=>{this.notificationService.showSuccess("Payment edited successfully","home")},error:t=>{this.signal_loading.set(!1),this.notificationService.showError(t.error,"home")},complete:()=>{this.signal_loading.set(!1),this.visible$.next(!1),this.status_action$.next({action:"UPDATE"}),this.cashBalanceService.getBalance()}})}static{this.\u0275fac=function(t){return new(t||i)(w(O),w(E),w(I))}}static{this.\u0275prov=N({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var Ie=["amountInput"],Ee=["supplierDropdown"],Ve=["paymentDateCalendar"],Te=()=>({width:"75vw"}),Fe=()=>({"1199px":"85vw","575px":"95vw"});function ke(i,x){i&1&&(o(0,"div",24)(1,"div",25)(2,"label",26),c(3),s(4,"translate"),a(),f(5,"br")(6,"p-inputSwitch",27),a()()),i&2&&(l(3),h(p(4,1,"Modify Cash")))}function Ne(i,x){if(i&1){let e=C();o(0,"p-button",28),s(1,"translate"),_("onClick",function(){y(e);let n=u(2);return g(n.submitAllBalance())}),a()}i&2&&r("label",p(1,1,"Submit All Balance"))}function Le(i,x){if(i&1){let e=C();o(0,"form",7),_("ngSubmit",function(){y(e);let n=u();return g(n.submitPayment())}),o(1,"div",8)(2,"div",9)(3,"div",10)(4,"label",11),c(5),s(6,"translate"),o(7,"span",12),c(8," *"),a()(),f(9,"p-dropdown",13,0),s(11,"translate"),a()(),o(12,"div",14)(13,"label",15),c(14),s(15,"translate"),o(16,"span",12),c(17," *"),a()(),f(18,"p-calendar",16,1),s(20,"translate"),a(),S(21,ke,7,3,"div",17),o(22,"div",14)(23,"div",10)(24,"label",18),c(25),s(26,"translate"),o(27,"span",12),c(28," *"),a()(),f(29,"p-inputNumber",19,2),S(31,Ne,2,3,"p-button",20),a()(),o(32,"div",9)(33,"label"),c(34),s(35,"translate"),a(),f(36,"p-inputNumber",21,3),o(38,"small"),c(39),s(40,"translate"),a()(),o(41,"div",22)(42,"label"),c(43),s(44,"translate"),a(),f(45,"input",23),a()()()}if(i&2){let e=u();r("formGroup",e.paymentForm),l(5),h(p(6,25,"Supplier")),l(4),r("options",e.suppliers())("placeholder",p(11,27,"Select Supplier"))("required",!0)("filter",!0)("showClear",!0),l(5),h(p(15,29,"Payment Date")),l(4),r("showIcon",!1)("showClear",!1)("readonlyInput",!0)("placeholder",p(20,31,"Date"))("showTime",!0)("showSeconds",!0),l(3),r("ngIf",e.mode==="add"),l(4),h(p(26,33,"Amount")),l(4),r("required",!0)("autofocus",e.account_id),l(2),r("ngIf",e.mode==="add"),l(3),h(p(35,35,"LBP amount")),l(2),r("required",!0)("step",1e3)("min",0),l(3),h(p(40,37,"LBP payments are reference only, payments are always submitted in USD")),l(4),h(p(44,39,"Notes"))}}function je(i,x){if(i&1){let e=C();o(0,"p-button",32),s(1,"translate"),_("onClick",function(){y(e);let n=u(2);return g(n.deletePayment())}),a()}if(i&2){let e=u(2);r("label",p(1,2,"Delete"))("disabled",e.submitLoading)}}function qe(i,x){if(i&1){let e=C();S(0,je,2,4,"p-button",29),o(1,"p-button",30),s(2,"translate"),_("onClick",function(){y(e);let n=u();return g(n.closeDialog())}),a(),o(3,"p-button",31),s(4,"translate"),_("onClick",function(){y(e);let n=u();return g(n.submitPayment())}),a()}if(i&2){let e=u();r("ngIf",e.mode==="edit"),l(),r("label",p(2,5,"Cancel"))("disabled",e.submitLoading),l(2),r("label",p(4,7,"Submit"))("loading",e.submitLoading)}}var Pt=(()=>{class i{constructor(){this.suppliersService=m(De),this.paymentService=m(Be),this.confirmationService=m(G),this.dateService=m(Se),this.stockService=m(be),this.dollarPipe=m(Ce),this.translate=m(se),this.fb=m(te),this.apiService=m(E),this.notification=m(I),this.visible=!1,this.mode="add",this.account_id=null,this.visibleChange=new v,this.onCreate=new v,this.onUpdate=new v,this.onDelete=new v,this.exchangeRate=this.stockService.exchangeRate,this.suppliers=this.suppliersService.suppliers,this.paymentForm=this.fb.group({journal_id:[null],account_id:[null,b.required],payment_date:[null,b.required],amount:[null,[b.required,b.min(.01)]],lbpAmount:[null,b.required],modify_cash:[!0],journal_notes:[null],exchange_rate:[this.exchangeRate().rate_value]}),this.submitLoading=!1,this.supplier_balance_loading=this.suppliersService.signal_balanceLoading,this.supplier_balance=this.suppliersService.supplierTotalDebts$}get f(){return this.paymentForm.controls}ngOnChanges(e){e.visible&&this.visible&&(this.setupValueChanges(),this.mode=="edit"?this.paymentForm.patchValue(this.payment):(this.paymentForm.reset({account_id:this.account_id,payment_date:this.dateService.getFullDatetime(),modify_cash:!0,exchange_rate:this.exchangeRate().rate_value}),this.getSupplierBalance()))}closeDialog(){this.submitLoading=!1,this.visibleChange.emit(!1)}submitAllBalance(){this.paymentForm.patchValue({amount:this.supplier_balance().balance})}setupValueChanges(){this.paymentForm.get("amount")?.valueChanges.subscribe(e=>{if(e!==null){let t=this.dollarPipe.calculate(e);this.paymentForm.get("lbpAmount")?.setValue(t,{emitEvent:!1})}}),this.paymentForm.get("lbpAmount")?.valueChanges.subscribe(e=>{if(e!==null){let t=e/this.exchangeRate().rate_value;this.paymentForm.get("amount")?.setValue(t,{emitEvent:!1})}})}submitPayment(){if(this.paymentForm.valid){let e=this.paymentForm.getRawValue();this.submitLoading=!0,(this.mode=="add"?this.apiService.post("payment/supplier",e):this.apiService.put("payment/supplier",e)).pipe(F(()=>{this.submitLoading=!1})).subscribe({next:n=>{this.mode=="add"?this.onCreate.emit(n):this.onUpdate.emit(n),this.closeDialog(),this.notification.showSuccess()}})}else!this.f.amount.value||this.f.amount.value>0?this.amountInput.el.nativeElement.children[0].children[0].focus():this.f.account_id.value?this.paymentDateCalendar.inputfieldViewChild.nativeElement.focus():this.supplierDropdown.applyFocus()}deletePayment(){this.confirmationService.confirm({key:"home",message:this.translate.instant("Are you sure you want to continue ?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.submitLoading=!0,this.apiService.delete(`payment/${this.payment.journal_id}`).pipe(F(()=>{this.submitLoading=!1})).subscribe({next:()=>{this.notification.showSuccess(),this.onDelete.emit(this.payment)}})}})}getSupplierBalance(){this.f.account_id.value?this.suppliersService.getAccountTotalBalance(this.f.account_id.value):this.supplier_balance.set({id:0,balance:"0"})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=L({type:i,selectors:[["supplier-payment-dialog"]],viewQuery:function(t,n){if(t&1&&(D(Ie,5),D(Ee,5),D(Ve,5)),t&2){let d;B(d=P())&&(n.amountInput=d.first),B(d=P())&&(n.supplierDropdown=d.first),B(d=P())&&(n.paymentDateCalendar=d.first)}},inputs:{visible:"visible",mode:"mode",account_id:"account_id",payment:"payment"},outputs:{visibleChange:"visibleChange",onCreate:"onCreate",onUpdate:"onUpdate",onDelete:"onDelete"},standalone:!0,features:[j,z],decls:4,vars:13,consts:[["supplierDropdown",""],["paymentDateCalendar",""],["amountInput",""],["liraInput",""],["position","top","styleClass","p-fluid",3,"visibleChange","onHide","header","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[3,"ngSubmit","formGroup"],[1,"formgrid","grid"],[1,"field","col-12","md:col-3"],[1,"flex","flex-column","gap-2"],["for","supplier"],[1,"text-red-500"],["styleClass","p-inputtext-sm","id","supplier","formControlName","account_id","appendTo","body","optionLabel","name","optionValue","account_id","filterBy","name",3,"options","placeholder","required","filter","showClear"],[1,"field","col-12","md:col-2"],["for","payment_date"],["formControlName","payment_date","styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd",3,"showIcon","showClear","readonlyInput","placeholder","showTime","showSeconds"],["class","col-12 md:col-2 flex justify-content-center",4,"ngIf"],["for","amount"],["styleClass","input-align-center","formControlName","amount","mode","currency","currency","USD","locale","en-US","step","0","autoSelect","",1,"p-inputtext-sm",3,"required","autofocus"],["size","small","severity","contrast",3,"label","onClick",4,"ngIf"],["styleClass","input-align-center","formControlName","lbpAmount","mode","currency","currency","LBP","locale","en-LB","autoSelect","",1,"p-inputtext-sm",3,"required","step","min"],[1,"field","col-12","md:col-5"],["type","text","pInputText","","spellcheck","false","formControlName","journal_notes"],[1,"col-12","md:col-2","flex","justify-content-center"],[1,"field"],["for","modifyCash"],["formControlName","modify_cash","styleClass","mt-1"],["size","small","severity","contrast",3,"onClick","label"],["icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"label","disabled","onClick",4,"ngIf"],["icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","disabled"],["icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2","size","small",3,"onClick","label","loading"],["icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0","size","small",3,"onClick","label","disabled"]],template:function(t,n){t&1&&(o(0,"p-dialog",4),s(1,"translate"),R("visibleChange",function(V){return $(n.visible,V)||(n.visible=V),V}),_("onHide",function(){return n.closeDialog()}),S(2,Le,46,41,"ng-template",5)(3,qe,5,9,"ng-template",6),a()),t&2&&(A(k(11,Te)),r("header",p(1,9,"Payment"))("modal",!0),M("visible",n.visible),r("breakpoints",k(12,Fe))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[ue,ce,H,oe,ae,re,le,_e,fe,he,de,U,Q,ie,K,W,Y,J,ee,ne,X,Z,ge,ye,pe,we,xe,ve]})}}return i})();export{Pt as a};
