import{a as _}from"./chunk-GUPSDBPB.js";import{a as y}from"./chunk-ZOJPJJYV.js";import{e as v,f as w}from"./chunk-QJMHFOYW.js";import{c as S}from"./chunk-G5UOHYUM.js";import{a as g,b as f}from"./chunk-4A2WLUYH.js";import{C as r,Vb as h,Wb as l,d as m,da as c,pb as p,v as d,y as a,yb as u}from"./chunk-DSVZHE42.js";import{g as n}from"./chunk-GAL4ENT6.js";var A=(()=>{class o{constructor(){this.notificationService=r(h),this.http=r(p),this.tokenStorage=r(g),this.router=r(u),this.api=r(l),this.userService=r(f),this.host=this.api.host,this.isLoggedIn=c(this.tokenStorage.getToken()!==null),this.isAdmin=c(this.tokenStorage.getType()==="admin"),this.userPermissions=c(this.tokenStorage.getPermissions())}login(t){return this.http.post(`${this.host()}/auth/login`,{username:t.username,password:t.password}).pipe(d(e=>{this.tokenStorage.saveUser(e.username),this.tokenStorage.saveType(e.user_type),this.tokenStorage.saveToken(e.token),this.tokenStorage.saveName(e.first_name),this.tokenStorage.saveSocketId(e.socket_id),this.tokenStorage.savePermissions(e.permissions),this.userService.loggedInUser.set(e.username),this.userService.loggedInName.set(e.first_name),this.userService.userType.set(e.user_type),this.userService.socketId.set(e.socket_id),this.isLoggedIn.set(!0),this.isAdmin.set(e.user_type==="admin"),this.userPermissions.set(e.permissions),this.router.navigate(["/home"])}))}logout(){this.userService.resetUser(),window.sessionStorage.clear(),this.isLoggedIn.set(!1),this.isAdmin.set(!1),this.userPermissions.set(null),this.router.navigate(["/login"])}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var J=(()=>{class o{constructor(){this.dateService=r(S),this.http=r(p),this.api=r(l),this.notificationService=r(h),this.settingsService=r(_),this.decimalService=r(v),this.discountService=r(y),this.dollarPipe=r(w),this.invoice=new m({}),this.printPageSettings=this.settingsService.printPageSettings,this.printerSettings=this.settingsService.printerSettings}print(t){return n(this,null,function*(){let e=structuredClone(t);e.order_datetime=this.dateService.formatDate(t.order_datetime,"dd-MM-yyyy"),e.settings=this.printPageSettings(),window.electron&&(yield window.electron.send("print-invoice",e))})}thermalPrint(t,e){return n(this,null,function*(){let i=structuredClone(t);i.order_datetime=this.dateService.formatDate(t.order_datetime,"dd-MM-yyyy"),i.type=e,i.settings=this.printPageSettings(),i.print_currency=this.printerSettings().print_currency,i.exchange_rate=parseInt(i.exchange_rate),i.discount_enabled=!!this.discountService.discountInputEnabled(),i.double_print=this.printerSettings().double_print,this.printerSettings().arabic_support?(i.printer=this.printerSettings().printer_name,window.electron&&(yield window.electron.send("thermal-print",i))):(i.printer=this.printerSettings().shared_name,i.print_currency==="usd"?i.currency==="lira"&&(i.total_amount=(i.total_amount/i.exchange_rate).toFixed(2),i.items.forEach(s=>{s.unit_price=(s.unit_price/i.exchange_rate).toFixed(2),s.total_price=(s.total_price/i.exchange_rate).toFixed(2)})):i.currency==="dollar"&&(i.total_amount=this.dollarPipe.calculate(i.total_amount),i.items.forEach(s=>{s.unit_price=this.dollarPipe.calculate(s.unit_price),s.total_price=this.dollarPipe.calculate(s.total_price)})),console.log(i),this.http.post(`${this.api.host()}/print/`,i).subscribe({next:s=>{console.log(s)},error:s=>{console.log(s)}}))})}labelPrint(t){return n(this,null,function*(){window.electron&&(yield window.electron.send("label-print",t))})}openCashDrawer(){return n(this,null,function*(){let t=this.printerSettings().shared_name;this.http.get(`${this.api.host()}/print/open-cash-drawer/${t}`).subscribe({next:e=>{console.log(e)},error:e=>{console.log(e)}})})}printReport(t){return n(this,null,function*(){t.sharedName=this.printerSettings().shared_name,this.api.post("print/print-report",t).subscribe()})}printStock(t){return n(this,null,function*(){window.electron&&(yield window.electron.send("print-stock",t))})}backup(){return n(this,null,function*(){if(window.electron){let t=yield window.electron.send("backup");t=="success"?this.notificationService.showSuccess("Backup completed successfully!","home"):t=="canceled"?this.notificationService.showInfo(t,"home"):(console.log(t),this.notificationService.showError(t,"home"))}})}exportExcel(t){return n(this,null,function*(){if(window.electron){let e=yield window.electron.send("export-excel",t);e.success?this.notificationService.showSuccess("Export completed successfully!","home"):this.notificationService.showError(e.message,"home")}})}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{A as a,J as b};
