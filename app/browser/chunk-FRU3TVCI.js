import{a as Ct,b as bt}from"./chunk-UAN5HDMQ.js";import{a as _t}from"./chunk-2GULRBUP.js";import{a as dt,b as ut}from"./chunk-VL5A4WUO.js";import{a as xt,b as wt}from"./chunk-SVHA7J7U.js";import"./chunk-TQK45RMZ.js";import{a as ct,b as pt}from"./chunk-I32A4TGG.js";import"./chunk-4ONBVWLA.js";import"./chunk-UIPYUTXU.js";import{c as ft}from"./chunk-MATK7LXP.js";import{a as vt}from"./chunk-FPREGWMZ.js";import"./chunk-ARZ4TFMZ.js";import{b as nt}from"./chunk-XGV4AIQT.js";import{a as ht,b as yt}from"./chunk-KUB5ILCP.js";import{a as it}from"./chunk-ZGTXP7CP.js";import{a as at,b as st,c as gt}from"./chunk-5CX5K5NM.js";import{a as mt}from"./chunk-Z3PNLGRC.js";import{a as je,b as He,c as Ke}from"./chunk-6CXWHLUJ.js";import{a as Ue}from"./chunk-WT6Y3HOA.js";import"./chunk-KICUZIBO.js";import{a as _e}from"./chunk-HV2OQ7WI.js";import{a as tt,b as le}from"./chunk-FA4OBAKY.js";import"./chunk-EA4RMISB.js";import{a as ve}from"./chunk-OY4T6UDA.js";import"./chunk-7ZNGIE4A.js";import{a as lt}from"./chunk-FO7TG3S7.js";import{b as ge}from"./chunk-42BTCZ3Y.js";import{a as ot,b as rt}from"./chunk-7QYRFDGN.js";import{a as qe,b as me}from"./chunk-FHUXGGRO.js";import{a as de}from"./chunk-7KO4RDVD.js";import{a as ce}from"./chunk-UJ5JDQTE.js";import{a as ue}from"./chunk-ZPRVI3IV.js";import"./chunk-UVEVFGTS.js";import"./chunk-P4HR6EQA.js";import{d as U,e as pe,f as be}from"./chunk-4PLGKOLD.js";import{a as ze,b as re}from"./chunk-AFTSMEUE.js";import{F as et,f as ae,g as se,i as Ze,j as Ye,l as Je,m as Ge,t as Xe,u as $e}from"./chunk-LBGQA5HW.js";import"./chunk-4A2WLUYH.js";import{b as K,c as z}from"./chunk-VVKQAEX7.js";import{a as Q,b as R}from"./chunk-FW7KDDDM.js";import{Ba as M,C,Ca as B,D,Da as k,Ea as V,Fa as h,G as Te,Ga as x,Ha as w,Ia as De,J as Ve,Ja as S,Jb as Le,K as p,Ka as I,L as d,La as T,Na as F,Oa as q,P as Pe,Pa as G,Qa as Fe,S as fe,Sb as Oe,Vb as te,Wb as We,X as Me,Xa as u,Y as r,Ya as m,Yb as Ae,ac as ie,da as J,db as Ne,fc as ne,ga as y,gb as X,hb as $,ia as c,ib as A,ka as Be,la as he,lc as oe,mb as ee,na as Ce,nb as N,oa as l,pa as s,qa as E,r as Se,ra as ke,sa as Ee,ua as b,va as f,wa as a,wc as j,xc as H,y as Ie,yc as Qe,za as ye,zc as Re}from"./chunk-DSVZHE42.js";import"./chunk-GAL4ENT6.js";var L=(()=>{class o{updateZeroItemsState(){this.localStorageService.setShowZeroItems(this.showZeroItems())}constructor(){this.customersFeaturesService=C(_e),this.discountprinterSettingsService=C(ue),this.notificationService=C(te),this.printerSettingsService=C(de),this.printService=C(me),this.localStorageService=C(ze),this.decimalService=C(pe),this.currencySetting=C(re),this.stockService=C(U),this.defaultCurrency=this.currencySetting.defaultCurrency,this.invoices=[],this.activeInvoiceId=null,this.nextId=1,this.fieldsetCollapsed=J(!1),this.defaultOperationType=this.customersFeaturesService.defaultOperationType,this.showZeroItems=J(this.localStorageService.getShowZeroItems()),this.customerDialogVisible=J(!1),this.openInvoice()}openInvoice(e=this.defaultOperationType()){let i={id:this.nextId++,operation_type:e,discount_value:0,total_cost:0,total_avg_cost:0,total_amount:0,total_lbp:0,payment_amount:0,journal_notes:null,total_qty:0,currency:this.defaultCurrency(),items:[],inventory_id:this.stockService.defaultInventory()};this.invoices.push(i),this.setActiveInvoice(i.id)}closeInvoice(e){if(this.invoices.length===1){this.clearInvoice(this.invoices[0]);return}if(this.invoices=this.invoices.filter(i=>i.id!==e),this.activeInvoiceId===e){let i=this.invoices[0];this.setActiveInvoice(i.id)}}clearInvoice(e){e.customer_id=void 0,e.total_amount=0,e.total_cost=0,e.total_avg_cost=0,e.total_lbp=0,e.total_qty=0,e.operation_type=this.defaultOperationType(),e.items=[]}setActiveInvoice(e){this.activeInvoiceId=e}get activeInvoice(){return this.invoices.find(e=>e.id===this.activeInvoiceId)}addItemToActiveInvoice(e){let i=this.activeInvoice;i&&(i.items.push(e),this.recalculateTotals(i))}recalculateTotals(e){let i=e.items.reduce((t,n)=>{let _=n.quantity||0,g=n.unit_price||0,P=n.unit_price_lbp||0,O=n.unit_cost||0,W=n.avg_cost||0;return t.total_amount=this.decimalService.add(t.total_amount,this.decimalService.multiply(g,_)),t.total_lbp=this.decimalService.add(t.total_lbp,this.decimalService.multiply(P,_)),t.total_cost=this.decimalService.add(t.total_cost,this.decimalService.multiply(O,_)),t.total_avg_cost=this.decimalService.add(t.total_avg_cost,this.decimalService.multiply(W,_)),t.total_qty=this.decimalService.add(t.total_qty,_),t},{total_amount:0,total_lbp:0,total_cost:0,total_avg_cost:0,total_qty:0});e.total_amount=i.total_amount,e.total_lbp=i.total_lbp,e.total_cost=i.total_cost,e.total_avg_cost=i.total_avg_cost,e.total_qty=i.total_qty}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275prov=Ie({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();function kt(o,v){if(o&1){let e=b();l(0,"p-button",3),u(1,"translate"),f("onClick",function(){let t=p(e).$implicit,n=a();return d(n.invoiceService.setActiveInvoice(t.id))}),s()}if(o&2){let e=v.$implicit,i=a();c("label",m(1,2,"invoice ")+e.id)("outlined",e.id!==i.invoiceService.activeInvoiceId)}}var Tt=(()=>{class o{constructor(){this.invoiceService=C(L),this.translate=C(K)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=D({type:o,selectors:[["invoice-tabs"]],standalone:!0,features:[F],decls:4,vars:5,consts:[["styleClass","mb-1"],["size","small","severity","primary","styleClass","mr-2",3,"label","outlined","onClick",4,"ngFor","ngForOf"],["size","small","icon","pi pi-plus","severity","success",3,"onClick","label","outlined"],["size","small","severity","primary","styleClass","mr-2",3,"onClick","label","outlined"]],template:function(i,t){i&1&&(l(0,"p-card",0),y(1,kt,2,4,"p-button",1),l(2,"p-button",2),u(3,"translate"),f("onClick",function(){return t.invoiceService.openInvoice()}),s()()),i&2&&(r(),c("ngForOf",t.invoiceService.invoices),r(),c("label",m(3,3,"New"))("outlined",!0))},dependencies:[N,$,H,j,R,Q,z],styles:["[_nghost-%COMP%]  .p-card-body{padding:.9rem!important}[_nghost-%COMP%]  .p-card-content{padding:0!important}"]})}}return o})();var Ft=["invoiceTable"],Nt=["productAutoComplete"],Lt=["barcodeInput"],Ot=["payment_input"],Wt=["lira_input"],qt=["notes_input"],At=["discount_input"],Qt=["confirmDialog"],Rt=["payment_amount"],Vt=()=>({width:"50vw"}),Pt=()=>({"1199px":"65vw","575px":"90vw"}),jt=()=>["name","phone"],Ht=o=>({"text-red-500":o}),Kt=(o,v)=>({"text-orange-500":o,"text-red-500":v});function zt(o,v){if(o&1&&(l(0,"div"),h(1),s(),l(2,"small"),h(3),s()),o&2){let e=v.$implicit;r(),x(e.name),r(2),x(e.phone)}}function Ut(o,v){if(o&1&&(l(0,"div"),h(1),s()),o&2){let e=a(3);r(),w(" ",e.selectedCustomer.name," ")}}function Zt(o,v){if(o&1&&(l(0,"small"),h(1),s()),o&2){let e=a(3);r(),x(e.selectedCustomer.phone)}}function Yt(o,v){if(o&1&&y(0,Ut,2,1,"div",27)(1,Zt,2,1,"small",27),o&2){let e=a(2);c("ngIf",e.selectedCustomer),r(),c("ngIf",e.selectedCustomer)}}function Jt(o,v){if(o&1){let e=b();l(0,"div",46)(1,"div",47)(2,"label",56),h(3),u(4,"translate"),s(),l(5,"p-dropdown",57),u(6,"translate"),u(7,"translate"),T("ngModelChange",function(t){p(e);let n=a(2);return I(n.invoice.operation_type,t)||(n.invoice.operation_type=t),d(t)}),f("onChange",function(){p(e);let t=a(2);return d(t.onOperationTypeChange())}),s()()()}if(o&2){let e=a(2);r(3),x(m(4,6,"Operation Type")),r(2),c("options",e.operationTypes),S("ngModel",e.invoice.operation_type),c("placeholder",m(6,8,"Operation Type"))("emptyMessage",m(7,10,"No results found"))("autoOptionFocus",!1)}}function Gt(o,v){if(o&1){let e=b();l(0,"div",46)(1,"div",47)(2,"label"),h(3),u(4,"translate"),s(),l(5,"p-inputNumber",58,4),f("onFocus",function(t){p(e);let n=a(2);return d(n.select(t.target))}),T("ngModelChange",function(t){p(e);let n=a(2);return I(n.paymentAmountUSD,t)||(n.paymentAmountUSD=t),d(t)}),f("ngModelChange",function(t){p(e);let n=a(2);return d(n.onUSDChange(t))}),s()()()}if(o&2){let e=a(2);r(3),x(m(4,6,"Payment")),r(2),c("currency",e.defaultCurrency()==="dollar"?"USD":"LBP")("locale",e.defaultCurrency()==="dollar"?"en-US":"en-LB")("step",1)("min",0),S("ngModel",e.paymentAmountUSD)}}function Xt(o,v){if(o&1){let e=b();l(0,"div",46)(1,"div",47)(2,"label"),h(3),u(4,"translate"),s(),l(5,"p-inputNumber",59,5),f("onFocus",function(t){p(e);let n=a(2);return d(n.select(t.target))}),T("ngModelChange",function(t){p(e);let n=a(2);return I(n.paymentAmountLBP,t)||(n.paymentAmountLBP=t),d(t)}),f("ngModelChange",function(t){p(e);let n=a(2);return d(n.onLBPChange(t))}),s()()()}if(o&2){let e=a(2);r(3),x(m(4,4,"LBP amount")),r(2),c("step",1e3)("min",0),S("ngModel",e.paymentAmountLBP)}}function $t(o,v){if(o&1){let e=b();l(0,"div")(1,"div",47)(2,"label",60),h(3),u(4,"translate"),s(),l(5,"input",61,6),T("ngModelChange",function(t){p(e);let n=a(2);return I(n.invoice.journal_notes,t)||(n.invoice.journal_notes=t),d(t)}),s()()()}if(o&2){let e=a(2);Be("col-8",!e.discountInputEnabled())("col-4",e.discountInputEnabled()),r(3),x(m(4,6,"Notes")),r(2),S("ngModel",e.invoice.journal_notes)}}function ei(o,v){if(o&1){let e=b();l(0,"div",46)(1,"div",47)(2,"label",62),h(3),u(4,"translate"),s(),l(5,"p-inputNumber",63,7),T("ngModelChange",function(t){p(e);let n=a(2);return I(n.invoice.discount_value,t)||(n.invoice.discount_value=t),d(t)}),f("onFocus",function(t){p(e);let n=a(2);return d(n.select(t.target))}),s()()()}if(o&2){let e=a(2);r(3),x(m(4,5,"Discount %")),r(2),S("ngModel",e.invoice.discount_value),c("maxFractionDigits",2)("min",0)("max",100)}}function ti(o,v){if(o&1&&(l(0,"div",64)(1,"table")(2,"thead")(3,"tr",65)(4,"th"),h(5),u(6,"translate"),s(),l(7,"th"),h(8),u(9,"translate"),s(),l(10,"th"),h(11),u(12,"translate"),s(),l(13,"th"),h(14),u(15,"translate"),s()()(),l(16,"tbody")(17,"tr",66)(18,"th")(19,"text-with-loading",67)(20,"span"),h(21),u(22,"currency"),u(23,"lira"),s()()(),l(24,"th"),h(25),u(26,"currency"),u(27,"lira"),s(),l(28,"th"),h(29),u(30,"currency"),u(31,"lira"),s(),l(32,"th")(33,"text-with-loading",68)(34,"span"),h(35),u(36,"currency"),u(37,"lira"),s()()()()()()()),o&2){let e=a(2);r(5),x(m(6,12,"Old Balance")),r(3),w(" ",m(9,14,"Current Invoice")," "),r(3),x(m(12,16,"Payment")),r(3),x(m(15,18,"New Balance")),r(5),c("isLoading",e.customer_balance_loading())("loadingBar",!0),r(2),x(e.defaultCurrency()==="dollar"?m(22,20,e.customer_balance().balance):m(23,22,e.customer_balance().balance)),r(4),w(" ",e.defaultCurrency()==="dollar"?m(26,24,e.invoice.total_amount):m(27,26,e.invoice.total_amount)," "),r(4),w(" ",e.defaultCurrency()==="dollar"?m(30,28,e.invoice.payment_amount||0):m(31,30,e.invoice.payment_amount||0)," "),r(4),c("isLoading",e.customer_balance_loading())("loadingBar",!0),r(2),x(e.defaultCurrency()==="dollar"?m(36,32,e.calculateNewBalance(e.customer_balance().balance,e.invoice.total_amount,e.invoice.payment_amount)):m(37,34,e.calculateNewBalance(e.customer_balance().balance,e.invoice.total_amount,e.invoice.payment_amount)))}}function ii(o,v){if(o&1){let e=b();l(0,"div",69)(1,"p-button",70),u(2,"translate"),f("onClick",function(){p(e);let t=a(2);return d(t.openCustomerDialog())}),s()()}o&2&&(r(),ye("label",m(2,1,"New Customer")))}function ni(o,v){if(o&1){let e=b();l(0,"div",45)(1,"div",46)(2,"div",47)(3,"label",48),h(4),u(5,"translate"),s(),l(6,"p-dropdown",49,3),u(8,"translate"),u(9,"translate"),f("onShow",function(){p(e);let t=a();return d(t.dropDownVisible=!0)})("onHide",function(){p(e);let t=a();return d(t.dropDownVisible=!1)})("onChange",function(t){p(e);let n=a();return d(n.onCustomerChange(t.value))}),y(10,zt,4,2,"ng-template",50)(11,Yt,2,2,"ng-template",51),s()()(),y(12,Jt,8,12,"div",52)(13,Gt,7,8,"div",52)(14,Xt,7,6,"div",52)(15,$t,7,8,"div",53)(16,ei,7,7,"div",52)(17,ti,38,36,"div",54)(18,ii,3,3,"div",55),s()}if(o&2){let e=a();r(4),x(m(5,17,"Customer")),r(2),c("loading",e.loadingCustomers())("placeholder",m(8,19,"Select Customer"))("emptyMessage",m(9,21,"No results found"))("filter",!0)("showClear",!0)("autoOptionFocus",!1)("filterFields",q(23,jt))("options",e.customers())("ngModel",e.selectedCustomer),r(6),c("ngIf",e.selectedCustomer),r(),c("ngIf",e.selectedCustomer&&e.invoice.operation_type=="debt"),r(),c("ngIf",e.selectedCustomer&&e.invoice.operation_type=="debt"&&e.defaultCurrency()==="dollar"),r(),c("ngIf",e.selectedCustomer&&e.invoice.operation_type=="debt"),r(),c("ngIf",e.discountInputEnabled()&&e.selectedCustomer),r(),c("ngIf",e.selectedCustomer&&e.invoice.operation_type==="debt"),r(),c("ngIf",!e.selectedCustomer)}}function oi(o,v){if(o&1&&(l(0,"div",77),h(1),s(),l(2,"small"),h(3),u(4,"currency"),u(5,"lira"),s()),o&2){let e=v.$implicit;c("autoDir",e.product_name),r(),w(" ",e.product_name," "),r(2),x(e.currency==="dollar"?m(4,3,e.unit_price_usd):m(5,5,e.unit_price_usd))}}function ri(o,v){if(o&1){let e=b();l(0,"div",78)(1,"p-dropdown",79),T("ngModelChange",function(t){p(e);let n=a(2);return I(n.selected_price_type,t)||(n.selected_price_type=t),d(t)}),f("onShow",function(){p(e);let t=a(2);return d(t.dropDownVisible=!0)})("onHide",function(){p(e);let t=a(2);return d(t.dropDownVisible=!1)}),s()()}if(o&2){let e=a(2);r(),c("options",e.stateOptions),S("ngModel",e.selected_price_type),c("showClear",!1)}}function ai(o,v){if(o&1){let e=b();l(0,"div",45)(1,"div",71)(2,"p-autoComplete",72,8),u(5,"translate"),u(6,"translate"),f("completeMethod",function(t){p(e);let n=a();return d(n.filterProducts(t))}),T("ngModelChange",function(t){p(e);let n=a();return I(n.productSearchText,t)||(n.productSearchText=t),d(t)}),f("onKeyUp",function(t){p(e);let n=a();return d(n.handleProductInputKeydown(t))}),y(7,oi,6,7,"ng-template",50),s()(),l(8,"div",71)(9,"p-dropdown",73,9),u(11,"translate"),u(12,"translate"),T("ngModelChange",function(t){p(e);let n=a();return I(n.defaultInventory,t)||(n.defaultInventory=t),d(t)}),f("ngModelChange",function(){p(e);let t=a();return d(t.refreshProducts())})("onShow",function(){p(e);let t=a();return d(t.dropDownVisible=!0)})("onHide",function(){p(e);let t=a();return d(t.dropDownVisible=!1)}),s()(),l(13,"div",71)(14,"p-button",74),f("onClick",function(){p(e);let t=a();return d(t.productsDialogVisible=!0)}),s(),l(15,"p-button",75),f("onClick",function(){p(e);let t=a();return d(t.productDialogVisible=!0)}),s()(),y(16,ri,2,3,"div",76),s()}if(o&2){let e=a();r(2),c("suggestions",e.filteredProducts)("dropdown",!1)("minLength",1)("showClear",!0),S("ngModel",e.productSearchText),c("placeholder",m(5,15,"scan or search"))("emptyMessage",m(6,17,"No results found"))("delay",0),r(7),c("autoOptionFocus",!1),S("ngModel",e.defaultInventory),c("options",e.inventories())("placeholder",m(11,19,"Select Inventory"))("emptyMessage",m(12,21,"No results found"))("filter",!0),r(7),c("ngIf",e.wholesaleEnabled())}}function si(o,v){o&1&&(l(0,"th"),h(1),u(2,"translate"),s()),o&2&&(r(),w(" ",m(2,1,"%")," "))}function li(o,v){if(o&1&&(l(0,"tr")(1,"th",80),h(2),u(3,"translate"),s(),l(4,"th",81),h(5),u(6,"translate"),s(),y(7,si,3,3,"th",27),l(8,"th",82),h(9),u(10,"translate"),s(),l(11,"th",83),u(12,"translate"),h(13),u(14,"translate"),s(),l(15,"th",81),h(16),u(17,"translate"),s(),l(18,"th",82),h(19),u(20,"translate"),s()()),o&2){let e=a();r(2),w(" ",m(3,8,"Description")," "),r(3),x(m(6,10,"Unit")),r(2),c("ngIf",e.discountInputEnabled()),r(2),x(m(10,12,"Qty")),r(2),c("pTooltip",m(12,14,"Remaining quantity")),r(2),w(" ",m(14,16,"Rem.")," "),r(3),x(m(17,18,"Total")),r(3),x(m(20,20,"Del"))}}function ci(o,v){if(o&1&&(l(0,"div")(1,"small"),h(2),u(3,"dollar"),u(4,"lira"),s()()),o&2){let e=a().$implicit;r(2),x(e.currency==="dollar"?m(3,1,e.unit_price):m(4,3,e.unit_price_lbp))}}function pi(o,v){if(o&1){let e=b();l(0,"td",87),f("click",function(t){p(e);let n=a().rowIndex,_=a(),g=V(33);return d(_.openEdit(g,t,n,"discount"))}),h(1),s()}if(o&2){let e=a().$implicit;r(),w(" ",e.discount_percentage,"% ")}}function di(o,v){if(o&1&&(l(0,"div")(1,"small"),h(2),u(3,"dollar"),u(4,"lira"),s()()),o&2){let e=a().$implicit;r(2),x(e.currency==="dollar"?m(3,1,e.unit_price*e.quantity):m(4,3,e.unit_price_lbp*e.quantity))}}function ui(o,v){if(o&1){let e=b();l(0,"tr")(1,"td",84),u(2,"currency"),u(3,"lira"),h(4),s(),l(5,"td",85),f("click",function(t){let n=p(e).rowIndex,_=a(),g=V(33);return d(_.openEdit(g,t,n,"price"))}),h(6),u(7,"currency"),u(8,"lira"),y(9,ci,5,5,"div",27),s(),y(10,pi,2,1,"td",86),l(11,"td",87),f("click",function(t){let n=p(e).rowIndex,_=a(),g=V(33);return d(_.openEdit(g,t,n,"quantity"))}),h(12),s(),l(13,"td",88),h(14),s(),l(15,"td",87),f("click",function(t){let n=p(e).rowIndex,_=a(),g=V(33);return d(_.openEdit(g,t,n,"total"))}),h(16),u(17,"currency"),u(18,"lira"),y(19,di,5,5,"div",27),s(),l(20,"td",89),f("click",function(){let t=p(e).rowIndex,n=a();return d(n.removeRow(t))}),E(21,"i",90),s()()}if(o&2){let e=v.$implicit,i=a();r(),c("pTooltip",i.userPermissions().show_cost?i.defaultCurrency()==="dollar"?m(2,12,e.unit_cost).toString():m(3,14,e.unit_cost).toString():"")("autoDir",e.product_name),r(3),w(" ",e.product_name," "),r(),c("ngClass",G(24,Ht,i.getPriceWarning(e))),r(),w(" ",i.defaultCurrency()==="dollar"?m(7,16,e.unit_price):m(8,18,e.unit_price)," "),r(3),c("ngIf",i.defaultCurrency()==="dollar"),r(),c("ngIf",i.discountInputEnabled()),r(2),w(" ",e.quantity," "),r(),c("ngClass",Fe(26,Kt,e.stock-e.quantity<=e.low_stock_threshold&&e.stock_management,e.stock-e.quantity<0&&e.stock_management)),r(),w(" ",e.stock_management?(e.stock-e.quantity).toFixed(2):"--"," "),r(2),w(" ",i.defaultCurrency()==="dollar"?m(17,20,e.unit_price*e.quantity):m(18,22,e.unit_price*e.quantity)," "),r(3),c("ngIf",i.defaultCurrency()==="dollar")}}function mi(o,v){if(o&1&&(l(0,"h4",92),h(1),u(2,"translate"),s()),o&2){let e=a(2);r(),De(" ",m(2,2,"Total units:")," ",e.invoice.total_qty," ")}}function _i(o,v){if(o&1&&y(0,mi,3,4,"h4",91),o&2){let e=a();c("ngIf",e.invoice.total_qty)}}function gi(o,v){o&1&&(l(0,"tr",93)(1,"td",94),h(2),u(3,"translate"),s()()),o&2&&(r(2),w(" ",m(3,1,"No data yet!")," "))}function vi(o,v){if(o&1){let e=b();l(0,"div",71)(1,"p-button",95),u(2,"translate"),f("onClick",function(){p(e);let t=a();return d(t.openPrintDialog())}),s()()}if(o&2){let e=a();r(),c("label",m(2,2,"Print Quote"))("disabled",e.invoice.items.length==0)}}function fi(o,v){o&1&&(l(0,"small"),h(1),u(2,"translate"),s()),o&2&&(r(),w(" ",m(2,1,"Note: Press `Space` to print last invoice")," "))}function hi(o,v){if(o&1){let e=b();l(0,"p-inputNumber",96),T("ngModelChange",function(t){p(e);let n=a();return I(n.editingValue,t)||(n.editingValue=t),d(t)}),f("onFocus",function(t){p(e);let n=a();return d(n.select(t.target))})("onBlur",function(){p(e);let t=a(),n=V(33);return d(t.applyEdit(n))})("onKeyDown",function(t){p(e);let n=a(),_=V(33);return d(n.submitEdit(t,_))}),s()}if(o&2){let e=a();S("ngModel",e.editingValue),c("maxFractionDigits",2)("min",0)("autofocus",!0)}}function Ci(o,v){if(o&1){let e=b();l(0,"p-inputNumber",96),T("ngModelChange",function(t){p(e);let n=a();return I(n.editingValue,t)||(n.editingValue=t),d(t)}),f("onFocus",function(t){p(e);let n=a();return d(n.select(t.target))})("onBlur",function(){p(e);let t=a(),n=V(33);return d(t.applyEdit(n))})("onKeyDown",function(t){p(e);let n=a(),_=V(33);return d(n.submitEdit(t,_))}),s()}if(o&2){let e=a();S("ngModel",e.editingValue),c("maxFractionDigits",2)("min",0)("autofocus",!0)}}function yi(o,v){if(o&1){let e=b();l(0,"p-inputNumber",97),T("ngModelChange",function(t){p(e);let n=a();return I(n.editingValue,t)||(n.editingValue=t),d(t)}),f("onFocus",function(t){p(e);let n=a();return d(n.select(t.target))})("onBlur",function(){p(e);let t=a(),n=V(33);return d(t.applyEdit(n))})("onKeyDown",function(t){p(e);let n=a(),_=V(33);return d(n.submitEdit(t,_))}),s()}if(o&2){let e=a();S("ngModel",e.editingValue),c("maxFractionDigits",2)("minFractionDigits",0)("autofocus",!0)}}function bi(o,v){if(o&1){let e=b();l(0,"p-inputNumber",98),T("ngModelChange",function(t){p(e);let n=a();return I(n.editingValue,t)||(n.editingValue=t),d(t)}),f("onFocus",function(t){p(e);let n=a();return d(n.select(t.target))})("onBlur",function(){p(e);let t=a(),n=V(33);return d(t.applyEdit(n))})("onKeyDown",function(t){p(e);let n=a(),_=V(33);return d(n.submitEdit(t,_))}),s()}if(o&2){let e=a();S("ngModel",e.editingValue),c("maxFractionDigits",2)("min",0)("max",100)("autofocus",!0)}}function xi(o,v){if(o&1){let e=b();l(0,"p-inputNumber",99),T("ngModelChange",function(t){p(e);let n=a();return I(n.editingValue,t)||(n.editingValue=t),d(t)}),f("onFocus",function(t){p(e);let n=a();return d(n.select(t.target))})("onKeyDown",function(t){p(e);let n=a(),_=V(33);return d(n.submitEdit(t,_))}),s()}if(o&2){let e=a();S("ngModel",e.editingValue),c("maxFractionDigits",2)("min",0)("max",100)("autofocus",!0)}}function wi(o,v){if(o&1){let e=b();l(0,"p-button",100),f("onClick",function(){p(e);let t=a();return d(t.applyDiscount(66))}),s()}}function Si(o,v){if(o&1){let e=b();l(0,"p-button",101),f("onClick",function(){p(e);let t=a();return d(t.applyDiscount(33))}),s()}}function Ii(o,v){if(o&1){let e=b();l(0,"p-button",102),u(1,"translate"),f("onClick",function(){p(e);let t=a();return d(t.confirmCheckoutAndPrint())}),s(),l(2,"p-button",103),u(3,"translate"),f("onClick",function(){p(e);let t=a();return d(t.rejectCheckout())}),s(),l(4,"p-button",104),u(5,"translate"),f("onClick",function(){p(e);let t=a();return d(t.confirmCheckout())}),s()}o&2&&(c("label",m(1,3,"Yes & Print")),r(2),c("label",m(3,5,"No")),r(2),c("label",m(5,7,"Yes")))}var we=(()=>{class o{constructor(){this.invoiceService=C(L),this.customersService=C(it),this.dollarPipe=C(be),this.stockService=C(U),this.translate=C(K),this.decimalService=C(pe),this.authService=C(qe),this.wholesaleSettingService=C(vt),this.notificationService=C(te),this.printService=C(me),this.printerSettingsService=C(de),this.confirmationService=C(Le),this.apiService=C(We),this.historyService=C(mt),this.cashBalanceService=C(Ue),this.customersFeaturesService=C(_e),this.priceQuoteService=C(Ct),this.discountSettings=C(ue),this.currencySetting=C(re),this.sellScaleService=C(bt),this.vh=this.sellScaleService.sellPageVH,this.defaultCurrency=this.currencySetting.defaultCurrency,this.productDialogVisible=!1,this.userPermissions=this.authService.userPermissions,this.productsDialogVisible=!1,this.stockTableLoading=this.stockService.tableLoading,this.wholesaleEnabled=this.wholesaleSettingService.wholesaleEnabled,this.priceQuoteEnabled=this.priceQuoteService.priceQuoteEnabled,this.customersFeaturesEnabled=this.customersFeaturesService.customersFeaturesEnabled,this.products=this.stockService.products,this.filteredProducts=[],this.productSearchText="",this.view_currency="dollar",this.selected_price_type="unit_price_usd",this.stateOptions=[{label:this.translate.instant("Retail"),value:"unit_price_usd"},{label:this.translate.instant("Wholesale"),value:"wholesale_price_usd"}],this.exchangeRate=this.stockService.exchangeRate,this.customers=this.customersService.customers,this.loadingCustomers=this.customersService.signal_tableLoading,this.discountInputEnabled=this.discountSettings.discountInputEnabled,this.dropDownVisible=!1,this.paymentAmountUSD=0,this.paymentAmountLBP=0,this.customerDialogVisible=!1,this.customer_balance_loading=this.customersService.signal_balanceLoading,this.customer_balance=this.customersService.customersTotalDebts$,this.operationTypes=[{label:this.translate.instant("Normal"),value:"normal"},{label:this.translate.instant("Debt"),value:"debt"}],this.editModeEnabled=!1,this.editingRowIndex=null,this.editingField="",this.defaultDiscountType=this.discountSettings.defaultDiscountType,this.printerSettings=this.printerSettingsService.printerSettings,this.thermalPrinterEnabled=this.printerSettingsService.thermalPrinterEnabled,this.confirmShowed=!1,this.checkoutLoading=!1,this.printDialogVisible=!1,this.inventories=this.stockService.inventories,this.loadingInventories=this.stockService.loadingInventories,this.defaultInventory=this.stockService.defaultInventory}focusAcceptButton(){let e=this.confirmDialog.nativeElement.querySelector(".p-confirm-dialog-accept");e&&e.focus()}focusRejectButton(){let e=this.confirmDialog.nativeElement.querySelector(".p-confirm-dialog-reject");e&&e.focus()}focusBarcodeInput(){this.barcodeInput.nativeElement.querySelector("input").focus()}blurBarcodeInput(){this.barcodeInput.nativeElement.querySelector("input").blur()}onKeyDown(e){if(this.editModeEnabled||this.productDialogVisible||this.printDialogVisible)return;let t=navigator.userAgent.toUpperCase().includes("MAC")?e.metaKey:e.ctrlKey,n=e.key.toLowerCase();if(n==="meta"||n==="control"||n==="shift"||n==="alt"||t&&["c","v","p","x","a","s","z","y"].includes(n))return;if(this.confirmShowed){e.code=="ArrowRight"?this.focusAcceptButton():e.code=="ArrowLeft"&&this.focusRejectButton();return}else if(this.dropDownVisible||this.productsDialogVisible||this.customerDialogVisible||this.confirmShowed)return;let g=this.payment_input,P=this.lira_input,O=this.discount_input,W=this.notes_input?this.notes_input.nativeElement:null;if((!g||!g.focused)&&(!P||!P.focused)&&(!O||!O.focused)&&document.activeElement!==W){if(e.code=="Space"&&this.thermalPrinterEnabled()){let Z=JSON.parse(localStorage.getItem("PrintInvoice"));Z&&!this.productSearchText&&(this.printService.thermalPrint(Z,"Sale"),setTimeout(()=>{this.productSearchText="",this.blurBarcodeInput()}));return}else e.code=="Enter"&&!this.productSearchText&&this.invoice.items.length>0?this.checkout():this.focusBarcodeInput();e.key==="+"?this.productSearchText||(this.addQtyToLastItem(),setTimeout(()=>{this.productSearchText="",this.blurBarcodeInput(),this.productAutoComplete.hide()})):e.key==="-"?this.productSearchText||(this.removeQtyFromLastItem(),setTimeout(()=>{this.productSearchText="",this.blurBarcodeInput(),this.productAutoComplete.hide()})):this.focusBarcodeInput()}}recalculateTotals(){this.invoiceService.recalculateTotals(this.invoice)}filterProducts(e){let i=e.query.toLowerCase();this.filteredProducts=this.products().filter(t=>t.product_name.toLowerCase().includes(i)||t.sku?.toLowerCase().includes(i)||t.barcode?.toLowerCase().includes(i))}handleProductInputKeydown(e){e.key==="Enter"&&(this.productSearchText&&(this.processProductSearch(this.productSearchText),e.preventDefault()),this.productSearchText="",setTimeout(()=>{this.productAutoComplete.hide()},50))}processProductSearch(e){if(typeof e=="string"){if(!e?.trim())return;let i=1,t=e.trim(),n=["*","+"];for(let g of n){let P=t.indexOf(g);if(P>0){let O=t.substring(0,P),W=t.substring(P+1),Z=parseInt(O);!isNaN(Z)&&W&&(i=Z,t=W);break}}let _=this.products().find(g=>g.barcode?.toLowerCase()===t.toLowerCase()||g.sku?.toLowerCase()===t.toLowerCase()||g.product_name?.toLowerCase()===t.toLowerCase());_?(this.addProductToInvoice(_,i),this.resetProductSearch()):this.notificationService.showError("Item not found!","home")}else typeof e=="object"&&e?.product_id&&(this.addProductToInvoice(e,1),this.resetProductSearch());this.productAutoComplete.hide()}addProductToInvoice(e,i=1){let t=this.invoice.items.find(n=>n.product_id===e.product_id);if(t)t.quantity+=i,t.total_price=t.unit_price*t.quantity;else{let n=this.wholesaleEnabled()&&this.selected_price_type==="wholesale_price_usd"&&e.wholesale_price_usd||e.unit_price_usd,_=e.unit_cost_usd,g=e.avg_cost_usd;this.defaultCurrency()==="dollar"?e.currency=="lira"&&(n=n/this.exchangeRate().rate_value,_=_/this.exchangeRate().rate_value,g=g/this.exchangeRate().rate_value):e.currency=="dollar"&&(n=this.dollarPipe.calculate(n),_=this.dollarPipe.calculate(_),g=this.dollarPipe.calculate(g)),this.invoice.items.push({product_id:e.product_id,barcode:e.barcode,product_name:e.product_name,unit_cost:_,avg_cost:g,original_price:n,unit_price:this.discountInputEnabled()?n*(1-this.invoice.discount_value/100):n,discount_percentage:this.invoice.discount_value,unit_price_lbp:this.dollarPipe.calculate(n),quantity:i,stock_management:e.stock_management,stock:e.quantity,low_stock_threshold:e.low_stock_threshold,currency:e.currency}),setTimeout(()=>{this.invoiceTable&&this.invoiceTable.scrollTo({top:this.invoiceTable.wrapperViewChild.nativeElement.scrollHeight})},10)}this.recalculateTotals()}onProductSelection(e){this.addProductToInvoice(e)}resetProductSearch(){this.productSearchText="",this.filteredProducts=[],this.productAutoComplete.hide()}assignSelectedProducts(e){this.productsDialogVisible=!1,e.forEach(i=>{this.addProductToInvoice(i,1)})}getPriceWarning(e){if(this.userPermissions().show_cost){if(!e.unit_price)return!1;let i=e.unit_cost||0,t=e.unit_price;return typeof i=="string"&&(i=parseFloat(i)),typeof t=="string"&&(t=parseFloat(t)),t<i}else return!1}getTooltipData(e){return this.userPermissions().show_cost?e.unit_cost:null}removeRow(e){e<0||e>=this.invoice.items.length||(this.invoice.items.splice(e,1),this.recalculateTotals())}addQtyToLastItem(e=1){let i=this.invoice.items;if(i.length===0)return;let t=i[i.length-1];t.quantity=(t.quantity||0)+e,this.recalculateTotals()}removeQtyFromLastItem(e=1){let i=this.invoice.items;if(i.length===0)return;let t=i.length-1,n=i[t];(n.quantity||0)>1?(n.quantity-=e,n.quantity<1&&(n.quantity=1)):i.splice(t,1),this.recalculateTotals()}onCreateProduct(e){this.addProductToInvoice(e),this.stockService.onCreateProduct(e)}onUSDChange(e){this.paymentAmountUSD=e,this.paymentAmountLBP=this.dollarPipe.calculate(e),this.invoice.payment_amount=e}onLBPChange(e){this.paymentAmountLBP=e;let i=e/this.exchangeRate().rate_value||0;this.paymentAmountUSD=i,this.invoice.payment_amount=i}resetData(){this.invoice.customer_id=null,this.invoice.discount_value=0,this.invoice.journal_notes=null,this.onUSDChange(0),this.onLBPChange(0),this.customer_balance.set({id:0,balance:0}),this.selected_price_type="unit_price_usd"}get selectedCustomer(){return this.customers().find(e=>e.account_id===this.invoice.customer_id)}onCustomerChange(e){this.invoice.customer_id=e?.account_id,this.loadCustomerInfo(e?.account_id),this.discountInputEnabled()&&(e?this.invoice.discount_value=e?.default_discount:this.invoice.discount_value=0),setTimeout(()=>{this.focusBarcodeInput()},10)}openCustomerDialog(){this.customerDialogVisible=!0}newCustomerCreated(e){this.customers.set([...this.customers(),e]),e&&this.onCustomerChange(e)}loadCustomerInfo(e){e?this.customersService.getAccountTotalBalance(e,this.defaultCurrency()):this.resetData()}onOperationTypeChange(){this.invoice.customer_id&&this.loadCustomerInfo(this.invoice.customer_id)}ngOnChanges(e){e.invoice&&(this.paymentAmountUSD=this.invoice.payment_amount??0,this.paymentAmountLBP=this.dollarPipe.calculate(this.paymentAmountUSD),this.loadCustomerInfo(this.invoice.customer_id))}select(e){e.select()}calculateNewBalance(e=0,i,t=0){return e=parseFloat(e),t||(t=0),this.decimalService.subtract(this.decimalService.add(e,i),t)}openEdit(e,i,t,n){this.editingRowIndex=t,this.editingField=n;let _=this.invoice.items[t];switch(n){case"quantity":this.editingValue=_.quantity;break;case"price":this.editingValue=_.unit_price;break;case"discount":this.editingValue=_.discount_percentage;break;case"total":this.editingValue=_.unit_price*_.quantity;break}e.show(i)}applyEdit(e){if(this.editingRowIndex===null)return;let i=this.invoice.items[this.editingRowIndex];if(this.editingField==="quantity")i.quantity=this.editingValue;else if(this.editingField==="price")if(i.unit_price=this.editingValue,i.unit_price_lbp=this.dollarPipe.calculate(this.editingValue),i.original_price){let t=100*(1-i.unit_price/i.original_price);i.discount_percentage=parseFloat(t.toFixed(2))}else i.discount_percentage=0;else if(this.editingField==="total")if(i.unit_price=this.editingValue/i.quantity,i.unit_price_lbp=this.dollarPipe.calculate(i.unit_price),i.original_price){let t=100*(1-i.unit_price/i.original_price);i.discount_percentage=parseFloat(t.toFixed(2))}else i.discount_percentage=0;else if(this.editingField==="discount")if(i.discount_percentage=this.editingValue,i.original_price){let t=(100-i.discount_percentage)/100;i.unit_price=parseFloat((i.original_price*t).toFixed(2))}else i.unit_price=0;this.editingRowIndex=null,this.editingField="",e.hide(),this.recalculateTotals()}applyDiscount(e){if(this.editingRowIndex===null)return;let i=this.invoice.items[this.editingRowIndex],n=this.decimalService.subtract(i.original_price,i.unit_cost)*(1-e/100),_=this.decimalService.add(i.unit_cost,n);console.log(_.toFixed(2));let g=100*(1-_/i.original_price);this.editingValue=g.toFixed(2)}submitEdit(e,i){e.key=="Enter"&&this.applyEdit(i)}checkout(){this.confirmShowed=!0,this.confirmationService.confirm({key:"sell",message:this.translate.instant("Are you sure that you want to submit invoice ?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-success",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject"})}confirmCheckout(e=!1){this.confirmShowed=!1,this.checkoutLoading=!0;let i=null;this.invoice.customer_id&&this.invoice.payment_amount&&(i={amount:this.invoice.payment_amount,customer_id:this.invoice.customer_id});let t=this.invoice;t.exchange_rate=this.stockService.exchangeRate().rate_value,t.currency=this.defaultCurrency(),t.customer_id||(t.operation_type="normal"),t.inventory_id=this.defaultInventory(),this.confirmationService.close(),this.apiService.post("sell-orders",{invoice:t,payment:i}).pipe(Se(()=>{this.checkoutLoading=!1,this.confirmationService.close()})).subscribe({next:n=>{if(this.resetData(),this.notificationService.showSuccess("Invoice submitted"),this.invoiceService.closeInvoice(this.invoice.id),this.stockService.getProducts(),this.historyService.fetchSalesHistory(),this.cashBalanceService.getBalance(),e&&(this.dataToPrint=n,this.printDialogVisible=!0),this.thermalPrinterEnabled()){let _=structuredClone(n),g=0;_.items.forEach(P=>{g=this.decimalService.add(g,this.decimalService.multiply(this.dollarPipe.calculate(P.unit_price),P.quantity))}),_.total_lbp=g,this.printerSettings().auto_print&&this.printService.thermalPrint(_,"sales"),localStorage.setItem("PrintInvoice",JSON.stringify(_))}}})}rejectCheckout(){this.confirmationService.close(),this.confirmShowed=!1,this.checkoutLoading=!1}confirmCheckoutAndPrint(){this.confirmCheckout(!0)}clearInvoice(){this.confirmShowed=!0,this.confirmationService.confirm({key:"clearInvoice",message:this.translate.instant("Are you sure you want to clear invoice?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.invoiceService.closeInvoice(this.invoice.id),this.checkoutLoading=!1,this.confirmShowed=!1},reject:()=>{this.confirmShowed=!1}})}openPrintDialog(){this.dataToPrint=structuredClone(this.invoice),this.dataToPrint.type="quote",this.dataToPrint.order_datetime=new Date,this.dataToPrint.exchange_rate=this.stockService.exchangeRate().rate_value,this.printDialogVisible=!0}refreshProducts(){this.stockService.getProducts(this.defaultInventory())}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=D({type:o,selectors:[["invoice-table"]],viewQuery:function(i,t){if(i&1&&(M(Ft,5),M(Nt,5),M(Lt,5,fe),M(Ot,5),M(Wt,5),M(qt,5),M(At,5),M(Qt,5,fe),M(Rt,5)),i&2){let n;B(n=k())&&(t.invoiceTable=n.first),B(n=k())&&(t.productAutoComplete=n.first),B(n=k())&&(t.barcodeInput=n.first),B(n=k())&&(t.payment_input=n.first),B(n=k())&&(t.lira_input=n.first),B(n=k())&&(t.notes_input=n.first),B(n=k())&&(t.discount_input=n.first),B(n=k())&&(t.confirmDialog=n.first),B(n=k())&&(t.payment_amount=n.first)}},hostBindings:function(i,t){i&1&&f("keydown",function(_){return t.onKeyDown(_)},!1,Me)},inputs:{invoice:"invoice"},standalone:!0,features:[Ve,F],decls:56,vars:64,consts:[["invoiceTable",""],["op",""],["confirmDialog",""],["customersDropdown",""],["payment_input",""],["lira_input",""],["notes_input",""],["discount_input",""],["productAutoComplete","","barcodeInput",""],["inventoryDropdown",""],["styleClass","mb-2"],[1,"flex","justify-content-between"],["tooltipPosition","top",1,"text-green-600","m-0","mt-2","pointer",3,"pTooltip"],["tooltipPosition","top",1,"text-primary","m-0","mt-2","pointer",3,"pTooltip"],["class","grid",4,"ngIf"],["dataKey","product_id","styleClass","p-datatable-sm ","editMode","cell",3,"value","scrollable","scrollHeight"],["pTemplate","caption"],["pTemplate","header"],["pTemplate","body"],["pTemplate","summary"],["pTemplate","emptymessage"],[1,"grid","mt-3"],[3,"ngClass"],["icon","pi pi-times","severity","danger","size","small","styleClass","w-full",3,"onClick","label"],["class","col-3",4,"ngIf"],[1,"col-6"],["icon","pi pi-cart-plus","severity","success","size","small","styleClass","w-full",3,"onClick","label","loading","disabled"],[4,"ngIf"],["appendTo","body",3,"onShow","onHide","dismissable"],[1,"formgrid","grid"],[1,"field","col-12"],["class","p-inputtext-sm","styleClass","input-align-center","step","0",3,"ngModel","maxFractionDigits","min","autofocus","ngModelChange","onFocus","onBlur","onKeyDown",4,"ngIf"],["class","p-inputtext-sm","min","0.1","step","0.1",3,"ngModel","maxFractionDigits","minFractionDigits","autofocus","ngModelChange","onFocus","onBlur","onKeyDown",4,"ngIf"],["class","p-inputtext-sm","styleClass","input-align-center","step","0.1",3,"ngModel","maxFractionDigits","min","max","autofocus","ngModelChange","onFocus","onBlur","onKeyDown",4,"ngIf"],["class","p-inputtext-sm","styleClass","input-align-center","step","0.1",3,"ngModel","maxFractionDigits","min","max","autofocus","ngModelChange","onFocus","onKeyDown",4,"ngIf"],["size","small","severity","success","label","apply","styleClass","ml-2",3,"onClick"],["size","small","label","66%",3,"onClick",4,"ngIf"],["size","small","label","33%","styleClass","mx-2",3,"onClick",4,"ngIf"],[3,"visibleChange","onCreate","visible","mode"],[3,"onHide","onSubmit","visible","products","tableLoading"],["mode","add",3,"visibleChange","onCreate","visible"],[3,"visibleChange","visible","invoice"],["key","sell",3,"breakpoints"],["pTemplate","footer"],["key","clearInvoice",3,"breakpoints"],[1,"grid"],[1,"col-4"],[1,"flex","flex-column","gap-1"],["for","customer"],["styleClass","p-inputtext-sm","appendTo","body",3,"onShow","onHide","onChange","loading","placeholder","emptyMessage","filter","showClear","autoOptionFocus","filterFields","options","ngModel"],["pTemplate","item"],["pTemplate","selectedItem"],["class","col-4",4,"ngIf"],[3,"col-8","col-4",4,"ngIf"],["class","col-12",4,"ngIf"],["class","col-4 align-self-end",4,"ngIf"],["for","option"],["styleClass","p-inputtext-sm","appendTo","body","optionLabel","label","optionValue","value",3,"ngModelChange","onChange","options","ngModel","placeholder","emptyMessage","autoOptionFocus"],["inputId","currency-us","mode","currency","styleClass","p-inputtext-sm w-full",3,"onFocus","ngModelChange","currency","locale","step","min","ngModel"],["inputId","currency-lb","mode","currency","currency","LBP","locale","en-LB","styleClass","p-inputtext-sm w-full",3,"onFocus","ngModelChange","step","min","ngModel"],["for","currency"],["pInputText","","type","text","spellcheck","false",1,"p-inputtext-sm",3,"ngModelChange","ngModel"],["for","discount"],["styleClass","p-inputtext-sm w-full","suffix"," %","step","0",3,"ngModelChange","onFocus","ngModel","maxFractionDigits","min","max"],[1,"col-12"],[1,"text-green-500"],[1,"text-center"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","50%",3,"isLoading","loadingBar"],["loaderClass","flex-grow-1 flex-shrink-1",2,"width","63%",3,"isLoading","loadingBar"],[1,"col-4","align-self-end"],["icon","pi pi-user","severity","success","size","small",3,"onClick","label"],[1,"col-3"],["dataKey","product_id","field","product_name","spellcheck","false","styleClass","p-inputtext-sm w-full","inputStyleClass","w-full",3,"completeMethod","ngModelChange","onKeyUp","suggestions","dropdown","minLength","showClear","ngModel","placeholder","emptyMessage","delay"],["id","inventory_id","styleClass","p-inputtext-sm","scrollHeight","400px","appendTo","body","optionLabel","inventory_name","optionValue","inventory_id","filterBy","inventory_name","inputStyleClass","w-full",3,"ngModelChange","onShow","onHide","autoOptionFocus","ngModel","options","placeholder","emptyMessage","filter"],["severity","warning","size","small","icon","pi pi-list","styleClass","mr-2",3,"onClick"],["icon","pi pi-plus","size","small","severity","success",3,"onClick"],["class","col-3 flex justify-content-end",4,"ngIf"],[3,"autoDir"],[1,"col-3","flex","justify-content-end"],["optionLabel","label","optionValue","value","styleClass","p-inputtext-sm",1,"w-full",3,"ngModelChange","onShow","onHide","options","ngModel","showClear"],["width","45%"],["width","20%"],["width","5%"],["width","5%","tooltipPosition","top",3,"pTooltip"],["tooltipPosition","top",1,"pointer",3,"pTooltip","autoDir"],[1,"editable",3,"click","ngClass"],["class","editable",3,"click",4,"ngIf"],[1,"editable",3,"click"],[1,"font-bold",3,"ngClass"],[1,"danger-hover",3,"click"],[1,"pi","pi-trash"],["class","text-center m-0",4,"ngIf"],[1,"text-center","m-0"],[1,"surface-300"],["colspan","9"],["icon","pi pi-print","size","small","severity","contrast","styleClass","w-full",3,"onClick","label","disabled"],["styleClass","input-align-center","step","0",1,"p-inputtext-sm",3,"ngModelChange","onFocus","onBlur","onKeyDown","ngModel","maxFractionDigits","min","autofocus"],["min","0.1","step","0.1",1,"p-inputtext-sm",3,"ngModelChange","onFocus","onBlur","onKeyDown","ngModel","maxFractionDigits","minFractionDigits","autofocus"],["styleClass","input-align-center","step","0.1",1,"p-inputtext-sm",3,"ngModelChange","onFocus","onBlur","onKeyDown","ngModel","maxFractionDigits","min","max","autofocus"],["styleClass","input-align-center","step","0.1",1,"p-inputtext-sm",3,"ngModelChange","onFocus","onKeyDown","ngModel","maxFractionDigits","min","max","autofocus"],["size","small","label","66%",3,"onClick"],["size","small","label","33%","styleClass","mx-2",3,"onClick"],["icon","pi pi-print","severity","contrast","size","small",1,"mr-6",3,"onClick","label"],["icon","pi pi-times","styleClass","mr-2 p-confirm-dialog-reject","severity","danger","size","small",3,"onClick","label"],["styleClass","p-confirm-dialog-accept","icon","pi pi-check","severity","success","size","small",3,"onClick","label"]],template:function(i,t){if(i&1){let n=b();l(0,"p-card",10)(1,"div",11)(2,"h2",12),u(3,"currency"),u(4,"exchangedLira"),h(5),u(6,"currency"),u(7,"exchangedLira"),s(),l(8,"h2",13),u(9,"dollar"),u(10,"lira"),h(11),u(12,"lira"),u(13,"lira"),s()(),E(14,"p-divider"),y(15,ni,19,24,"div",14),l(16,"p-table",15,0),y(18,ai,17,23,"ng-template",16)(19,li,21,22,"ng-template",17)(20,ui,22,29,"ng-template",18)(21,_i,1,1,"ng-template",19)(22,gi,4,3,"ng-template",20),s(),l(23,"div",21)(24,"div",22)(25,"p-button",23),u(26,"translate"),f("onClick",function(){return p(n),d(t.clearInvoice())}),s()(),y(27,vi,3,4,"div",24),l(28,"div",25)(29,"p-button",26),u(30,"translate"),f("onClick",function(){return p(n),d(t.checkout())}),s()()(),y(31,fi,3,3,"small",27),s(),l(32,"p-overlayPanel",28,1),f("onShow",function(){return p(n),d(t.editModeEnabled=!0)})("onHide",function(){return p(n),d(t.editModeEnabled=!1)}),l(34,"div",29)(35,"div",30)(36,"label"),h(37),u(38,"translate"),s(),y(39,hi,1,4,"p-inputNumber",31)(40,Ci,1,4,"p-inputNumber",31)(41,yi,1,4,"p-inputNumber",32)(42,bi,1,5,"p-inputNumber",33)(43,xi,1,5,"p-inputNumber",34),l(44,"p-button",35),f("onClick",function(){p(n);let g=V(33);return d(t.applyEdit(g))}),s()(),y(45,wi,1,0,"p-button",36)(46,Si,1,0,"p-button",37),s()(),l(47,"customer-dialog",38),T("visibleChange",function(g){return p(n),I(t.customerDialogVisible,g)||(t.customerDialogVisible=g),d(g)}),f("onCreate",function(g){return p(n),d(t.newCustomerCreated(g))}),s(),l(48,"products-dialog",39),f("onHide",function(){return p(n),d(t.productsDialogVisible=!1)})("onSubmit",function(g){return p(n),d(t.assignSelectedProducts(g))}),s(),l(49,"product-form",40),T("visibleChange",function(g){return p(n),I(t.productDialogVisible,g)||(t.productDialogVisible=g),d(g)}),f("onCreate",function(g){return p(n),d(t.onCreateProduct(g))}),s(),l(50,"print-dialog",41),T("visibleChange",function(g){return p(n),I(t.printDialogVisible,g)||(t.printDialogVisible=g),d(g)}),s(),l(51,"p-confirmDialog",42,2),y(53,Ii,6,9,"ng-template",43),s(),E(54,"p-confirmDialog",44,2)}i&2&&(r(2),c("pTooltip",t.userPermissions().show_cost?t.defaultCurrency()==="dollar"?m(3,38,t.invoice.total_cost).toString():m(4,40,t.invoice.total_cost).toString():""),r(3),w(" USD: ",t.defaultCurrency()==="dollar"?m(6,42,t.invoice.total_amount):m(7,44,t.invoice.total_amount)," "),r(3),c("pTooltip",t.userPermissions().show_cost?t.defaultCurrency()==="dollar"?m(9,46,t.invoice.total_cost).toString():m(10,48,t.invoice.total_cost).toString():""),r(3),w(" ",t.defaultCurrency()==="dollar"?m(12,50,t.invoice.total_lbp):m(13,52,t.invoice.total_amount)," "),r(4),c("ngIf",t.customersFeaturesEnabled()),r(),ye("scrollHeight",t.vh()),c("value",t.invoice.items)("scrollable",!0),r(8),c("ngClass",t.priceQuoteEnabled()?"col-3":"col-6"),r(),c("label",m(26,54,"Clear")),r(2),c("ngIf",t.priceQuoteEnabled()),r(2),c("label",m(30,56,"Checkout"))("loading",t.checkoutLoading)("disabled",t.invoice.items.length==0),r(2),c("ngIf",t.thermalPrinterEnabled()),r(),c("dismissable",!0),r(5),w("",m(38,58,t.editingField),": "),r(2),c("ngIf",t.editingField==="price"),r(),c("ngIf",t.editingField==="total"),r(),c("ngIf",t.editingField==="quantity"),r(),c("ngIf",t.editingField==="discount"&&t.defaultDiscountType()==="normal"),r(),c("ngIf",t.editingField==="discount"&&t.defaultDiscountType()==="on-profit"),r(2),c("ngIf",t.editingField==="discount"&&t.defaultDiscountType()==="on-profit"),r(),c("ngIf",t.editingField==="discount"&&t.defaultDiscountType()==="on-profit"),r(),S("visible",t.customerDialogVisible),c("mode","add"),r(),c("visible",t.productsDialogVisible)("products",t.products)("tableLoading",t.stockTableLoading()),r(),S("visible",t.productDialogVisible),r(),S("visible",t.printDialogVisible),c("invoice",t.dataToPrint),r(),he(q(60,Vt)),c("breakpoints",q(61,Pt)),r(3),he(q(62,Vt)),c("breakpoints",q(63,Pt)))},dependencies:[N,X,A,ee,R,Q,Oe,Ye,Ze,z,oe,Ae,ie,ne,Ke,H,j,Ge,Je,Re,Qe,_t,et,$e,se,ae,ge,st,at,gt,lt,pt,ct,Xe,ut,dt,ft,ht,ce,be,yt,le,tt,ve],styles:["[_nghost-%COMP%]  .p-card-body{padding:.8rem!important;padding-top:.3!important}[_nghost-%COMP%]  .p-card-content{padding:0!important}[_nghost-%COMP%]  .p-datatable{font-size:.9rem!important}[_nghost-%COMP%]  .p-datatable-header{padding-bottom:0!important}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.9rem;text-align:center}table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.5rem;border:none}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]{border-top:1px solid #dee2e6;border-bottom:1px solid #dee2e6}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{border-top:1px solid #dee2e6}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6}.editable-cell[_ngcontent-%COMP%]{cursor:pointer;background-color:#f8f9fa}.editable[_ngcontent-%COMP%]{cursor:pointer;background-color:#e6e6e6}.editable[_ngcontent-%COMP%]:hover{background-color:#bebebe}[_nghost-%COMP%]  .p-button{padding:.6rem 1.09375rem!important}[_nghost-%COMP%]  .p-button.p-button-sm{font-size:.875rem!important;padding:.65625rem 1.09375rem!important}"]})}}return o})();var Mt=(()=>{class o{transform(e){return e.filter(i=>i.show_on_sell==1)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275pipe=Te({name:"category",type:o,pure:!0,standalone:!0})}}return o})();var Ti=o=>({selected:o});function Vi(o,v){o&1&&E(0,"p-progressSpinner")}function Pi(o,v){if(o&1){let e=b();l(0,"div",10)(1,"div",11),f("click",function(){let t=p(e).$implicit,n=a(3);return d(n.selectCategory(t))}),l(2,"p",12),h(3),s()()()}if(o&2){let e=v.$implicit,i=a(3);r(),c("ngClass",G(2,Ti,i.selectedCategory()==e)),r(2),w(" ",e.category_name," ")}}function Mi(o,v){if(o&1&&(ke(0),y(1,Pi,4,4,"div",9),u(2,"category"),Ee()),o&2){let e=a(2);r(),c("ngForOf",m(2,1,e.categories()))}}function Bi(o,v){if(o&1&&y(0,Mi,3,3,"ng-container",8),o&2){let e=a();c("ngIf",!e.selectedCategory())}}function ki(o,v){o&1&&E(0,"p-progressSpinner")}function Ei(o,v){if(o&1){let e=b();l(0,"div",16)(1,"div",17),u(2,"currency"),u(3,"lira"),f("click",function(){let t=p(e).$implicit,n=a(2);return d(n.selectProduct(t))}),l(4,"p",18),h(5),s()()()}if(o&2){let e=v.$implicit;r(),c("pTooltip",e.currency==="dollar"?m(2,3,e.unit_price_usd).toString():m(3,5,e.unit_price_usd).toString()),r(3),c("autoDir",e.product_name),r(),w(" ",e.product_name," ")}}function Di(o,v){if(o&1){let e=b();l(0,"p-messages",19),T("valueChange",function(t){p(e);let n=a(2);return I(n.message,t)||(n.message=t),d(t)}),s()}if(o&2){let e=a(2);S("value",e.message),c("closable",!1)}}function Fi(o,v){if(o&1&&(l(0,"div",13),y(1,Ei,6,7,"div",14),s(),y(2,Di,1,2,"p-messages",15)),o&2){let e,i=a();r(),c("ngForOf",i.visibleProducts()),r(),c("ngIf",i.visibleProducts().length===0&&((e=i.selectedCategory())==null?null:e.category_id))}}var Bt=(()=>{class o{constructor(){this.stockService=C(U),this.invoiceService=C(L),this.translate=C(K),this.productSelected=new Pe,this.fieldsetCollapsed=this.invoiceService.fieldsetCollapsed,this.categories=this.stockService.categories,this.selectedCategory=this.stockService.selectedCategorySell,this.products=this.stockService.products,this.showZeroItems=this.invoiceService.showZeroItems,this.visibleProducts=Ne(()=>{let e=this.products(),i=this.selectedCategory(),t=this.showZeroItems();return i?e.filter(n=>{let _=!i||n.category_id_fk===i.category_id,g=!n.is_hidden,P=n.quantity>0||!n.stock_management;return _&&g&&(t||P)}):[]}),this.categoriesLoading=this.stockService.categoriesLoading,this.sellProductsLoading=this.stockService.sellProductsLoading}toggleCollapse(e){this.fieldsetCollapsed.set(e)}ngOnInit(){this.message=[{severity:"info",detail:this.translate.instant("No items in this category yet")}],this.messages=[{severity:"info",detail:"No Invoice Yet!"}]}updateZeroItemsState(){this.invoiceService.updateZeroItemsState()}selectCategory(e){this.stockService.selectedCategorySell()==e?this.stockService.selectedCategorySell.set(null):this.stockService.selectedCategorySell.set(e)}selectProduct(e){this.productSelected.emit(e)}setBack(){this.selectedCategory.set(null)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=D({type:o,selectors:[["categories-pos"]],outputs:{productSelected:"productSelected"},standalone:!0,features:[F],decls:17,vars:11,consts:[[1,"grid"],[1,"col-4"],["severity","contrast","icon","pi pi-chevron-left",3,"onClick","label","disabled"],[1,"col-4","flex","align-items-center","justify-content-center"],[1,"m-0"],[1,"col-4","flex","align-items-center","justify-content-end"],[1,"m-0","p-2"],["id","showOnSell",3,"ngModelChange","ngModel"],[4,"ngIf"],["class","col-3 p-1",4,"ngFor","ngForOf"],[1,"col-3","p-1"],[1,"dark-hover","p-2","border-round","shadow-2","maxHeight","flex","align-items-center","justify-content-center",3,"click","ngClass"],[1,"m-0","text-center","p-1"],[1,"grid","pt-2"],["class","col-3 p-1 z-1s",4,"ngFor","ngForOf"],[3,"value","closable","valueChange",4,"ngIf"],[1,"col-3","p-1","z-1s"],["tooltipPosition","top",1,"bg-gray","shadow-3","p-2","border-round","maxHeight","flex","align-items-center","justify-content-center",3,"click","pTooltip"],[1,"m-0","text-center","p-1","font-bold",3,"autoDir"],[3,"valueChange","value","closable"]],template:function(i,t){if(i&1&&(l(0,"p-card")(1,"div",0)(2,"div",1)(3,"p-button",2),u(4,"translate"),f("onClick",function(){return t.setBack()}),s()(),l(5,"div",3)(6,"h2",4),h(7),s()(),l(8,"div",5)(9,"p",6),h(10),u(11,"translate"),s(),l(12,"p-inputSwitch",7),T("ngModelChange",function(_){return I(t.showZeroItems,_)||(t.showZeroItems=_),_}),f("ngModelChange",function(){return t.updateZeroItemsState()}),s()(),y(13,Vi,1,0,"p-progressSpinner")(14,Bi,1,1,"ng-container"),s(),y(15,ki,1,0,"p-progressSpinner")(16,Fi,3,2),s()),i&2){let n;r(3),c("label",m(4,7,"Back"))("disabled",!t.selectedCategory()),r(4),w(" ",(n=t.selectedCategory())==null?null:n.category_name," "),r(3),x(m(11,9,"Show Zero Items ?")),r(2),S("ngModel",t.showZeroItems),r(),Ce(t.categoriesLoading()?13:14),r(2),Ce(t.sellProductsLoading()?15:16)}},dependencies:[N,X,$,A,ee,ge,rt,ot,R,Q,He,je,le,wt,xt,oe,ie,ne,z,Mt,se,ae,nt,ce,H,j,ve],styles:[".category-cards[_ngcontent-%COMP%]{border-radius:6px;color:#343a40;text-align:center;padding:.8rem;box-shadow:0 2px 1px -1px #0003,0 1px 1px #00000024,0 1px 3px #0000001f}.selected[_ngcontent-%COMP%]{background-color:#343a40;color:#fff}[_nghost-%COMP%]  .p-card-body{padding:.8rem!important}[_nghost-%COMP%]  .maxHeight{height:100%!important}[_nghost-%COMP%]  .p-card-content{padding-top:0!important}[_nghost-%COMP%]  .p-fieldset-content{padding:0!important}"]})}}return o})();function Ni(o,v){if(o&1&&E(0,"invoice-table",4),o&2){let e=a();c("invoice",e.invoiceService.activeInvoice)}}var Ro=(()=>{class o{constructor(){this.invoiceService=C(L)}onProductSelection(e){this.invoiceTableComponent.addProductToInvoice(e)}static{this.\u0275fac=function(i){return new(i||o)}}static{this.\u0275cmp=D({type:o,selectors:[["invoice-home"]],viewQuery:function(i,t){if(i&1&&M(we,5),i&2){let n;B(n=k())&&(t.invoiceTableComponent=n.first)}},standalone:!0,features:[F],decls:6,vars:1,consts:[[1,"grid","m-1"],[1,"col-12","md:col-6"],[3,"invoice",4,"ngIf"],[3,"productSelected"],[3,"invoice"]],template:function(i,t){i&1&&(l(0,"div",0)(1,"div",1),E(2,"invoice-tabs"),y(3,Ni,1,1,"invoice-table",2),s(),l(4,"div",1)(5,"categories-pos",3),f("productSelected",function(_){return t.onProductSelection(_)}),s()()()),i&2&&(r(3),c("ngIf",t.invoiceService.activeInvoice))},dependencies:[N,A,Tt,Bt,we]})}}return o})();export{Ro as InvoiceHomeComponent};
