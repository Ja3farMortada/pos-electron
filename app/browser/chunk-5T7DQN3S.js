import{a as u}from"./chunk-7CR6E6US.js";import{a as d,e as p}from"./chunk-QJMHFOYW.js";import{c as f}from"./chunk-G5UOHYUM.js";import{b as l}from"./chunk-4A2WLUYH.js";import{C as i,Vb as n,Wb as c,da as s,pb as a,y as h}from"./chunk-DSVZHE42.js";var R=(()=>{class r{constructor(){this.http=i(a),this.apiService=i(c),this.notificationService=i(n),this.cashBalanceService=i(u),this.socket=i(d),this.userService=i(l),this.decimalService=i(p),this.dateService=i(f),this.salesHistory=s([]),this.paymentsHistory=s([]),this.signal_loading=s(!1),this.moneyTransfersHistory=s([]),this.returnHistory=s([]),this.salesHistoryParams=s(this.initParams()),this.selectedOrderItems=s([]),this.selectedReturnOrderItems=s([]),this.receiptsHistory=s([]),this.purchasesHistory=s([]),this.selectedPurchaseItems=s([]),this.socketId=this.userService.socketId,this.returnPurchasesHistory=s([]),this.loadingReturnPurchase=s(!1),this.selectedReturnPurchaseItems=s([]),this.initializeSockets()}initParams(){return{invoice_number:null,customer_id:null,start_date:null,end_date:null,product_id:null,user_id:null}}fetchSalesHistory(t=null){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/sales/search`,t).subscribe({next:e=>{this.salesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchOrderItemsById(t){t.length>0&&this.http.post(`${this.apiService.host()}/history/sales/details`,t).subscribe({next:e=>{this.selectedOrderItems.set(e)},error:e=>{this.notificationService.showError(e.error,"home")}})}fetchReturnOrderItemsById(t){t.length>0&&this.apiService.post("history/returns/details",t).subscribe({next:e=>{this.selectedReturnOrderItems.set(e)}})}fetchPaymentHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/payment/search`,t).subscribe({next:e=>{this.paymentsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchMoneyTransferHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/money-transfer/search`,t).subscribe({next:e=>{this.moneyTransfersHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchReturnHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/return/search`,t).subscribe({next:e=>{this.returnHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPurchasesHistory(t=null){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/purchase/search`,t).subscribe({next:e=>{this.purchasesHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchPurchaseItemsById(t){t.length>0&&this.http.post(`${this.apiService.host()}/history/purchases/details`,t).subscribe({next:e=>{this.selectedPurchaseItems.set(e)},error:e=>{this.notificationService.showError(e.error,"home")}})}fetchReceiptsHistory(t){this.signal_loading.set(!0),this.http.post(`${this.apiService.host()}/history/receipt/search`,t).subscribe({next:e=>{this.receiptsHistory.set(e),this.signal_loading.set(!1)},error:e=>{this.signal_loading.set(!1),this.notificationService.handleError(e.error,"home")}})}initializeSockets(){this.socket.on("sellOrderCreated",t=>{let e=t[0];t[1].user_id!=this.socketId()&&(this.fetchSalesHistory(),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("New order created!","home"))}),this.socket.on("sellOrderUpdated",t=>{let e=t[0];t[1].user_id!=this.socketId()&&(this.fetchSalesHistory(),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("An order has been updated!","home"))}),this.socket.on("sellOrderDeleted",t=>{let e=t[0];t[1].user_id!=this.socketId()&&(this.fetchSalesHistory(),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("An order has been deleted!","home"))})}fetchReturnPurchasesHistory(t=null){this.loadingReturnPurchase.set(!0),this.http.post(`${this.apiService.host()}/history/return-purchase/search`,t).subscribe({next:e=>{this.returnPurchasesHistory.set(e),this.loadingReturnPurchase.set(!1)},error:e=>{this.loadingReturnPurchase.set(!1),this.notificationService.handleError(e.error,"home")}})}fetchReturnPurchaseItemsById(t){t.length>0&&this.http.post(`${this.apiService.host()}/history/return-purchases/details`,t).subscribe({next:e=>{this.selectedReturnPurchaseItems.set(e)},error:e=>{this.notificationService.showError(e.error,"home")}})}static{this.\u0275fac=function(e){return new(e||r)}}static{this.\u0275prov=h({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{R as a};
