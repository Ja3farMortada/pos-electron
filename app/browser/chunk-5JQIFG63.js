import{a as re}from"./chunk-SBLJNY6Q.js";import{a as ae,d as _e,f as xe}from"./chunk-NEQPNYWW.js";import{c as ge}from"./chunk-AFTSMEUE.js";import{j as ce,l as me,m as ue,p as de,q as he}from"./chunk-LBGQA5HW.js";import{b as Y}from"./chunk-4A2WLUYH.js";import{b as se,c as oe}from"./chunk-VVKQAEX7.js";import{Ba as F,C as r,Ca as N,D as V,Da as W,Fa as _,Ga as x,J as j,Ja as f,Jb as H,K as p,Ka as b,L as c,La as y,Na as O,Oa as M,P as w,Pa as S,Qc as le,Rc as pe,Sb as R,Vb as Q,Wb as $,Xa as d,Y as m,Ya as h,Yb as G,a as k,ac as J,d as T,da as E,fc as K,ga as D,gb as L,ia as u,ib as U,jc as X,la as A,lc as Z,nb as z,oa as o,pa as l,pb as q,ua as C,va as g,wa as a,wc as ee,xc as te,y as P,yc as ie,zc as ne}from"./chunk-DSVZHE42.js";var fe=(()=>{class s{constructor(){this.socket=r(ae),this.userService=r(Y),this.http=r(q),this.api=r($),this.notificationService=r(Q),this.cashBalanceService=r(re),this.expensesAccounts=E([]),this.loading_table=E(!1),this.status_action$=new T({}),this.socketId=this.userService.socketId,this.getExpensesAccounts(),this.initializeSockets()}getExpensesAccounts(){this.loading_table.set(!0),this.http.get(`${this.api.host()}/expense/accounts`).subscribe({next:e=>{this.expensesAccounts.set(e)},error:e=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}submitExpensePayment(e){this.loading_table.set(!0),this.http.post(`${this.api.host()}/expense/create`,e).subscribe({next:i=>{this.notificationService.showSuccess(i.message,"home"),this.status_action$.next({action:"ADD"}),this.cashBalanceService.getBalance()},error:i=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}submitExpenseEditPayment(e){this.loading_table.set(!0),this.http.put(`${this.api.host()}/expense`,e).subscribe({next:i=>{this.notificationService.showSuccess("Payment updated successfully","home"),this.status_action$.next({action:"UPDATE"}),this.cashBalanceService.getBalance()},error:i=>{this.loading_table.set(!1)},complete:()=>{this.loading_table.set(!1)}})}deletePayment(e){this.loading_table.set(!0),this.http.delete(`${this.api.host()}/expense/${e}`).subscribe({next:i=>{this.status_action$.next({action:"DELETE"}),this.cashBalanceService.getBalance()},error:i=>{this.loading_table.set(!1),this.notificationService.showError(i.error,"home")},complete:()=>{this.loading_table.set(!1),this.notificationService.showSuccess("Payment deleted successfully","home")}})}initializeSockets(){this.socket.on("expenseCreated",e=>{e.user_id!=this.socketId()&&(this.status_action$.next({action:"ADD"}),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("New expense created!","home"))}),this.socket.on("expenseUpdated",e=>{e.user_id!=this.socketId()&&(this.status_action$.next({action:"UPDATE"}),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("An expense record has been updated!","home"))}),this.socket.on("expenseUpdated",e=>{e.user_id!=this.socketId()&&(this.status_action$.next({action:"UPDATE"}),this.cashBalanceService.getBalance(),this.notificationService.showSocketMessage("An expense record has been deleted!","home"))})}static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275prov=P({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();var ye=["amountInput"],Ce=()=>({width:"75vw"}),Se=()=>({"1199px":"85vw","575px":"95vw"}),B=s=>({"ng-invalid ng-dirty":s});function ve(s,I){if(s&1){let e=C();o(0,"div",5)(1,"div",6)(2,"div",7)(3,"label",8),_(4),d(5,"translate"),o(6,"span",9),_(7," *"),l()(),o(8,"input",10),y("ngModelChange",function(t){p(e);let n=a();return b(n.journal_description,t)||(n.journal_description=t),c(t)}),l()()(),o(9,"div",6)(10,"label",11),_(11),d(12,"translate"),o(13,"span",9),_(14," *"),l()(),o(15,"p-calendar",12),y("ngModelChange",function(t){p(e);let n=a();return b(n.payment_date,t)||(n.payment_date=t),c(t)}),l()(),o(16,"div",6)(17,"div",7)(18,"label",13),_(19),d(20,"translate"),o(21,"span",9),_(22," *"),l()(),o(23,"p-inputNumber",14,0),y("ngModelChange",function(t){p(e);let n=a();return b(n.amount,t)||(n.amount=t),c(t)}),g("onFocus",function(t){p(e);let n=a();return c(n.selectInput(t))})("ngModelChange",function(t){p(e);let n=a();return c(n.onUsdChange(t))}),l()()(),o(25,"div",6)(26,"label"),_(27),d(28,"translate"),l(),o(29,"p-inputNumber",15,1),y("ngModelChange",function(t){p(e);let n=a();return b(n.lbpAmount,t)||(n.lbpAmount=t),c(t)}),g("onFocus",function(t){p(e);let n=a();return c(n.selectInput(t))})("ngModelChange",function(t){p(e);let n=a();return c(n.onLbpChange(t))}),l(),o(31,"small"),_(32),d(33,"translate"),l()()()}if(s&2){let e=a();m(4),x(h(5,21,"Description")),m(4),f("ngModel",e.journal_description),u("ngClass",S(31,B,e.submitted&&!e.journal_description)),m(3),x(h(12,23,"Date")),m(4),f("ngModel",e.payment_date),u("showIcon",!1)("showClear",!0)("readonlyInput",!0)("showTime",!0),m(4),x(h(20,25,"Amount")),m(4),f("ngModel",e.amount),u("required",!0)("min",0)("ngClass",S(33,B,e.submitted&&!e.amount)),m(4),x(h(28,27,"LBP amount")),m(2),f("ngModel",e.lbpAmount),u("required",!0)("step",1e3)("min",0)("ngClass",S(35,B,e.submitted&&!e.amount)),m(3),x(h(33,29,"LBP payments are reference only, payments are always submitted in USD"))}}function we(s,I){if(s&1){let e=C();o(0,"p-button",19),d(1,"translate"),g("onClick",function(){p(e);let t=a(2);return c(t.deletePayment())}),l()}if(s&2){let e=a(2);u("label",h(1,2,"Delete"))("disabled",e.loading())}}function Ee(s,I){if(s&1){let e=C();D(0,we,2,4,"p-button",16),o(1,"p-button",17),d(2,"translate"),g("onClick",function(){p(e);let t=a();return c(t.closeDialog())}),l(),o(3,"p-button",18),d(4,"translate"),g("onClick",function(){p(e);let t=a();return c(t.submitPayment())}),l()}if(s&2){let e=a();u("ngIf",e.dialog_mode==="edit"),m(),u("label",h(2,5,"Cancel"))("disabled",e.loading()),m(2),u("label",h(4,7,"Submit"))("loading",e.loading())}}var ct=(()=>{class s{constructor(){this.expensesService=r(fe),this.confirmationService=r(H),this.stockService=r(_e),this.dateService=r(ge),this.dollarPipe=r(xe),this.translate=r(se),this.visible=!1,this.dialog_mode="add",this.OnClose=new w,this.OnSubmit=new w,this.exchangeRate=this.stockService.exchangeRate,this.expensesAccounts=this.expensesService.expensesAccounts,this.loading=this.expensesService.loading_table,this.subscriptions=new k,this.submitted=!1,this.payment_date=this.dateService.getCurrentDatetime(),this.amount=null,this.lbpAmount=0}onUsdChange(e){this.lbpAmount=this.dollarPipe.calculate(e)}onLbpChange(e){this.amount=e/this.exchangeRate().rate_value}initDialog(){this.submitted=!1,this.amount=0,this.lbpAmount=0,this.journal_description=null}closeDialog(){this.OnClose.emit(),this.initDialog()}ngOnInit(){this.subscriptions.add(this.expensesService.status_action$.subscribe(e=>{e.action&&(this.OnSubmit.emit(),this.initDialog(),this.visible=!1,this.expensesService.status_action$.next({}))}))}ngOnDestroy(){this.subscriptions.unsubscribe()}ngOnChanges(){this.visible&&this.dialog_mode==="edit"&&this.selected_payment?(this.journal_description=this.selected_payment.journal_description,this.amount=this.selected_payment.total_value,this.onUsdChange(this.amount),this.payment_date=this.dateService.formatDate(this.selected_payment.payment_date,"yyyy-MM-dd HH:mm")):this.visible&&this.dialog_mode==="add"&&(this.payment_date=this.dateService.getCurrentDatetime())}deletePayment(){this.confirmationService.confirm({key:"home",message:this.translate.instant("Are you sure you want to continue ?"),header:this.translate.instant("Warning"),acceptLabel:this.translate.instant("Yes"),rejectLabel:this.translate.instant("No"),icon:"pi pi-exclamation-triangle",acceptButtonStyleClass:"p-button-danger",rejectButtonStyleClass:"p-button-secondary",defaultFocus:"reject",accept:()=>{this.expensesService.deletePayment(this.selected_payment.journal_id)}})}submitPayment(){this.submitted=!0,this.amount>0&&this.payment_date&&this.journal_description&&(this.payment_date=this.dateService.formatDate(this.payment_date),this.dialog_mode==="add"?this.expensesService.submitExpensePayment({amount:this.amount,journal_description:this.journal_description,payment_date:this.payment_date}):this.expensesService.submitExpenseEditPayment({amount:this.amount,journal_description:this.journal_description,payment_date:this.payment_date,journal_id:this.selected_payment.journal_id}))}selectInput(e){e.target.select()}static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275cmp=V({type:s,selectors:[["expenses-dialog"]],viewQuery:function(i,t){if(i&1&&F(ye,5),i&2){let n;N(n=W())&&(t.amountInput=n.first)}},inputs:{visible:"visible",dialog_mode:"dialog_mode",selected_payment:"selected_payment"},outputs:{OnClose:"OnClose",OnSubmit:"OnSubmit"},standalone:!0,features:[j,O],decls:4,vars:13,consts:[["amountInput",""],["liraInput",""],["position","top","styleClass","p-fluid",3,"visibleChange","onHide","header","modal","visible","breakpoints","closeOnEscape","closable","maximizable"],["pTemplate","content"],["pTemplate","footer"],[1,"formgrid","grid"],[1,"field","col-12","md:col-3"],[1,"flex","flex-column","gap-2"],["for","Type"],[1,"text-red-500"],["type","text","pInputText","",1,"p-inputtext-sm",3,"ngModelChange","ngModel","ngClass"],["for","payment_date"],["styleClass","p-inputtext-sm w-full","appendTo","body","dateFormat","yy-mm-dd","placeholder","Date",3,"ngModelChange","ngModel","showIcon","showClear","readonlyInput","showTime"],["for","amount"],["styleClass","input-align-center","mode","currency","currency","USD","locale","en-US","step","0",1,"p-inputtext-sm",3,"ngModelChange","onFocus","ngModel","required","min","ngClass"],["styleClass","input-align-center","mode","currency","currency","LBP","locale","en-LB",1,"p-inputtext-sm",3,"ngModelChange","onFocus","ngModel","required","step","min","ngClass"],["size","small","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"label","disabled","onClick",4,"ngIf"],["size","small","icon","pi pi-times","severity","secondary","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","label","disabled"],["size","small","icon","pi pi-check","severity","success","styleClass","w-full mt-2 md:w-auto md:ml-2",3,"onClick","label","loading"],["size","small","icon","pi pi-trash","severity","danger","styleClass","w-full mt-4 md:w-auto md:mt-0",3,"onClick","label","disabled"]],template:function(i,t){i&1&&(o(0,"p-dialog",2),d(1,"translate"),y("visibleChange",function(v){return b(t.visible,v)||(t.visible=v),v}),g("onHide",function(){return t.closeDialog()}),D(2,ve,34,37,"ng-template",3)(3,Ee,5,9,"ng-template",4),l()),i&2&&(A(M(11,Ce)),u("header",h(1,9,"Submit Expense"))("modal",!0),f("visible",t.visible),u("breakpoints",M(12,Se))("closeOnEscape",!1)("closable",!0)("maximizable",!0))},dependencies:[pe,le,R,te,ee,ce,he,de,ue,me,Z,G,J,X,K,z,L,U,ne,ie,oe]})}}return s})();export{ct as a};
